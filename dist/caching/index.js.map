{"version":3,"file":"index.js","sources":["../../src/caching/index.ts"],"sourcesContent":["/**\n * Advanced Caching Module\n *\n * Provides configurable caching with multiple eviction policies.\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport type EvictionPolicy = 'lru' | 'lfu' | 'fifo' | 'ttl';\n\nexport interface CacheEntry<T> {\n  key: string;\n  value: T;\n  createdAt: number;\n  accessedAt: number;\n  accessCount: number;\n  ttl?: number;\n  size: number;\n}\n\nexport interface CacheConfig {\n  maxSize?: number;\n  maxEntries?: number;\n  defaultTtl?: number;\n  evictionPolicy?: EvictionPolicy;\n  enableStats?: boolean;\n}\n\nexport interface CacheStats {\n  hits: number;\n  misses: number;\n  hitRate: number;\n  entryCount: number;\n  currentSize: number;\n  evictions: number;\n}\n\n// ============================================================================\n// Advanced Cache Implementation\n// ============================================================================\n\nexport class AdvancedCache<T = unknown> {\n  private cache: Map<string, CacheEntry<T>> = new Map();\n  private config: Required<CacheConfig>;\n  private stats: CacheStats = {\n    hits: 0,\n    misses: 0,\n    hitRate: 0,\n    entryCount: 0,\n    currentSize: 0,\n    evictions: 0,\n  };\n\n  constructor(config: CacheConfig = {}) {\n    this.config = {\n      maxSize: config.maxSize || 100 * 1024 * 1024,\n      maxEntries: config.maxEntries || 10000,\n      defaultTtl: config.defaultTtl || 3600000,\n      evictionPolicy: config.evictionPolicy || 'lru',\n      enableStats: config.enableStats ?? true,\n    };\n  }\n\n  get(key: string): T | undefined {\n    const entry = this.cache.get(key);\n    if (!entry) {\n      if (this.config.enableStats) {\n        this.stats.misses++;\n        this.updateHitRate();\n      }\n      return undefined;\n    }\n\n    if (entry.ttl && Date.now() - entry.createdAt > entry.ttl) {\n      this.delete(key);\n      if (this.config.enableStats) {\n        this.stats.misses++;\n        this.updateHitRate();\n      }\n      return undefined;\n    }\n\n    entry.accessedAt = Date.now();\n    entry.accessCount++;\n\n    if (this.config.enableStats) {\n      this.stats.hits++;\n      this.updateHitRate();\n    }\n\n    return entry.value;\n  }\n\n  set(key: string, value: T, ttl?: number): void {\n    const size = this.estimateSize(value);\n\n    while (this.shouldEvict(size)) {\n      this.evictOne();\n    }\n\n    const entry: CacheEntry<T> = {\n      key,\n      value,\n      createdAt: Date.now(),\n      accessedAt: Date.now(),\n      accessCount: 1,\n      ttl: ttl || this.config.defaultTtl,\n      size,\n    };\n\n    const existing = this.cache.get(key);\n    if (existing) {\n      this.stats.currentSize -= existing.size;\n    }\n    this.stats.currentSize += size;\n\n    this.cache.set(key, entry);\n    this.stats.entryCount = this.cache.size;\n  }\n\n  delete(key: string): boolean {\n    const entry = this.cache.get(key);\n    if (entry) {\n      this.stats.currentSize -= entry.size;\n      this.cache.delete(key);\n      this.stats.entryCount = this.cache.size;\n      return true;\n    }\n    return false;\n  }\n\n  has(key: string): boolean {\n    const entry = this.cache.get(key);\n    if (!entry) return false;\n    if (entry.ttl && Date.now() - entry.createdAt > entry.ttl) {\n      this.delete(key);\n      return false;\n    }\n    return true;\n  }\n\n  clear(): void {\n    this.cache.clear();\n    this.stats.currentSize = 0;\n    this.stats.entryCount = 0;\n  }\n\n  getStats(): CacheStats {\n    return { ...this.stats };\n  }\n\n  keys(): string[] {\n    return Array.from(this.cache.keys());\n  }\n\n  size(): number {\n    return this.cache.size;\n  }\n\n  prune(): number {\n    let pruned = 0;\n    const now = Date.now();\n\n    for (const [key, entry] of this.cache) {\n      if (entry.ttl && now - entry.createdAt > entry.ttl) {\n        this.delete(key);\n        pruned++;\n      }\n    }\n\n    return pruned;\n  }\n\n  private shouldEvict(newSize: number): boolean {\n    if (this.cache.size >= this.config.maxEntries) return true;\n    if (this.stats.currentSize + newSize > this.config.maxSize) return true;\n    return false;\n  }\n\n  private evictOne(): void {\n    if (this.cache.size === 0) return;\n\n    let keyToEvict: string | null = null;\n\n    switch (this.config.evictionPolicy) {\n      case 'lru':\n        keyToEvict = this.findLRU();\n        break;\n      case 'lfu':\n        keyToEvict = this.findLFU();\n        break;\n      case 'fifo':\n        keyToEvict = this.findFIFO();\n        break;\n      case 'ttl':\n        keyToEvict = this.findOldestTTL();\n        break;\n    }\n\n    if (keyToEvict) {\n      this.delete(keyToEvict);\n      this.stats.evictions++;\n    }\n  }\n\n  private findLRU(): string | null {\n    let oldest: CacheEntry<T> | null = null;\n    let oldestKey: string | null = null;\n\n    for (const [key, entry] of this.cache) {\n      if (!oldest || entry.accessedAt < oldest.accessedAt) {\n        oldest = entry;\n        oldestKey = key;\n      }\n    }\n    return oldestKey;\n  }\n\n  private findLFU(): string | null {\n    let least: CacheEntry<T> | null = null;\n    let leastKey: string | null = null;\n\n    for (const [key, entry] of this.cache) {\n      if (!least || entry.accessCount < least.accessCount) {\n        least = entry;\n        leastKey = key;\n      }\n    }\n    return leastKey;\n  }\n\n  private findFIFO(): string | null {\n    let oldest: CacheEntry<T> | null = null;\n    let oldestKey: string | null = null;\n\n    for (const [key, entry] of this.cache) {\n      if (!oldest || entry.createdAt < oldest.createdAt) {\n        oldest = entry;\n        oldestKey = key;\n      }\n    }\n    return oldestKey;\n  }\n\n  private findOldestTTL(): string | null {\n    let closest: CacheEntry<T> | null = null;\n    let closestKey: string | null = null;\n    let closestExpiry = Infinity;\n    const now = Date.now();\n\n    for (const [key, entry] of this.cache) {\n      if (entry.ttl) {\n        const expiry = entry.createdAt + entry.ttl - now;\n        if (expiry < closestExpiry) {\n          closest = entry;\n          closestKey = key;\n          closestExpiry = expiry;\n        }\n      }\n    }\n    return closestKey || this.findLRU();\n  }\n\n  private estimateSize(value: T): number {\n    try {\n      return JSON.stringify(value).length * 2;\n    } catch {\n      return 1024;\n    }\n  }\n\n  private updateHitRate(): void {\n    const total = this.stats.hits + this.stats.misses;\n    this.stats.hitRate = total > 0 ? this.stats.hits / total : 0;\n  }\n}\n\nexport function createAdvancedCache<T = unknown>(config?: CacheConfig): AdvancedCache<T> {\n  return new AdvancedCache<T>(config);\n}\n"],"names":[],"mappings":"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"}