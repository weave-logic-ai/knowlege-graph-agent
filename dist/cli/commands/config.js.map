{"version":3,"file":"config.js","sources":["../../../src/cli/commands/config.ts"],"sourcesContent":["/**\n * Config Command\n *\n * Manage knowledge graph configuration.\n */\n\nimport { Command } from 'commander';\nimport chalk from 'chalk';\nimport { createConfigManager, getDefaultConfig } from '../../config/index.js';\nimport type { KGConfiguration } from '../../config/index.js';\n\nexport function createConfigCommand(): Command {\n  const config = new Command('config')\n    .description('Manage knowledge graph configuration');\n\n  config\n    .command('show')\n    .description('Show current configuration')\n    .option('--json', 'Output as JSON')\n    .action(async (options) => {\n      try {\n        const manager = createConfigManager();\n        await manager.load();\n        const currentConfig = manager.get();\n\n        if (options.json) {\n          console.log(JSON.stringify(currentConfig, null, 2));\n        } else {\n          console.log(chalk.cyan.bold('\\nKnowledge Graph Configuration\\n'));\n          console.log(chalk.white('Database:'));\n          console.log(chalk.gray(`  Path: ${currentConfig.database.path}`));\n          console.log(chalk.gray(`  WAL Mode: ${currentConfig.database.walMode}`));\n          console.log(chalk.gray(`  Cache Size: ${currentConfig.database.cacheSize} pages`));\n\n          if (currentConfig.cache) {\n            console.log(chalk.white('\\nCache:'));\n            console.log(chalk.gray(`  Enabled: ${currentConfig.cache.enabled}`));\n            console.log(chalk.gray(`  Max Size: ${(currentConfig.cache.maxSize || 0) / (1024 * 1024)}MB`));\n            console.log(chalk.gray(`  Policy: ${currentConfig.cache.evictionPolicy}`));\n          }\n\n          if (currentConfig.logging) {\n            console.log(chalk.white('\\nLogging:'));\n            console.log(chalk.gray(`  Level: ${currentConfig.logging.level}`));\n            console.log(chalk.gray(`  Format: ${currentConfig.logging.format}`));\n          }\n\n          console.log('');\n        }\n      } catch (error) {\n        console.error(chalk.red('Error reading configuration:'), error);\n        process.exit(1);\n      }\n    });\n\n  config\n    .command('set <key> <value>')\n    .description('Set a configuration value')\n    .action(async (key: string, value: string) => {\n      try {\n        const manager = createConfigManager();\n        await manager.load();\n\n        // Parse the key path (e.g., 'database.path')\n        const parts = key.split('.');\n        const updates: Partial<KGConfiguration> = {};\n\n        if (parts[0] === 'database' && parts[1]) {\n          updates.database = { path: '', [parts[1]]: parseValue(value) } as any;\n        } else if (parts[0] === 'cache' && parts[1]) {\n          updates.cache = { enabled: true, [parts[1]]: parseValue(value) } as any;\n        } else if (parts[0] === 'logging' && parts[1]) {\n          updates.logging = { level: 'info', [parts[1]]: parseValue(value) } as any;\n        } else {\n          (updates as any)[key] = parseValue(value);\n        }\n\n        manager.update(updates);\n        await manager.save();\n\n        console.log(chalk.green(`Configuration updated: ${key} = ${value}`));\n      } catch (error) {\n        console.error(chalk.red('Error updating configuration:'), error);\n        process.exit(1);\n      }\n    });\n\n  config\n    .command('reset')\n    .description('Reset configuration to defaults')\n    .option('-y, --yes', 'Skip confirmation')\n    .action(async (options) => {\n      try {\n        const manager = createConfigManager();\n        manager.reset();\n        await manager.save();\n        console.log(chalk.green('Configuration reset to defaults'));\n      } catch (error) {\n        console.error(chalk.red('Error resetting configuration:'), error);\n        process.exit(1);\n      }\n    });\n\n  config\n    .command('validate')\n    .description('Validate current configuration')\n    .action(async () => {\n      try {\n        const manager = createConfigManager();\n        await manager.load();\n        const result = manager.validate();\n\n        if (result.valid) {\n          console.log(chalk.green('Configuration is valid'));\n        } else {\n          console.log(chalk.red('Configuration has errors:'));\n          result.errors.forEach((err: string) => {\n            console.log(chalk.yellow(`  - ${err}`));\n          });\n          process.exit(1);\n        }\n      } catch (error) {\n        console.error(chalk.red('Error validating configuration:'), error);\n        process.exit(1);\n      }\n    });\n\n  config\n    .command('defaults')\n    .description('Show default configuration values')\n    .action(() => {\n      const defaults = getDefaultConfig();\n      console.log(chalk.cyan.bold('\\nDefault Configuration:\\n'));\n      console.log(JSON.stringify(defaults, null, 2));\n    });\n\n  return config;\n}\n\nfunction parseValue(value: string): string | number | boolean {\n  if (value === 'true') return true;\n  if (value === 'false') return false;\n  const num = Number(value);\n  if (!isNaN(num)) return num;\n  return value;\n}\n"],"names":[],"mappings":"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"}