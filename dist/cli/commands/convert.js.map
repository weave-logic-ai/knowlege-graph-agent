{"version":3,"file":"convert.js","sources":["../../../src/cli/commands/convert.ts"],"sourcesContent":["/**\n * Convert Command\n *\n * Convert existing documentation to weave-nn structure.\n */\n\nimport { Command } from 'commander';\nimport chalk from 'chalk';\nimport ora from 'ora';\nimport { existsSync } from 'fs';\nimport { join } from 'path';\nimport {\n  convertDocs,\n  addFrontmatter,\n  validateFrontmatter,\n} from '../../generators/docs-convert.js';\nimport { validateProjectRoot, validateDocsPath } from '../../core/security.js';\n\n/**\n * Create convert command\n */\nexport function createConvertCommand(): Command {\n  const command = new Command('convert');\n\n  command\n    .description('Convert existing docs to weave-nn structure');\n\n  // Main convert subcommand\n  command\n    .command('docs')\n    .description('Convert existing documentation to docs-nn/ with proper structure')\n    .option('-p, --path <path>', 'Project root path', '.')\n    .option('-s, --source <dir>', 'Source docs directory', 'docs')\n    .option('-t, --target <dir>', 'Target directory', 'docs-nn')\n    .option('--no-auto-category', 'Disable auto-categorization')\n    .option('-f, --force', 'Overwrite existing files')\n    .option('--dry-run', 'Show what would be done without making changes')\n    .action(async (options) => {\n      const spinner = ora('Converting documentation...').start();\n\n      try {\n        const projectRoot = validateProjectRoot(options.path);\n        const sourceDir = options.source;\n        const targetDir = options.target;\n\n        // Check source exists\n        if (!existsSync(join(projectRoot, sourceDir))) {\n          spinner.fail(`Source directory not found: ${sourceDir}`);\n          console.log(chalk.gray('  Specify source with --source <dir>'));\n          process.exit(1);\n        }\n\n        if (options.dryRun) {\n          spinner.text = 'Analyzing documentation (dry run)...';\n        }\n\n        const result = await convertDocs({\n          sourceDir,\n          targetDir,\n          projectRoot,\n          preserveOriginal: true,\n          force: options.force,\n          autoCategory: options.autoCategory !== false,\n          dryRun: options.dryRun,\n        });\n\n        if (result.success) {\n          if (options.dryRun) {\n            spinner.succeed('Dry run complete!');\n          } else {\n            spinner.succeed('Documentation converted!');\n          }\n        } else {\n          spinner.warn('Conversion completed with errors');\n        }\n\n        console.log();\n        console.log(chalk.white('  Summary:'));\n        console.log(chalk.gray(`    Source:      ${sourceDir}/`));\n        console.log(chalk.gray(`    Target:      ${targetDir}/`));\n        console.log(chalk.green(`    Converted:   ${result.filesConverted}`));\n        console.log(chalk.yellow(`    Skipped:     ${result.filesSkipped}`));\n        console.log(chalk.gray(`    Total:       ${result.filesProcessed}`));\n\n        if (result.converted.length > 0 && result.converted.length <= 10) {\n          console.log();\n          console.log(chalk.white('  Converted files:'));\n          result.converted.forEach(({ source, target, type }) => {\n            console.log(chalk.gray(`    ${source}`));\n            console.log(chalk.cyan(`      → ${target}`) + chalk.gray(` [${type}]`));\n          });\n        } else if (result.converted.length > 10) {\n          console.log();\n          console.log(chalk.white('  Sample conversions:'));\n          result.converted.slice(0, 5).forEach(({ source, target, type }) => {\n            console.log(chalk.gray(`    ${source}`));\n            console.log(chalk.cyan(`      → ${target}`) + chalk.gray(` [${type}]`));\n          });\n          console.log(chalk.gray(`    ... and ${result.converted.length - 5} more`));\n        }\n\n        if (result.errors.length > 0) {\n          console.log();\n          console.log(chalk.red('  Errors:'));\n          result.errors.slice(0, 5).forEach(err => {\n            console.log(chalk.gray(`    - ${err}`));\n          });\n          if (result.errors.length > 5) {\n            console.log(chalk.gray(`    ... and ${result.errors.length - 5} more`));\n          }\n        }\n\n        if (!options.dryRun && result.filesConverted > 0) {\n          console.log();\n          console.log(chalk.cyan('Next steps:'));\n          console.log(chalk.white(`  1. Review ${targetDir}/ structure`));\n          console.log(chalk.white('  2. Run: kg graph --docs ' + targetDir));\n          console.log(chalk.white('  3. Run: kg stats'));\n        }\n\n        console.log();\n\n      } catch (error) {\n        spinner.fail('Conversion failed');\n        console.error(chalk.red(String(error)));\n        process.exit(1);\n      }\n    });\n\n  return command;\n}\n\n/**\n * Create frontmatter command\n */\nexport function createFrontmatterCommand(): Command {\n  const command = new Command('frontmatter');\n\n  command\n    .description('Manage frontmatter in markdown files');\n\n  // Add frontmatter\n  command\n    .command('add [target]')\n    .description('Add frontmatter to files missing it')\n    .option('-p, --path <path>', 'Project root path', '.')\n    .option('-t, --type <type>', 'Node type (concept, technical, feature, service, guide, standard, integration)')\n    .option('-s, --status <status>', 'Status (draft, active, deprecated, archived)', 'active')\n    .option('--tags <tags>', 'Comma-separated tags')\n    .option('-f, --force', 'Overwrite existing frontmatter')\n    .option('--dry-run', 'Show what would be done')\n    .action(async (target, options) => {\n      const spinner = ora('Adding frontmatter...').start();\n\n      try {\n        const projectRoot = validateProjectRoot(options.path);\n        const targetPath = target || 'docs';\n\n        const tags = options.tags ? options.tags.split(',').map((t: string) => t.trim()) : [];\n\n        const result = await addFrontmatter({\n          target: targetPath,\n          projectRoot,\n          type: options.type,\n          status: options.status,\n          tags,\n          force: options.force,\n          dryRun: options.dryRun,\n        });\n\n        if (result.success) {\n          spinner.succeed(options.dryRun ? 'Dry run complete!' : 'Frontmatter added!');\n        } else {\n          spinner.warn('Completed with errors');\n        }\n\n        console.log();\n        console.log(chalk.white('  Summary:'));\n        console.log(chalk.green(`    Updated:  ${result.filesUpdated}`));\n        console.log(chalk.yellow(`    Skipped:  ${result.filesSkipped}`));\n        console.log(chalk.gray(`    Total:    ${result.filesProcessed}`));\n\n        if (result.errors.length > 0) {\n          console.log();\n          console.log(chalk.red('  Errors:'));\n          result.errors.forEach(err => {\n            console.log(chalk.gray(`    - ${err}`));\n          });\n        }\n\n        console.log();\n\n      } catch (error) {\n        spinner.fail('Failed to add frontmatter');\n        console.error(chalk.red(String(error)));\n        process.exit(1);\n      }\n    });\n\n  // Validate frontmatter\n  command\n    .command('validate [target]')\n    .description('Validate frontmatter in markdown files')\n    .option('-p, --path <path>', 'Project root path', '.')\n    .action(async (target, options) => {\n      const spinner = ora('Validating frontmatter...').start();\n\n      try {\n        const projectRoot = validateProjectRoot(options.path);\n        const targetPath = target || 'docs';\n\n        const result = await validateFrontmatter(targetPath, projectRoot);\n\n        spinner.succeed('Validation complete!');\n\n        console.log();\n        console.log(chalk.white('  Frontmatter Validation:'));\n        console.log(chalk.green(`    Valid:    ${result.valid}`));\n        console.log(chalk.red(`    Invalid:  ${result.invalid}`));\n        console.log(chalk.yellow(`    Missing:  ${result.missing}`));\n\n        if (result.issues.length > 0) {\n          console.log();\n          console.log(chalk.yellow('  Issues found:'));\n          result.issues.slice(0, 10).forEach(({ file, issues }) => {\n            console.log(chalk.white(`    ${file}`));\n            issues.forEach(issue => {\n              console.log(chalk.gray(`      - ${issue}`));\n            });\n          });\n          if (result.issues.length > 10) {\n            console.log(chalk.gray(`    ... and ${result.issues.length - 10} more files`));\n          }\n\n          console.log();\n          console.log(chalk.cyan('Fix with: ') + chalk.white('kg frontmatter add <target>'));\n        }\n\n        console.log();\n\n      } catch (error) {\n        spinner.fail('Validation failed');\n        console.error(chalk.red(String(error)));\n        process.exit(1);\n      }\n    });\n\n  // Update frontmatter (force mode)\n  command\n    .command('update [target]')\n    .description('Update/regenerate frontmatter (overwrites existing)')\n    .option('-p, --path <path>', 'Project root path', '.')\n    .option('-t, --type <type>', 'Force specific node type')\n    .option('--dry-run', 'Show what would be done')\n    .action(async (target, options) => {\n      const spinner = ora('Updating frontmatter...').start();\n\n      try {\n        const projectRoot = validateProjectRoot(options.path);\n        const targetPath = target || 'docs';\n\n        const result = await addFrontmatter({\n          target: targetPath,\n          projectRoot,\n          type: options.type,\n          force: true,\n          dryRun: options.dryRun,\n        });\n\n        if (result.success) {\n          spinner.succeed(options.dryRun ? 'Dry run complete!' : 'Frontmatter updated!');\n        } else {\n          spinner.warn('Completed with errors');\n        }\n\n        console.log();\n        console.log(chalk.green(`  Updated: ${result.filesUpdated} files`));\n\n        if (result.errors.length > 0) {\n          console.log(chalk.red(`  Errors: ${result.errors.length}`));\n        }\n\n        console.log();\n\n      } catch (error) {\n        spinner.fail('Failed to update frontmatter');\n        console.error(chalk.red(String(error)));\n        process.exit(1);\n      }\n    });\n\n  return command;\n}\n"],"names":[],"mappings":"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"}