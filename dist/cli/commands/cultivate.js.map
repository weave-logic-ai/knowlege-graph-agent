{"version":3,"file":"cultivate.js","sources":["../../../src/cli/commands/cultivate.ts"],"sourcesContent":["/**\n * Cultivate Command - Systematically enhance the knowledge graph\n *\n * This command provides cultivation tasks:\n * - Seed primitives from codebase analysis\n * - Deep analysis with claude-flow integration\n * - Graph enhancement and optimization\n *\n * @module cli/commands/cultivate\n */\n\nimport { Command } from 'commander';\nimport chalk from 'chalk';\nimport { resolve, join, relative } from 'path';\nimport { existsSync, mkdirSync, readFileSync, readdirSync, statSync } from 'fs';\nimport { SeedGenerator } from '../../cultivation/seed-generator.js';\nimport { ShadowCache, loadShadowCache } from '../../core/cache.js';\nimport type { CultivationOptions, Ecosystem, SeedAnalysis } from '../../cultivation/types.js';\n\n/**\n * Cultivation result\n */\ninterface CultivationResult {\n  success: boolean;\n  seed: {\n    created: number;\n    documents: Array<{ title: string; path: string; type: string }>;\n  };\n  analysis: {\n    filesProcessed: number;\n    dependenciesFound: number;\n    servicesFound: number;\n  };\n  cache: {\n    updated: number;\n    hits: number;\n    misses: number;\n  };\n  duration: number;\n  warnings: string[];\n  errors: string[];\n}\n\n/**\n * Create cultivate command\n */\nexport function createCultivateCommand(): Command {\n  return new Command('cultivate')\n    .description('Systematically cultivate and enhance the knowledge graph')\n    .argument('[path]', 'Directory to cultivate (defaults to current directory)', '.')\n    .option('--dry-run', 'Preview changes without executing', false)\n    .option('-d, --docs <path>', 'Documentation path', 'docs')\n    .option('-v, --verbose', 'Verbose output', false)\n    .option('--seed', 'Bootstrap vault with primitives from codebase analysis', false)\n    .option('--deep-analysis', 'Use claude-flow agents for deep analysis', false)\n    .option('--cache', 'Use shadow cache for incremental updates', true)\n    .option('--ecosystem <ecosystems>', 'Filter to specific ecosystems (comma-separated)', undefined)\n    .option('--include-dev', 'Include dev dependencies', false)\n    .option('--major-only', 'Only process major dependencies', false)\n    .option('--refresh-cache', 'Force refresh the shadow cache', false)\n    .action(async (targetPath: string, options: {\n      dryRun?: boolean;\n      docs?: string;\n      verbose?: boolean;\n      seed?: boolean;\n      deepAnalysis?: boolean;\n      cache?: boolean;\n      ecosystem?: string;\n      includeDev?: boolean;\n      majorOnly?: boolean;\n      refreshCache?: boolean;\n    }) => {\n      const projectRoot = resolve(targetPath);\n      const docsPath = options.docs || 'docs';\n      const verbose = options.verbose || false;\n      const dryRun = options.dryRun || false;\n\n      console.log(chalk.bold.green('\\nüå± Knowledge Graph Cultivator\\n'));\n      console.log(`  Project: ${projectRoot}`);\n      console.log(`  Docs: ${docsPath}`);\n      if (dryRun) {\n        console.log(`  Mode: ${chalk.yellow('Dry Run')}`);\n      }\n      console.log('');\n\n      // Determine tasks\n      const tasks = {\n        seed: options.seed || false,\n        deepAnalysis: options.deepAnalysis || false,\n      };\n\n      // If no tasks selected, show help\n      if (!tasks.seed && !tasks.deepAnalysis) {\n        console.log(chalk.yellow('üí° No tasks selected. Use one or more of:'));\n        console.log('  --seed           Bootstrap vault with primitives from codebase');\n        console.log('  --deep-analysis  Use claude-flow for deep codebase analysis');\n        console.log('');\n        console.log(chalk.gray('Options:'));\n        console.log('  --dry-run        Preview without writing files');\n        console.log('  --cache          Use shadow cache for incremental updates (default: true)');\n        console.log('  --refresh-cache  Force refresh the shadow cache');\n        console.log('  --ecosystem      Filter to ecosystems (nodejs,python,rust,go,php,java)');\n        console.log('  --include-dev    Include dev dependencies');\n        console.log('  --major-only     Only process major dependencies');\n        console.log('');\n        console.log('Run \"kg cultivate --help\" for more options');\n        return;\n      }\n\n      const startTime = Date.now();\n      const result: CultivationResult = {\n        success: true,\n        seed: { created: 0, documents: [] },\n        analysis: { filesProcessed: 0, dependenciesFound: 0, servicesFound: 0 },\n        cache: { updated: 0, hits: 0, misses: 0 },\n        duration: 0,\n        warnings: [],\n        errors: [],\n      };\n\n      try {\n        // Initialize shadow cache\n        let cache: ShadowCache | undefined;\n        if (options.cache !== false) {\n          console.log(chalk.cyan('üì¶ Initializing shadow cache...'));\n          cache = await loadShadowCache(projectRoot);\n\n          if (options.refreshCache) {\n            cache.clear();\n            console.log(chalk.gray('  Cache cleared (refresh mode)'));\n          }\n\n          const stats = cache.getStats();\n          console.log(chalk.gray(`  Entries: ${stats.totalEntries}, Hit rate: ${(stats.hitRate * 100).toFixed(1)}%`));\n          console.log('');\n        }\n\n        // Task 1: Seed primitives\n        if (tasks.seed) {\n          console.log(chalk.cyan('üå± Seeding primitives from codebase...\\n'));\n\n          // Parse ecosystem filter\n          let ecosystems: Ecosystem[] | undefined;\n          if (options.ecosystem) {\n            ecosystems = options.ecosystem.split(',').map(e => e.trim() as Ecosystem);\n            console.log(chalk.gray(`  Ecosystems: ${ecosystems.join(', ')}`));\n          }\n\n          // Create generator\n          const generator = await SeedGenerator.create(projectRoot, docsPath);\n\n          // Analyze\n          console.log(chalk.gray('  Analyzing codebase...'));\n          const analysis = await generator.analyze();\n\n          result.analysis = {\n            filesProcessed: analysis.metadata.filesScanned,\n            dependenciesFound: analysis.dependencies.length,\n            servicesFound: analysis.services.length,\n          };\n\n          // Display analysis\n          console.log(`\\n  ${chalk.bold('Analysis Results:')}`);\n          console.log(`    Languages: ${analysis.languages.join(', ') || 'none'}`);\n          console.log(`    Dependencies: ${analysis.dependencies.length}`);\n          console.log(`    Frameworks: ${analysis.frameworks.length}`);\n          console.log(`    Services: ${analysis.services.length}`);\n          console.log(`    Deployments: ${analysis.deployments.length}`);\n\n          if (verbose) {\n            displayDetailedAnalysis(analysis);\n          }\n\n          console.log('');\n\n          // Generate primitives\n          console.log(chalk.gray('  Generating primitive nodes...'));\n          const documents = await generator.generatePrimitives(analysis);\n\n          if (dryRun) {\n            console.log(`\\n  ${chalk.yellow('[DRY RUN]')} Would create ${documents.length} primitives:`);\n            for (const doc of documents.slice(0, 10)) {\n              console.log(`    - ${doc.frontmatter.type}: ${doc.title}`);\n            }\n            if (documents.length > 10) {\n              console.log(`    ... and ${documents.length - 10} more`);\n            }\n            result.seed.documents = documents.map(d => ({\n              title: d.title,\n              path: d.path,\n              type: d.frontmatter.type || 'unknown',\n            }));\n          } else {\n            const writeResult = await generator.writePrimitives(documents);\n            result.seed.created = writeResult.documentsGenerated.length;\n            result.seed.documents = writeResult.documentsGenerated;\n\n            console.log(`\\n  ${chalk.green('‚úì')} Created ${writeResult.documentsGenerated.length} primitives`);\n\n            if (writeResult.warnings.length > 0) {\n              result.warnings.push(...writeResult.warnings);\n              if (verbose) {\n                console.log(chalk.yellow(`  Warnings: ${writeResult.warnings.length}`));\n              }\n            }\n\n            if (writeResult.errors.length > 0) {\n              result.errors.push(...writeResult.errors);\n              console.log(chalk.red(`  Errors: ${writeResult.errors.length}`));\n            }\n          }\n\n          console.log('');\n        }\n\n        // Task 2: Deep Analysis with claude-flow\n        if (tasks.deepAnalysis) {\n          console.log(chalk.cyan('üß† Running deep analysis with claude-flow...\\n'));\n\n          // Check if claude-flow is available\n          const hasClaudeFlow = await checkClaudeFlowAvailable();\n\n          if (!hasClaudeFlow) {\n            console.log(chalk.yellow('  ‚ö†Ô∏è  claude-flow not available'));\n            console.log(chalk.gray('  Install with: npm install -g claude-flow@alpha'));\n            result.warnings.push('claude-flow not available for deep analysis');\n          } else {\n            if (dryRun) {\n              console.log(chalk.yellow('  [DRY RUN] Would spawn claude-flow agents:'));\n              console.log('    - Researcher: Analyze codebase patterns');\n              console.log('    - Analyst: Identify architectural decisions');\n              console.log('    - Coder: Detect implementation patterns');\n              console.log('    - Tester: Analyze testing coverage');\n            } else {\n              // Import and run DeepAnalyzer\n              try {\n                const { DeepAnalyzer } = await import('../../cultivation/deep-analyzer.js');\n                const analyzer = new DeepAnalyzer({\n                  projectRoot,\n                  docsPath,\n                  verbose,\n                });\n\n                const deepResult = await analyzer.analyze();\n\n                console.log(`  ${chalk.green('‚úì')} Deep analysis complete`);\n                console.log(`    Agents spawned: ${deepResult.agentsSpawned}`);\n                console.log(`    Insights generated: ${deepResult.insightsCount}`);\n                console.log(`    Documentation created: ${deepResult.documentsCreated}`);\n              } catch (error) {\n                result.errors.push(`Deep analysis failed: ${error instanceof Error ? error.message : String(error)}`);\n                console.log(chalk.red(`  ‚úó Deep analysis failed: ${error instanceof Error ? error.message : String(error)}`));\n              }\n            }\n          }\n\n          console.log('');\n        }\n\n        // Update cache\n        if (cache) {\n          const stats = cache.getStats();\n          result.cache = {\n            updated: stats.totalEntries,\n            hits: stats.hitCount,\n            misses: stats.missCount,\n          };\n\n          await cache.save();\n        }\n\n        result.duration = Date.now() - startTime;\n        result.success = result.errors.length === 0;\n\n        // Final summary\n        displaySummary(result, dryRun);\n\n      } catch (error) {\n        console.error(chalk.red('\\n‚ùå Cultivation failed:'), error);\n        process.exit(1);\n      }\n    });\n}\n\n/**\n * Display detailed analysis output\n */\nfunction displayDetailedAnalysis(analysis: SeedAnalysis): void {\n  if (analysis.frameworks.length > 0) {\n    console.log(`\\n    ${chalk.gray('Frameworks:')}`);\n    for (const fw of analysis.frameworks) {\n      console.log(`      - ${fw.name} (${fw.ecosystem}) v${fw.version}`);\n    }\n  }\n\n  if (analysis.services.length > 0) {\n    console.log(`\\n    ${chalk.gray('Services:')}`);\n    for (const svc of analysis.services) {\n      console.log(`      - ${svc.name}: ${svc.type} (${svc.technology})`);\n    }\n  }\n\n  if (analysis.deployments.length > 0) {\n    console.log(`\\n    ${chalk.gray('Deployments:')}`);\n    for (const dep of analysis.deployments) {\n      console.log(`      - ${dep}`);\n    }\n  }\n}\n\n/**\n * Display cultivation summary\n */\nfunction displaySummary(result: CultivationResult, dryRun: boolean): void {\n  console.log(chalk.bold.blue('üìä Cultivation Summary\\n'));\n\n  if (dryRun) {\n    console.log(chalk.yellow('[DRY RUN] No changes were made\\n'));\n  }\n\n  console.log('  Analysis:');\n  console.log(`    Files processed: ${result.analysis.filesProcessed}`);\n  console.log(`    Dependencies: ${result.analysis.dependenciesFound}`);\n  console.log(`    Services: ${result.analysis.servicesFound}`);\n\n  if (result.seed.created > 0 || result.seed.documents.length > 0) {\n    console.log('\\n  Seed:');\n    console.log(`    Primitives ${dryRun ? 'would create' : 'created'}: ${dryRun ? result.seed.documents.length : result.seed.created}`);\n  }\n\n  if (result.cache.updated > 0) {\n    console.log('\\n  Cache:');\n    console.log(`    Entries: ${result.cache.updated}`);\n    const hitRate = result.cache.hits + result.cache.misses > 0\n      ? (result.cache.hits / (result.cache.hits + result.cache.misses) * 100).toFixed(1)\n      : 0;\n    console.log(`    Hit rate: ${hitRate}%`);\n  }\n\n  console.log(`\\n  Duration: ${(result.duration / 1000).toFixed(2)}s`);\n\n  if (result.warnings.length > 0) {\n    console.log(chalk.yellow(`\\n  ‚ö†Ô∏è  Warnings: ${result.warnings.length}`));\n    for (const warning of result.warnings.slice(0, 5)) {\n      console.log(chalk.gray(`    - ${warning}`));\n    }\n  }\n\n  if (result.errors.length > 0) {\n    console.log(chalk.red(`\\n  ‚ùå Errors: ${result.errors.length}`));\n    for (const error of result.errors.slice(0, 5)) {\n      console.log(chalk.gray(`    - ${error}`));\n    }\n  }\n\n  if (result.success && !dryRun) {\n    console.log(chalk.bold.green('\\n‚ú® Cultivation complete!\\n'));\n  } else if (!result.success) {\n    console.log(chalk.yellow('\\n‚ö†Ô∏è  Cultivation completed with errors\\n'));\n  } else {\n    console.log(chalk.gray('\\nRun without --dry-run to apply changes\\n'));\n  }\n}\n\n/**\n * Check if claude-flow is available\n */\nasync function checkClaudeFlowAvailable(): Promise<boolean> {\n  try {\n    const { execSync } = await import('child_process');\n    execSync('npx claude-flow@alpha --version', { stdio: 'pipe', timeout: 5000 });\n    return true;\n  } catch {\n    return false;\n  }\n}\n"],"names":[],"mappings":"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"}