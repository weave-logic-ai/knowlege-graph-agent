{"version":3,"file":"add-frontmatter.js","sources":["../../../../src/cli/commands/hive-mind/add-frontmatter.ts"],"sourcesContent":["/**\n * Hive Mind - Frontmatter Enricher\n *\n * Adds or enriches YAML frontmatter in markdown files to improve discoverability\n * and enable better linking between documents.\n *\n * SPEC-003: Hive Mind Reconnection Tools\n */\n\nimport { Command } from 'commander';\nimport chalk from 'chalk';\nimport * as path from 'path';\nimport { readFile, writeFile } from 'fs/promises';\nimport { glob } from 'fast-glob';\nimport matter from 'gray-matter';\nimport * as yaml from 'js-yaml';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface EnrichOptions {\n  overwrite?: boolean;\n  tags?: boolean;\n  aliases?: boolean;\n  links?: boolean;\n  dryRun?: boolean;\n  output?: string;\n  json?: boolean;\n  verbose?: boolean;\n}\n\nexport interface FrontmatterTemplate {\n  title: string;\n  created: string;\n  modified: string;\n  tags: string[];\n  aliases: string[];\n  links: string[];\n  type: string;\n  status: string;\n  description?: string;\n}\n\nexport interface EnrichedFile {\n  file: string;\n  added: string[];\n  updated: string[];\n  frontmatter: FrontmatterTemplate;\n}\n\nexport interface EnrichResult {\n  enriched: EnrichedFile[];\n  skipped: string[];\n  errors: Array<{ file: string; error: string }>;\n  statistics: {\n    totalFiles: number;\n    enrichedCount: number;\n    skippedCount: number;\n    errorCount: number;\n    tagsAdded: number;\n    aliasesAdded: number;\n    linksExtracted: number;\n  };\n}\n\n// ============================================================================\n// Frontmatter Enricher Class\n// ============================================================================\n\nexport class FrontmatterEnricher {\n  /**\n   * Enrich frontmatter for all files in a vault\n   */\n  async enrichVault(vaultPath: string, options: EnrichOptions = {}): Promise<EnrichResult> {\n    const resolvedPath = path.resolve(vaultPath);\n\n    // Find all markdown files\n    const files = await glob('**/*.md', {\n      cwd: resolvedPath,\n      ignore: ['node_modules/**', '.git/**', 'dist/**'],\n      absolute: false,\n    });\n\n    if (files.length === 0) {\n      throw new Error(`No markdown files found in: ${resolvedPath}`);\n    }\n\n    const enriched: EnrichedFile[] = [];\n    const skipped: string[] = [];\n    const errors: Array<{ file: string; error: string }> = [];\n    let tagsAdded = 0;\n    let aliasesAdded = 0;\n    let linksExtracted = 0;\n\n    for (const file of files) {\n      try {\n        const result = await this.enrichFile(\n          path.join(resolvedPath, file),\n          file,\n          options\n        );\n\n        if (result) {\n          enriched.push(result);\n          tagsAdded += result.frontmatter.tags.length;\n          aliasesAdded += result.frontmatter.aliases.length;\n          linksExtracted += result.frontmatter.links.length;\n        } else {\n          skipped.push(file);\n        }\n      } catch (error) {\n        errors.push({\n          file,\n          error: error instanceof Error ? error.message : 'Unknown error',\n        });\n      }\n    }\n\n    return {\n      enriched,\n      skipped,\n      errors,\n      statistics: {\n        totalFiles: files.length,\n        enrichedCount: enriched.length,\n        skippedCount: skipped.length,\n        errorCount: errors.length,\n        tagsAdded,\n        aliasesAdded,\n        linksExtracted,\n      },\n    };\n  }\n\n  /**\n   * Enrich a single file's frontmatter\n   */\n  async enrichFile(\n    filePath: string,\n    relativePath: string,\n    options: EnrichOptions\n  ): Promise<EnrichedFile | null> {\n    const content = await readFile(filePath, 'utf-8');\n    const parsed = matter(content);\n\n    const existingFm = parsed.data as Partial<FrontmatterTemplate>;\n    const hasExistingFm = Object.keys(existingFm).length > 0;\n\n    // Skip if has frontmatter and not overwriting\n    if (hasExistingFm && !options.overwrite) {\n      // Check if we need to add anything\n      const needsTags = options.tags && (!existingFm.tags || existingFm.tags.length === 0);\n      const needsAliases = options.aliases && (!existingFm.aliases || existingFm.aliases.length === 0);\n      const needsLinks = options.links && (!existingFm.links || existingFm.links.length === 0);\n\n      if (!needsTags && !needsAliases && !needsLinks && existingFm.title) {\n        return null;\n      }\n    }\n\n    // Extract metadata from content\n    const metadata = this.extractMetadata(parsed.content, relativePath);\n\n    // Build new frontmatter\n    const added: string[] = [];\n    const updated: string[] = [];\n    const newFm: FrontmatterTemplate = {\n      title: existingFm.title || metadata.title,\n      created: existingFm.created || metadata.created,\n      modified: new Date().toISOString().split('T')[0],\n      tags: [],\n      aliases: [],\n      links: [],\n      type: existingFm.type || metadata.type,\n      status: existingFm.status || 'active',\n    };\n\n    // Track what was added/updated\n    if (!existingFm.title) added.push('title');\n    if (!existingFm.created) added.push('created');\n    if (!existingFm.type) added.push('type');\n    if (!existingFm.status) added.push('status');\n    updated.push('modified');\n\n    // Handle tags\n    if (options.tags !== false) {\n      const existingTags = existingFm.tags || [];\n      const extractedTags = metadata.tags;\n      const mergedTags = [...new Set([...existingTags, ...extractedTags])];\n      newFm.tags = mergedTags;\n\n      const newTagCount = mergedTags.length - existingTags.length;\n      if (newTagCount > 0) added.push(`${newTagCount} tags`);\n    }\n\n    // Handle aliases\n    if (options.aliases !== false) {\n      const existingAliases = existingFm.aliases || [];\n      const extractedAliases = metadata.aliases;\n      const mergedAliases = [...new Set([...existingAliases, ...extractedAliases])];\n      newFm.aliases = mergedAliases;\n\n      const newAliasCount = mergedAliases.length - existingAliases.length;\n      if (newAliasCount > 0) added.push(`${newAliasCount} aliases`);\n    }\n\n    // Handle links\n    if (options.links !== false) {\n      const existingLinks = existingFm.links || [];\n      const extractedLinks = metadata.links;\n      const mergedLinks = [...new Set([...existingLinks, ...extractedLinks])];\n      newFm.links = mergedLinks;\n\n      const newLinkCount = mergedLinks.length - existingLinks.length;\n      if (newLinkCount > 0) added.push(`${newLinkCount} links`);\n    }\n\n    // Add description if missing\n    if (!existingFm.description && metadata.description) {\n      newFm.description = metadata.description;\n      added.push('description');\n    }\n\n    // Write file if not dry run\n    if (!options.dryRun) {\n      const newContent = this.buildMarkdownWithFrontmatter(newFm, parsed.content);\n      await writeFile(filePath, newContent);\n    }\n\n    return {\n      file: relativePath,\n      added,\n      updated,\n      frontmatter: newFm,\n    };\n  }\n\n  /**\n   * Extract metadata from content and filename\n   */\n  private extractMetadata(content: string, filename: string): {\n    title: string;\n    created: string;\n    type: string;\n    tags: string[];\n    aliases: string[];\n    links: string[];\n    description?: string;\n  } {\n    const basename = path.basename(filename, '.md');\n\n    // Extract title from first heading or filename\n    let title = basename;\n    const headingMatch = content.match(/^#\\s+(.+)$/m);\n    if (headingMatch) {\n      title = headingMatch[1].trim();\n    }\n\n    // Generate aliases from title variations\n    const aliases = this.generateAliases(title, basename);\n\n    // Extract tags from hashtags in content\n    const tags = this.extractHashtags(content);\n\n    // Infer type from content and filename\n    const type = this.inferType(content, basename);\n\n    // Extract wiki-links\n    const links = this.extractWikiLinks(content);\n\n    // Extract first paragraph as description\n    const description = this.extractDescription(content);\n\n    // Use current date for created\n    const created = new Date().toISOString().split('T')[0];\n\n    return { title, created, type, tags, aliases, links, description };\n  }\n\n  /**\n   * Generate aliases from title\n   */\n  private generateAliases(title: string, filename: string): string[] {\n    const aliases: string[] = [];\n\n    // Add filename if different from title\n    const cleanFilename = filename.replace(/-/g, ' ').toLowerCase();\n    const cleanTitle = title.toLowerCase();\n    if (cleanFilename !== cleanTitle) {\n      // Convert filename to readable form\n      const readableFilename = filename\n        .replace(/-/g, ' ')\n        .replace(/\\b\\w/g, c => c.toUpperCase());\n      if (readableFilename !== title) {\n        aliases.push(readableFilename);\n      }\n    }\n\n    // Add lowercase version if title has caps\n    if (title !== title.toLowerCase() && !aliases.includes(title.toLowerCase())) {\n      aliases.push(title.toLowerCase());\n    }\n\n    // Add acronym if title has multiple words\n    const words = title.split(/\\s+/);\n    if (words.length >= 2 && words.length <= 5) {\n      const acronym = words\n        .map(w => w[0])\n        .filter(c => c && /[A-Z]/.test(c))\n        .join('');\n      if (acronym.length >= 2 && !aliases.includes(acronym)) {\n        aliases.push(acronym);\n      }\n    }\n\n    return aliases.slice(0, 5); // Limit to 5 aliases\n  }\n\n  /**\n   * Extract hashtags from content\n   */\n  private extractHashtags(content: string): string[] {\n    const tags = new Set<string>();\n\n    // Match #tag patterns (but not #headings)\n    const regex = /(?:^|\\s)#([a-zA-Z][a-zA-Z0-9_-]*)/g;\n    let match;\n\n    while ((match = regex.exec(content)) !== null) {\n      const tag = match[1].toLowerCase();\n      if (tag.length > 1 && tag.length < 30) {\n        tags.add(tag);\n      }\n    }\n\n    // Also infer tags from content keywords\n    const inferredTags = this.inferTagsFromContent(content);\n    for (const tag of inferredTags) {\n      tags.add(tag);\n    }\n\n    return Array.from(tags).slice(0, 10); // Limit to 10 tags\n  }\n\n  /**\n   * Infer tags from content analysis\n   */\n  private inferTagsFromContent(content: string): string[] {\n    const tags: string[] = [];\n    const lowerContent = content.toLowerCase();\n\n    // Common topic patterns\n    const patterns: Array<{ pattern: RegExp; tag: string }> = [\n      { pattern: /\\b(api|endpoint|rest|graphql)\\b/i, tag: 'api' },\n      { pattern: /\\b(database|sql|postgres|mysql|mongo)\\b/i, tag: 'database' },\n      { pattern: /\\b(test|testing|jest|vitest|unittest)\\b/i, tag: 'testing' },\n      { pattern: /\\b(docker|container|kubernetes|k8s)\\b/i, tag: 'devops' },\n      { pattern: /\\b(security|auth|authentication|oauth)\\b/i, tag: 'security' },\n      { pattern: /\\b(performance|optimization|cache)\\b/i, tag: 'performance' },\n      { pattern: /\\b(react|vue|angular|frontend)\\b/i, tag: 'frontend' },\n      { pattern: /\\b(node|express|backend|server)\\b/i, tag: 'backend' },\n      { pattern: /\\b(typescript|javascript|python|rust)\\b/i, tag: 'programming' },\n      { pattern: /\\b(guide|tutorial|howto|how-to)\\b/i, tag: 'guide' },\n      { pattern: /\\b(architecture|design|pattern)\\b/i, tag: 'architecture' },\n      { pattern: /\\b(config|configuration|setup)\\b/i, tag: 'configuration' },\n    ];\n\n    for (const { pattern, tag } of patterns) {\n      if (pattern.test(lowerContent)) {\n        tags.push(tag);\n      }\n    }\n\n    return tags;\n  }\n\n  /**\n   * Infer document type from content\n   */\n  private inferType(content: string, filename: string): string {\n    const lowerContent = content.toLowerCase();\n    const lowerFilename = filename.toLowerCase();\n\n    // Check filename patterns\n    if (lowerFilename.includes('readme') || lowerFilename.includes('index')) {\n      return 'guide';\n    }\n    if (lowerFilename.includes('api') || lowerFilename.includes('endpoint')) {\n      return 'technical';\n    }\n    if (lowerFilename.includes('standard') || lowerFilename.includes('convention')) {\n      return 'standard';\n    }\n\n    // Check content patterns\n    if (/```[a-z]+\\n/i.test(content)) {\n      return 'technical';\n    }\n    if (/##\\s*installation|##\\s*getting started|##\\s*usage/i.test(content)) {\n      return 'guide';\n    }\n    if (/##\\s*api|##\\s*endpoints|##\\s*methods/i.test(content)) {\n      return 'technical';\n    }\n    if (/##\\s*overview|##\\s*introduction|##\\s*background/i.test(content)) {\n      return 'concept';\n    }\n\n    return 'concept'; // Default type\n  }\n\n  /**\n   * Extract wiki-links from content\n   */\n  private extractWikiLinks(content: string): string[] {\n    const links = new Set<string>();\n    const regex = /\\[\\[([^\\]|#]+)(?:#[^\\]|]*)?(?:\\|[^\\]]+)?\\]\\]/g;\n    let match;\n\n    while ((match = regex.exec(content)) !== null) {\n      const link = match[1].trim();\n      if (link) {\n        links.add(link);\n      }\n    }\n\n    return Array.from(links);\n  }\n\n  /**\n   * Extract first paragraph as description\n   */\n  private extractDescription(content: string): string | undefined {\n    // Skip headings and find first paragraph\n    const lines = content.split('\\n');\n    let foundContent = false;\n    const paragraphLines: string[] = [];\n\n    for (const line of lines) {\n      const trimmed = line.trim();\n\n      // Skip empty lines at start\n      if (!foundContent && !trimmed) continue;\n\n      // Skip headings\n      if (trimmed.startsWith('#')) {\n        if (foundContent) break;\n        continue;\n      }\n\n      // Skip code blocks\n      if (trimmed.startsWith('```')) continue;\n\n      // Found content\n      if (trimmed) {\n        foundContent = true;\n        paragraphLines.push(trimmed);\n      } else if (foundContent) {\n        // End of paragraph\n        break;\n      }\n    }\n\n    const description = paragraphLines.join(' ').slice(0, 200);\n    return description || undefined;\n  }\n\n  /**\n   * Build markdown content with frontmatter\n   */\n  private buildMarkdownWithFrontmatter(fm: FrontmatterTemplate, content: string): string {\n    // Clean frontmatter - remove empty arrays and undefined values\n    const cleanFm: Record<string, unknown> = {};\n\n    if (fm.title) cleanFm.title = fm.title;\n    if (fm.description) cleanFm.description = fm.description;\n    if (fm.type) cleanFm.type = fm.type;\n    if (fm.status) cleanFm.status = fm.status;\n    if (fm.created) cleanFm.created = fm.created;\n    if (fm.modified) cleanFm.modified = fm.modified;\n    if (fm.tags && fm.tags.length > 0) cleanFm.tags = fm.tags;\n    if (fm.aliases && fm.aliases.length > 0) cleanFm.aliases = fm.aliases;\n    if (fm.links && fm.links.length > 0) cleanFm.links = fm.links;\n\n    const yamlStr = yaml.dump(cleanFm, {\n      lineWidth: -1,\n      quotingType: '\"',\n      forceQuotes: false,\n    });\n\n    return `---\\n${yamlStr}---\\n\\n${content.trim()}\\n`;\n  }\n\n  /**\n   * Generate report\n   */\n  generateReport(result: EnrichResult): string {\n    const lines: string[] = [];\n\n    lines.push('# Frontmatter Enrichment Report\\n');\n    lines.push(`Generated: ${new Date().toISOString()}\\n`);\n    lines.push('');\n\n    lines.push('## Summary\\n');\n    lines.push(`| Metric | Value |`);\n    lines.push(`|--------|-------|`);\n    lines.push(`| Total Files | ${result.statistics.totalFiles} |`);\n    lines.push(`| Enriched | ${result.statistics.enrichedCount} |`);\n    lines.push(`| Skipped | ${result.statistics.skippedCount} |`);\n    lines.push(`| Errors | ${result.statistics.errorCount} |`);\n    lines.push(`| Tags Added | ${result.statistics.tagsAdded} |`);\n    lines.push(`| Aliases Added | ${result.statistics.aliasesAdded} |`);\n    lines.push(`| Links Extracted | ${result.statistics.linksExtracted} |`);\n    lines.push('');\n\n    if (result.enriched.length > 0) {\n      lines.push('## Enriched Files\\n');\n      for (const { file, added } of result.enriched.slice(0, 50)) {\n        if (added.length > 0) {\n          lines.push(`- \\`${file}\\`: ${added.join(', ')}`);\n        }\n      }\n      if (result.enriched.length > 50) {\n        lines.push(`\\n*... and ${result.enriched.length - 50} more*`);\n      }\n      lines.push('');\n    }\n\n    if (result.errors.length > 0) {\n      lines.push('## Errors\\n');\n      for (const { file, error } of result.errors) {\n        lines.push(`- \\`${file}\\`: ${error}`);\n      }\n      lines.push('');\n    }\n\n    return lines.join('\\n');\n  }\n}\n\n// ============================================================================\n// CLI Command\n// ============================================================================\n\nexport function createAddFrontmatterCommand(): Command {\n  const command = new Command('add-frontmatter')\n    .description('Add/enrich YAML frontmatter in markdown files')\n    .argument('<vault-path>', 'Path to Obsidian vault or docs directory')\n    .option('--overwrite', 'Overwrite existing frontmatter fields')\n    .option('--tags', 'Auto-generate tags from content (default: true)')\n    .option('--no-tags', 'Skip tag generation')\n    .option('--aliases', 'Generate aliases from title (default: true)')\n    .option('--no-aliases', 'Skip alias generation')\n    .option('--links', 'Extract wiki-links to frontmatter (default: true)')\n    .option('--no-links', 'Skip link extraction')\n    .option('--dry-run', 'Preview changes without writing files')\n    .option('-o, --output <file>', 'Output file for report')\n    .option('--json', 'Output as JSON')\n    .option('-v, --verbose', 'Show detailed output')\n    .action(async (vaultPath: string, options: EnrichOptions) => {\n      const enricher = new FrontmatterEnricher();\n\n      const mode = options.dryRun ? ' (dry run)' : '';\n      console.log(chalk.cyan(`\\nEnriching frontmatter${mode}...\\n`));\n\n      try {\n        const result = await enricher.enrichVault(vaultPath, options);\n\n        if (options.json) {\n          if (options.output) {\n            await writeFile(options.output, JSON.stringify(result, null, 2));\n            console.log(chalk.green(`Results written to: ${options.output}`));\n          } else {\n            console.log(JSON.stringify(result, null, 2));\n          }\n        } else {\n          // Display summary\n          console.log(chalk.bold('Summary:'));\n          console.log(chalk.white(`  Total Files:      ${result.statistics.totalFiles}`));\n          console.log(chalk.green(`  Enriched:         ${result.statistics.enrichedCount}`));\n          console.log(chalk.gray(`  Skipped:          ${result.statistics.skippedCount}`));\n          if (result.statistics.errorCount > 0) {\n            console.log(chalk.red(`  Errors:           ${result.statistics.errorCount}`));\n          }\n          console.log('');\n\n          console.log(chalk.bold('Additions:'));\n          console.log(chalk.white(`  Tags Added:       ${result.statistics.tagsAdded}`));\n          console.log(chalk.white(`  Aliases Added:    ${result.statistics.aliasesAdded}`));\n          console.log(chalk.white(`  Links Extracted:  ${result.statistics.linksExtracted}`));\n          console.log('');\n\n          if (options.verbose && result.enriched.length > 0) {\n            console.log(chalk.bold('Enriched Files:'));\n            for (const { file, added } of result.enriched.slice(0, 20)) {\n              if (added.length > 0) {\n                console.log(chalk.green(`  ${file}`));\n                console.log(chalk.gray(`    Added: ${added.join(', ')}`));\n              }\n            }\n            if (result.enriched.length > 20) {\n              console.log(chalk.gray(`  ... and ${result.enriched.length - 20} more`));\n            }\n            console.log('');\n          }\n\n          if (result.errors.length > 0) {\n            console.log(chalk.bold(chalk.red('Errors:')));\n            for (const { file, error } of result.errors.slice(0, 10)) {\n              console.log(chalk.red(`  ${file}: ${error}`));\n            }\n            if (result.errors.length > 10) {\n              console.log(chalk.gray(`  ... and ${result.errors.length - 10} more`));\n            }\n            console.log('');\n          }\n\n          // Write report if output specified\n          if (options.output && !options.json) {\n            const report = enricher.generateReport(result);\n            await writeFile(options.output, report);\n            console.log(chalk.green(`Report written to: ${options.output}`));\n          }\n\n          // Show dry-run notice\n          if (options.dryRun) {\n            console.log(chalk.yellow('Dry run complete - no files were modified.'));\n            console.log(chalk.gray('Remove --dry-run to apply changes.\\n'));\n          }\n        }\n      } catch (error) {\n        console.error(chalk.red('Error:'), error instanceof Error ? error.message : 'Unknown error');\n        process.exit(1);\n      }\n    });\n\n  return command;\n}\n\nexport default createAddFrontmatterCommand;\n"],"names":[],"mappings":";;;;;;;AAsEO,MAAM,oBAAoB;AAAA;AAAA;AAAA;AAAA,EAI/B,MAAM,YAAY,WAAmB,UAAyB,IAA2B;AACvF,UAAM,eAAe,KAAK,QAAQ,SAAS;AAG3C,UAAM,QAAQ,MAAM,KAAK,WAAW;AAAA,MAClC,KAAK;AAAA,MACL,QAAQ,CAAC,mBAAmB,WAAW,SAAS;AAAA,MAChD,UAAU;AAAA,IAAA,CACX;AAED,QAAI,MAAM,WAAW,GAAG;AACtB,YAAM,IAAI,MAAM,+BAA+B,YAAY,EAAE;AAAA,IAC/D;AAEA,UAAM,WAA2B,CAAA;AACjC,UAAM,UAAoB,CAAA;AAC1B,UAAM,SAAiD,CAAA;AACvD,QAAI,YAAY;AAChB,QAAI,eAAe;AACnB,QAAI,iBAAiB;AAErB,eAAW,QAAQ,OAAO;AACxB,UAAI;AACF,cAAM,SAAS,MAAM,KAAK;AAAA,UACxB,KAAK,KAAK,cAAc,IAAI;AAAA,UAC5B;AAAA,UACA;AAAA,QAAA;AAGF,YAAI,QAAQ;AACV,mBAAS,KAAK,MAAM;AACpB,uBAAa,OAAO,YAAY,KAAK;AACrC,0BAAgB,OAAO,YAAY,QAAQ;AAC3C,4BAAkB,OAAO,YAAY,MAAM;AAAA,QAC7C,OAAO;AACL,kBAAQ,KAAK,IAAI;AAAA,QACnB;AAAA,MACF,SAAS,OAAO;AACd,eAAO,KAAK;AAAA,UACV;AAAA,UACA,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,QAAA,CACjD;AAAA,MACH;AAAA,IACF;AAEA,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA,YAAY;AAAA,QACV,YAAY,MAAM;AAAA,QAClB,eAAe,SAAS;AAAA,QACxB,cAAc,QAAQ;AAAA,QACtB,YAAY,OAAO;AAAA,QACnB;AAAA,QACA;AAAA,QACA;AAAA,MAAA;AAAA,IACF;AAAA,EAEJ;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,WACJ,UACA,cACA,SAC8B;AAC9B,UAAM,UAAU,MAAM,SAAS,UAAU,OAAO;AAChD,UAAM,SAAS,OAAO,OAAO;AAE7B,UAAM,aAAa,OAAO;AAC1B,UAAM,gBAAgB,OAAO,KAAK,UAAU,EAAE,SAAS;AAGvD,QAAI,iBAAiB,CAAC,QAAQ,WAAW;AAEvC,YAAM,YAAY,QAAQ,SAAS,CAAC,WAAW,QAAQ,WAAW,KAAK,WAAW;AAClF,YAAM,eAAe,QAAQ,YAAY,CAAC,WAAW,WAAW,WAAW,QAAQ,WAAW;AAC9F,YAAM,aAAa,QAAQ,UAAU,CAAC,WAAW,SAAS,WAAW,MAAM,WAAW;AAEtF,UAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,cAAc,WAAW,OAAO;AAClE,eAAO;AAAA,MACT;AAAA,IACF;AAGA,UAAM,WAAW,KAAK,gBAAgB,OAAO,SAAS,YAAY;AAGlE,UAAM,QAAkB,CAAA;AACxB,UAAM,UAAoB,CAAA;AAC1B,UAAM,QAA6B;AAAA,MACjC,OAAO,WAAW,SAAS,SAAS;AAAA,MACpC,SAAS,WAAW,WAAW,SAAS;AAAA,MACxC,+BAAc,QAAO,cAAc,MAAM,GAAG,EAAE,CAAC;AAAA,MAC/C,MAAM,CAAA;AAAA,MACN,SAAS,CAAA;AAAA,MACT,OAAO,CAAA;AAAA,MACP,MAAM,WAAW,QAAQ,SAAS;AAAA,MAClC,QAAQ,WAAW,UAAU;AAAA,IAAA;AAI/B,QAAI,CAAC,WAAW,MAAO,OAAM,KAAK,OAAO;AACzC,QAAI,CAAC,WAAW,QAAS,OAAM,KAAK,SAAS;AAC7C,QAAI,CAAC,WAAW,KAAM,OAAM,KAAK,MAAM;AACvC,QAAI,CAAC,WAAW,OAAQ,OAAM,KAAK,QAAQ;AAC3C,YAAQ,KAAK,UAAU;AAGvB,QAAI,QAAQ,SAAS,OAAO;AAC1B,YAAM,eAAe,WAAW,QAAQ,CAAA;AACxC,YAAM,gBAAgB,SAAS;AAC/B,YAAM,aAAa,CAAC,GAAG,oBAAI,IAAI,CAAC,GAAG,cAAc,GAAG,aAAa,CAAC,CAAC;AACnE,YAAM,OAAO;AAEb,YAAM,cAAc,WAAW,SAAS,aAAa;AACrD,UAAI,cAAc,EAAG,OAAM,KAAK,GAAG,WAAW,OAAO;AAAA,IACvD;AAGA,QAAI,QAAQ,YAAY,OAAO;AAC7B,YAAM,kBAAkB,WAAW,WAAW,CAAA;AAC9C,YAAM,mBAAmB,SAAS;AAClC,YAAM,gBAAgB,CAAC,GAAG,oBAAI,IAAI,CAAC,GAAG,iBAAiB,GAAG,gBAAgB,CAAC,CAAC;AAC5E,YAAM,UAAU;AAEhB,YAAM,gBAAgB,cAAc,SAAS,gBAAgB;AAC7D,UAAI,gBAAgB,EAAG,OAAM,KAAK,GAAG,aAAa,UAAU;AAAA,IAC9D;AAGA,QAAI,QAAQ,UAAU,OAAO;AAC3B,YAAM,gBAAgB,WAAW,SAAS,CAAA;AAC1C,YAAM,iBAAiB,SAAS;AAChC,YAAM,cAAc,CAAC,GAAG,oBAAI,IAAI,CAAC,GAAG,eAAe,GAAG,cAAc,CAAC,CAAC;AACtE,YAAM,QAAQ;AAEd,YAAM,eAAe,YAAY,SAAS,cAAc;AACxD,UAAI,eAAe,EAAG,OAAM,KAAK,GAAG,YAAY,QAAQ;AAAA,IAC1D;AAGA,QAAI,CAAC,WAAW,eAAe,SAAS,aAAa;AACnD,YAAM,cAAc,SAAS;AAC7B,YAAM,KAAK,aAAa;AAAA,IAC1B;AAGA,QAAI,CAAC,QAAQ,QAAQ;AACnB,YAAM,aAAa,KAAK,6BAA6B,OAAO,OAAO,OAAO;AAC1E,YAAM,UAAU,UAAU,UAAU;AAAA,IACtC;AAEA,WAAO;AAAA,MACL,MAAM;AAAA,MACN;AAAA,MACA;AAAA,MACA,aAAa;AAAA,IAAA;AAAA,EAEjB;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAgB,SAAiB,UAQvC;AACA,UAAM,WAAW,KAAK,SAAS,UAAU,KAAK;AAG9C,QAAI,QAAQ;AACZ,UAAM,eAAe,QAAQ,MAAM,aAAa;AAChD,QAAI,cAAc;AAChB,cAAQ,aAAa,CAAC,EAAE,KAAA;AAAA,IAC1B;AAGA,UAAM,UAAU,KAAK,gBAAgB,OAAO,QAAQ;AAGpD,UAAM,OAAO,KAAK,gBAAgB,OAAO;AAGzC,UAAM,OAAO,KAAK,UAAU,SAAS,QAAQ;AAG7C,UAAM,QAAQ,KAAK,iBAAiB,OAAO;AAG3C,UAAM,cAAc,KAAK,mBAAmB,OAAO;AAGnD,UAAM,+BAAc,KAAA,GAAO,cAAc,MAAM,GAAG,EAAE,CAAC;AAErD,WAAO,EAAE,OAAO,SAAS,MAAM,MAAM,SAAS,OAAO,YAAA;AAAA,EACvD;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAgB,OAAe,UAA4B;AACjE,UAAM,UAAoB,CAAA;AAG1B,UAAM,gBAAgB,SAAS,QAAQ,MAAM,GAAG,EAAE,YAAA;AAClD,UAAM,aAAa,MAAM,YAAA;AACzB,QAAI,kBAAkB,YAAY;AAEhC,YAAM,mBAAmB,SACtB,QAAQ,MAAM,GAAG,EACjB,QAAQ,SAAS,CAAA,MAAK,EAAE,YAAA,CAAa;AACxC,UAAI,qBAAqB,OAAO;AAC9B,gBAAQ,KAAK,gBAAgB;AAAA,MAC/B;AAAA,IACF;AAGA,QAAI,UAAU,MAAM,iBAAiB,CAAC,QAAQ,SAAS,MAAM,YAAA,CAAa,GAAG;AAC3E,cAAQ,KAAK,MAAM,aAAa;AAAA,IAClC;AAGA,UAAM,QAAQ,MAAM,MAAM,KAAK;AAC/B,QAAI,MAAM,UAAU,KAAK,MAAM,UAAU,GAAG;AAC1C,YAAM,UAAU,MACb,IAAI,CAAA,MAAK,EAAE,CAAC,CAAC,EACb,OAAO,CAAA,MAAK,KAAK,QAAQ,KAAK,CAAC,CAAC,EAChC,KAAK,EAAE;AACV,UAAI,QAAQ,UAAU,KAAK,CAAC,QAAQ,SAAS,OAAO,GAAG;AACrD,gBAAQ,KAAK,OAAO;AAAA,MACtB;AAAA,IACF;AAEA,WAAO,QAAQ,MAAM,GAAG,CAAC;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAgB,SAA2B;AACjD,UAAM,2BAAW,IAAA;AAGjB,UAAM,QAAQ;AACd,QAAI;AAEJ,YAAQ,QAAQ,MAAM,KAAK,OAAO,OAAO,MAAM;AAC7C,YAAM,MAAM,MAAM,CAAC,EAAE,YAAA;AACrB,UAAI,IAAI,SAAS,KAAK,IAAI,SAAS,IAAI;AACrC,aAAK,IAAI,GAAG;AAAA,MACd;AAAA,IACF;AAGA,UAAM,eAAe,KAAK,qBAAqB,OAAO;AACtD,eAAW,OAAO,cAAc;AAC9B,WAAK,IAAI,GAAG;AAAA,IACd;AAEA,WAAO,MAAM,KAAK,IAAI,EAAE,MAAM,GAAG,EAAE;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA,EAKQ,qBAAqB,SAA2B;AACtD,UAAM,OAAiB,CAAA;AACvB,UAAM,eAAe,QAAQ,YAAA;AAG7B,UAAM,WAAoD;AAAA,MACxD,EAAE,SAAS,oCAAoC,KAAK,MAAA;AAAA,MACpD,EAAE,SAAS,4CAA4C,KAAK,WAAA;AAAA,MAC5D,EAAE,SAAS,4CAA4C,KAAK,UAAA;AAAA,MAC5D,EAAE,SAAS,0CAA0C,KAAK,SAAA;AAAA,MAC1D,EAAE,SAAS,6CAA6C,KAAK,WAAA;AAAA,MAC7D,EAAE,SAAS,yCAAyC,KAAK,cAAA;AAAA,MACzD,EAAE,SAAS,qCAAqC,KAAK,WAAA;AAAA,MACrD,EAAE,SAAS,sCAAsC,KAAK,UAAA;AAAA,MACtD,EAAE,SAAS,4CAA4C,KAAK,cAAA;AAAA,MAC5D,EAAE,SAAS,sCAAsC,KAAK,QAAA;AAAA,MACtD,EAAE,SAAS,sCAAsC,KAAK,eAAA;AAAA,MACtD,EAAE,SAAS,qCAAqC,KAAK,gBAAA;AAAA,IAAgB;AAGvE,eAAW,EAAE,SAAS,IAAA,KAAS,UAAU;AACvC,UAAI,QAAQ,KAAK,YAAY,GAAG;AAC9B,aAAK,KAAK,GAAG;AAAA,MACf;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,UAAU,SAAiB,UAA0B;AACtC,YAAQ,YAAA;AAC7B,UAAM,gBAAgB,SAAS,YAAA;AAG/B,QAAI,cAAc,SAAS,QAAQ,KAAK,cAAc,SAAS,OAAO,GAAG;AACvE,aAAO;AAAA,IACT;AACA,QAAI,cAAc,SAAS,KAAK,KAAK,cAAc,SAAS,UAAU,GAAG;AACvE,aAAO;AAAA,IACT;AACA,QAAI,cAAc,SAAS,UAAU,KAAK,cAAc,SAAS,YAAY,GAAG;AAC9E,aAAO;AAAA,IACT;AAGA,QAAI,eAAe,KAAK,OAAO,GAAG;AAChC,aAAO;AAAA,IACT;AACA,QAAI,qDAAqD,KAAK,OAAO,GAAG;AACtE,aAAO;AAAA,IACT;AACA,QAAI,wCAAwC,KAAK,OAAO,GAAG;AACzD,aAAO;AAAA,IACT;AACA,QAAI,mDAAmD,KAAK,OAAO,GAAG;AACpE,aAAO;AAAA,IACT;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAiB,SAA2B;AAClD,UAAM,4BAAY,IAAA;AAClB,UAAM,QAAQ;AACd,QAAI;AAEJ,YAAQ,QAAQ,MAAM,KAAK,OAAO,OAAO,MAAM;AAC7C,YAAM,OAAO,MAAM,CAAC,EAAE,KAAA;AACtB,UAAI,MAAM;AACR,cAAM,IAAI,IAAI;AAAA,MAChB;AAAA,IACF;AAEA,WAAO,MAAM,KAAK,KAAK;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAmB,SAAqC;AAE9D,UAAM,QAAQ,QAAQ,MAAM,IAAI;AAChC,QAAI,eAAe;AACnB,UAAM,iBAA2B,CAAA;AAEjC,eAAW,QAAQ,OAAO;AACxB,YAAM,UAAU,KAAK,KAAA;AAGrB,UAAI,CAAC,gBAAgB,CAAC,QAAS;AAG/B,UAAI,QAAQ,WAAW,GAAG,GAAG;AAC3B,YAAI,aAAc;AAClB;AAAA,MACF;AAGA,UAAI,QAAQ,WAAW,KAAK,EAAG;AAG/B,UAAI,SAAS;AACX,uBAAe;AACf,uBAAe,KAAK,OAAO;AAAA,MAC7B,WAAW,cAAc;AAEvB;AAAA,MACF;AAAA,IACF;AAEA,UAAM,cAAc,eAAe,KAAK,GAAG,EAAE,MAAM,GAAG,GAAG;AACzD,WAAO,eAAe;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKQ,6BAA6B,IAAyB,SAAyB;AAErF,UAAM,UAAmC,CAAA;AAEzC,QAAI,GAAG,MAAO,SAAQ,QAAQ,GAAG;AACjC,QAAI,GAAG,YAAa,SAAQ,cAAc,GAAG;AAC7C,QAAI,GAAG,KAAM,SAAQ,OAAO,GAAG;AAC/B,QAAI,GAAG,OAAQ,SAAQ,SAAS,GAAG;AACnC,QAAI,GAAG,QAAS,SAAQ,UAAU,GAAG;AACrC,QAAI,GAAG,SAAU,SAAQ,WAAW,GAAG;AACvC,QAAI,GAAG,QAAQ,GAAG,KAAK,SAAS,EAAG,SAAQ,OAAO,GAAG;AACrD,QAAI,GAAG,WAAW,GAAG,QAAQ,SAAS,EAAG,SAAQ,UAAU,GAAG;AAC9D,QAAI,GAAG,SAAS,GAAG,MAAM,SAAS,EAAG,SAAQ,QAAQ,GAAG;AAExD,UAAM,UAAU,KAAK,KAAK,SAAS;AAAA,MACjC,WAAW;AAAA,MACX,aAAa;AAAA,MACb,aAAa;AAAA,IAAA,CACd;AAED,WAAO;AAAA,EAAQ,OAAO;AAAA;AAAA,EAAU,QAAQ,MAAM;AAAA;AAAA,EAChD;AAAA;AAAA;AAAA;AAAA,EAKA,eAAe,QAA8B;AAC3C,UAAM,QAAkB,CAAA;AAExB,UAAM,KAAK,mCAAmC;AAC9C,UAAM,KAAK,eAAc,oBAAI,KAAA,GAAO,aAAa;AAAA,CAAI;AACrD,UAAM,KAAK,EAAE;AAEb,UAAM,KAAK,cAAc;AACzB,UAAM,KAAK,oBAAoB;AAC/B,UAAM,KAAK,oBAAoB;AAC/B,UAAM,KAAK,mBAAmB,OAAO,WAAW,UAAU,IAAI;AAC9D,UAAM,KAAK,gBAAgB,OAAO,WAAW,aAAa,IAAI;AAC9D,UAAM,KAAK,eAAe,OAAO,WAAW,YAAY,IAAI;AAC5D,UAAM,KAAK,cAAc,OAAO,WAAW,UAAU,IAAI;AACzD,UAAM,KAAK,kBAAkB,OAAO,WAAW,SAAS,IAAI;AAC5D,UAAM,KAAK,qBAAqB,OAAO,WAAW,YAAY,IAAI;AAClE,UAAM,KAAK,uBAAuB,OAAO,WAAW,cAAc,IAAI;AACtE,UAAM,KAAK,EAAE;AAEb,QAAI,OAAO,SAAS,SAAS,GAAG;AAC9B,YAAM,KAAK,qBAAqB;AAChC,iBAAW,EAAE,MAAM,WAAW,OAAO,SAAS,MAAM,GAAG,EAAE,GAAG;AAC1D,YAAI,MAAM,SAAS,GAAG;AACpB,gBAAM,KAAK,OAAO,IAAI,OAAO,MAAM,KAAK,IAAI,CAAC,EAAE;AAAA,QACjD;AAAA,MACF;AACA,UAAI,OAAO,SAAS,SAAS,IAAI;AAC/B,cAAM,KAAK;AAAA,WAAc,OAAO,SAAS,SAAS,EAAE,QAAQ;AAAA,MAC9D;AACA,YAAM,KAAK,EAAE;AAAA,IACf;AAEA,QAAI,OAAO,OAAO,SAAS,GAAG;AAC5B,YAAM,KAAK,aAAa;AACxB,iBAAW,EAAE,MAAM,MAAA,KAAW,OAAO,QAAQ;AAC3C,cAAM,KAAK,OAAO,IAAI,OAAO,KAAK,EAAE;AAAA,MACtC;AACA,YAAM,KAAK,EAAE;AAAA,IACf;AAEA,WAAO,MAAM,KAAK,IAAI;AAAA,EACxB;AACF;AAMO,SAAS,8BAAuC;AACrD,QAAM,UAAU,IAAI,QAAQ,iBAAiB,EAC1C,YAAY,+CAA+C,EAC3D,SAAS,gBAAgB,0CAA0C,EACnE,OAAO,eAAe,uCAAuC,EAC7D,OAAO,UAAU,iDAAiD,EAClE,OAAO,aAAa,qBAAqB,EACzC,OAAO,aAAa,6CAA6C,EACjE,OAAO,gBAAgB,uBAAuB,EAC9C,OAAO,WAAW,mDAAmD,EACrE,OAAO,cAAc,sBAAsB,EAC3C,OAAO,aAAa,uCAAuC,EAC3D,OAAO,uBAAuB,wBAAwB,EACtD,OAAO,UAAU,gBAAgB,EACjC,OAAO,iBAAiB,sBAAsB,EAC9C,OAAO,OAAO,WAAmB,YAA2B;AAC3D,UAAM,WAAW,IAAI,oBAAA;AAErB,UAAM,OAAO,QAAQ,SAAS,eAAe;AAC7C,YAAQ,IAAI,MAAM,KAAK;AAAA,uBAA0B,IAAI;AAAA,CAAO,CAAC;AAE7D,QAAI;AACF,YAAM,SAAS,MAAM,SAAS,YAAY,WAAW,OAAO;AAE5D,UAAI,QAAQ,MAAM;AAChB,YAAI,QAAQ,QAAQ;AAClB,gBAAM,UAAU,QAAQ,QAAQ,KAAK,UAAU,QAAQ,MAAM,CAAC,CAAC;AAC/D,kBAAQ,IAAI,MAAM,MAAM,uBAAuB,QAAQ,MAAM,EAAE,CAAC;AAAA,QAClE,OAAO;AACL,kBAAQ,IAAI,KAAK,UAAU,QAAQ,MAAM,CAAC,CAAC;AAAA,QAC7C;AAAA,MACF,OAAO;AAEL,gBAAQ,IAAI,MAAM,KAAK,UAAU,CAAC;AAClC,gBAAQ,IAAI,MAAM,MAAM,uBAAuB,OAAO,WAAW,UAAU,EAAE,CAAC;AAC9E,gBAAQ,IAAI,MAAM,MAAM,uBAAuB,OAAO,WAAW,aAAa,EAAE,CAAC;AACjF,gBAAQ,IAAI,MAAM,KAAK,uBAAuB,OAAO,WAAW,YAAY,EAAE,CAAC;AAC/E,YAAI,OAAO,WAAW,aAAa,GAAG;AACpC,kBAAQ,IAAI,MAAM,IAAI,uBAAuB,OAAO,WAAW,UAAU,EAAE,CAAC;AAAA,QAC9E;AACA,gBAAQ,IAAI,EAAE;AAEd,gBAAQ,IAAI,MAAM,KAAK,YAAY,CAAC;AACpC,gBAAQ,IAAI,MAAM,MAAM,uBAAuB,OAAO,WAAW,SAAS,EAAE,CAAC;AAC7E,gBAAQ,IAAI,MAAM,MAAM,uBAAuB,OAAO,WAAW,YAAY,EAAE,CAAC;AAChF,gBAAQ,IAAI,MAAM,MAAM,uBAAuB,OAAO,WAAW,cAAc,EAAE,CAAC;AAClF,gBAAQ,IAAI,EAAE;AAEd,YAAI,QAAQ,WAAW,OAAO,SAAS,SAAS,GAAG;AACjD,kBAAQ,IAAI,MAAM,KAAK,iBAAiB,CAAC;AACzC,qBAAW,EAAE,MAAM,WAAW,OAAO,SAAS,MAAM,GAAG,EAAE,GAAG;AAC1D,gBAAI,MAAM,SAAS,GAAG;AACpB,sBAAQ,IAAI,MAAM,MAAM,KAAK,IAAI,EAAE,CAAC;AACpC,sBAAQ,IAAI,MAAM,KAAK,cAAc,MAAM,KAAK,IAAI,CAAC,EAAE,CAAC;AAAA,YAC1D;AAAA,UACF;AACA,cAAI,OAAO,SAAS,SAAS,IAAI;AAC/B,oBAAQ,IAAI,MAAM,KAAK,aAAa,OAAO,SAAS,SAAS,EAAE,OAAO,CAAC;AAAA,UACzE;AACA,kBAAQ,IAAI,EAAE;AAAA,QAChB;AAEA,YAAI,OAAO,OAAO,SAAS,GAAG;AAC5B,kBAAQ,IAAI,MAAM,KAAK,MAAM,IAAI,SAAS,CAAC,CAAC;AAC5C,qBAAW,EAAE,MAAM,WAAW,OAAO,OAAO,MAAM,GAAG,EAAE,GAAG;AACxD,oBAAQ,IAAI,MAAM,IAAI,KAAK,IAAI,KAAK,KAAK,EAAE,CAAC;AAAA,UAC9C;AACA,cAAI,OAAO,OAAO,SAAS,IAAI;AAC7B,oBAAQ,IAAI,MAAM,KAAK,aAAa,OAAO,OAAO,SAAS,EAAE,OAAO,CAAC;AAAA,UACvE;AACA,kBAAQ,IAAI,EAAE;AAAA,QAChB;AAGA,YAAI,QAAQ,UAAU,CAAC,QAAQ,MAAM;AACnC,gBAAM,SAAS,SAAS,eAAe,MAAM;AAC7C,gBAAM,UAAU,QAAQ,QAAQ,MAAM;AACtC,kBAAQ,IAAI,MAAM,MAAM,sBAAsB,QAAQ,MAAM,EAAE,CAAC;AAAA,QACjE;AAGA,YAAI,QAAQ,QAAQ;AAClB,kBAAQ,IAAI,MAAM,OAAO,4CAA4C,CAAC;AACtE,kBAAQ,IAAI,MAAM,KAAK,sCAAsC,CAAC;AAAA,QAChE;AAAA,MACF;AAAA,IACF,SAAS,OAAO;AACd,cAAQ,MAAM,MAAM,IAAI,QAAQ,GAAG,iBAAiB,QAAQ,MAAM,UAAU,eAAe;AAC3F,cAAQ,KAAK,CAAC;AAAA,IAChB;AAAA,EACF,CAAC;AAEH,SAAO;AACT;"}