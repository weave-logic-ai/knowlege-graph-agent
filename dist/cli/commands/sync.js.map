{"version":3,"file":"sync.js","sources":["../../../src/cli/commands/sync.ts"],"sourcesContent":["/**\n * Sync Command\n *\n * Synchronize knowledge graph with claude-flow memory.\n */\n\nimport { Command } from 'commander';\nimport chalk from 'chalk';\nimport ora from 'ora';\nimport { existsSync } from 'fs';\nimport { join } from 'path';\nimport { createDatabase } from '../../core/database.js';\nimport { createClaudeFlowIntegration, generateMcpConfig } from '../../integrations/claude-flow.js';\nimport { validateProjectRoot } from '../../core/security.js';\n\n/**\n * Create sync command\n */\nexport function createSyncCommand(): Command {\n  const command = new Command('sync');\n\n  command\n    .description('Sync knowledge graph with claude-flow memory')\n    .option('-p, --path <path>', 'Project root path', '.')\n    .option('-n, --namespace <namespace>', 'Memory namespace', 'knowledge-graph')\n    .option('--show-commands', 'Show MCP commands instead of executing')\n    .option('--hooks', 'Show hook configuration commands')\n    .action(async (options) => {\n      const spinner = ora('Syncing with claude-flow...').start();\n\n      try {\n        // Validate path to prevent traversal attacks\n        const projectRoot = validateProjectRoot(options.path);\n        const dbPath = join(projectRoot, '.kg', 'knowledge.db');\n\n        // Check if database exists\n        if (!existsSync(dbPath)) {\n          spinner.fail('Knowledge graph not found');\n          console.log(chalk.gray('  Run ') + chalk.cyan('kg graph') + chalk.gray(' first'));\n          process.exit(1);\n        }\n\n        const db = createDatabase(dbPath);\n        const integration = createClaudeFlowIntegration({\n          namespace: options.namespace,\n          syncOnChange: true,\n        });\n\n        if (options.showCommands) {\n          spinner.stop();\n          console.log(chalk.cyan('\\n  Claude-Flow MCP Commands\\n'));\n          console.log(chalk.gray('  Use these commands in Claude Code:\\n'));\n          integration.generateRetrievalCommands().forEach(cmd => {\n            console.log(chalk.white(`  ${cmd}`));\n          });\n          db.close();\n          return;\n        }\n\n        if (options.hooks) {\n          spinner.stop();\n          console.log(chalk.cyan('\\n  Claude-Flow Hook Commands\\n'));\n          console.log(chalk.gray('  Add these to your workflow:\\n'));\n          integration.generateHookCommands().forEach(cmd => {\n            console.log(chalk.white(`  ${cmd}`));\n          });\n          db.close();\n          return;\n        }\n\n        // Perform sync\n        spinner.text = 'Preparing sync data...';\n        const result = await integration.syncToMemory(db);\n\n        spinner.succeed('Sync complete!');\n\n        console.log();\n        console.log(chalk.white('  Results:'));\n        console.log(chalk.green(`    Synced: ${result.synced} entries`));\n        if (result.failed > 0) {\n          console.log(chalk.yellow(`    Failed: ${result.failed}`));\n        }\n\n        // Show helpful commands\n        console.log();\n        console.log(chalk.cyan('  Memory Retrieval:'));\n        console.log(chalk.gray(`    Get stats: mcp__claude-flow__memory_usage { action: \"retrieve\", key: \"stats\", namespace: \"${options.namespace}\" }`));\n        console.log(chalk.gray(`    Get node:  mcp__claude-flow__memory_usage { action: \"retrieve\", key: \"node/<id>\", namespace: \"${options.namespace}\" }`));\n\n        db.close();\n        console.log();\n\n      } catch (error) {\n        spinner.fail('Sync failed');\n        console.error(chalk.red(String(error)));\n        process.exit(1);\n      }\n    });\n\n  // Config subcommand\n  command\n    .command('config')\n    .description('Show MCP configuration for CLAUDE.md')\n    .option('-n, --namespace <namespace>', 'Memory namespace', 'knowledge-graph')\n    .action((options) => {\n      const config = generateMcpConfig(options.namespace);\n      console.log(config);\n    });\n\n  return command;\n}\n"],"names":[],"mappings":";;;;;;;;AAkBO,SAAS,oBAA6B;AAC3C,QAAM,UAAU,IAAI,QAAQ,MAAM;AAElC,UACG,YAAY,8CAA8C,EAC1D,OAAO,qBAAqB,qBAAqB,GAAG,EACpD,OAAO,+BAA+B,oBAAoB,iBAAiB,EAC3E,OAAO,mBAAmB,wCAAwC,EAClE,OAAO,WAAW,kCAAkC,EACpD,OAAO,OAAO,YAAY;AACzB,UAAM,UAAU,IAAI,6BAA6B,EAAE,MAAA;AAEnD,QAAI;AAEF,YAAM,cAAc,oBAAoB,QAAQ,IAAI;AACpD,YAAM,SAAS,KAAK,aAAa,OAAO,cAAc;AAGtD,UAAI,CAAC,WAAW,MAAM,GAAG;AACvB,gBAAQ,KAAK,2BAA2B;AACxC,gBAAQ,IAAI,MAAM,KAAK,QAAQ,IAAI,MAAM,KAAK,UAAU,IAAI,MAAM,KAAK,QAAQ,CAAC;AAChF,gBAAQ,KAAK,CAAC;AAAA,MAChB;AAEA,YAAM,KAAK,eAAe,MAAM;AAChC,YAAM,cAAc,4BAA4B;AAAA,QAC9C,WAAW,QAAQ;AAAA,QACnB,cAAc;AAAA,MAAA,CACf;AAED,UAAI,QAAQ,cAAc;AACxB,gBAAQ,KAAA;AACR,gBAAQ,IAAI,MAAM,KAAK,gCAAgC,CAAC;AACxD,gBAAQ,IAAI,MAAM,KAAK,wCAAwC,CAAC;AAChE,oBAAY,0BAAA,EAA4B,QAAQ,CAAA,QAAO;AACrD,kBAAQ,IAAI,MAAM,MAAM,KAAK,GAAG,EAAE,CAAC;AAAA,QACrC,CAAC;AACD,WAAG,MAAA;AACH;AAAA,MACF;AAEA,UAAI,QAAQ,OAAO;AACjB,gBAAQ,KAAA;AACR,gBAAQ,IAAI,MAAM,KAAK,iCAAiC,CAAC;AACzD,gBAAQ,IAAI,MAAM,KAAK,iCAAiC,CAAC;AACzD,oBAAY,qBAAA,EAAuB,QAAQ,CAAA,QAAO;AAChD,kBAAQ,IAAI,MAAM,MAAM,KAAK,GAAG,EAAE,CAAC;AAAA,QACrC,CAAC;AACD,WAAG,MAAA;AACH;AAAA,MACF;AAGA,cAAQ,OAAO;AACf,YAAM,SAAS,MAAM,YAAY,aAAa,EAAE;AAEhD,cAAQ,QAAQ,gBAAgB;AAEhC,cAAQ,IAAA;AACR,cAAQ,IAAI,MAAM,MAAM,YAAY,CAAC;AACrC,cAAQ,IAAI,MAAM,MAAM,eAAe,OAAO,MAAM,UAAU,CAAC;AAC/D,UAAI,OAAO,SAAS,GAAG;AACrB,gBAAQ,IAAI,MAAM,OAAO,eAAe,OAAO,MAAM,EAAE,CAAC;AAAA,MAC1D;AAGA,cAAQ,IAAA;AACR,cAAQ,IAAI,MAAM,KAAK,qBAAqB,CAAC;AAC7C,cAAQ,IAAI,MAAM,KAAK,iGAAiG,QAAQ,SAAS,KAAK,CAAC;AAC/I,cAAQ,IAAI,MAAM,KAAK,qGAAqG,QAAQ,SAAS,KAAK,CAAC;AAEnJ,SAAG,MAAA;AACH,cAAQ,IAAA;AAAA,IAEV,SAAS,OAAO;AACd,cAAQ,KAAK,aAAa;AAC1B,cAAQ,MAAM,MAAM,IAAI,OAAO,KAAK,CAAC,CAAC;AACtC,cAAQ,KAAK,CAAC;AAAA,IAChB;AAAA,EACF,CAAC;AAGH,UACG,QAAQ,QAAQ,EAChB,YAAY,sCAAsC,EAClD,OAAO,+BAA+B,oBAAoB,iBAAiB,EAC3E,OAAO,CAAC,YAAY;AACnB,UAAM,SAAS,kBAAkB,QAAQ,SAAS;AAClD,YAAQ,IAAI,MAAM;AAAA,EACpB,CAAC;AAEH,SAAO;AACT;"}