{"version":3,"file":"index.js","sources":["../../../../src/plugins/analyzers/dependency-health/index.ts"],"sourcesContent":["/**\n * Dependency Health Analyzer Plugin\n *\n * A plugin for the knowledge-graph-agent that analyzes npm dependencies\n * for vulnerabilities, outdated packages, and health metrics.\n *\n * Features:\n * - Vulnerability scanning via npm audit\n * - Outdated package detection via npm outdated\n * - npm registry metadata fetching\n * - Health score calculation\n * - Knowledge graph node generation\n * - Streaming analysis support\n * - AnalyzerPlugin interface implementation\n *\n * @module plugins/analyzers/dependency-health\n */\n\nimport { createLogger } from '../../../utils/logger.js';\nimport { KnowledgeGraphManager } from '../../../core/graph.js';\nimport { DependencyHealthAnalyzer, createDependencyHealthAnalyzer } from './analyzer.js';\nimport { DependencyGraphGenerator, createDependencyGraphGenerator } from './graph-generator.js';\nimport { NpmClient, createNpmClient } from './npm-client.js';\nimport { VulnerabilityChecker, createVulnerabilityChecker } from './vulnerability.js';\nimport type { KnowledgeNode, GraphEdge } from '../../../core/types.js';\nimport type { SeedAnalysis, DependencyInfo } from '../../../cultivation/types.js';\nimport type {\n  AnalyzerPlugin,\n  AnalysisInput,\n  AnalysisResult,\n  AnalysisStreamChunk,\n  PluginContext,\n} from '../../types.js';\nimport type {\n  DependencyHealthConfig,\n  DependencyHealthAnalysis,\n  DependencyHealthScore,\n  DependencyHealthNode,\n  DependencyAnalyzerPluginConfig,\n  DependencyHealthMetrics,\n  PackageJson,\n} from './types.js';\n\n// Re-export types\nexport * from './types.js';\n\n// Re-export components\nexport {\n  DependencyHealthAnalyzer,\n  createDependencyHealthAnalyzer,\n  DependencyGraphGenerator,\n  createDependencyGraphGenerator,\n  NpmClient,\n  createNpmClient,\n  VulnerabilityChecker,\n  createVulnerabilityChecker,\n};\n\nconst logger = createLogger('dependency-health-plugin');\n\n/**\n * Plugin result interface\n */\nexport interface DependencyHealthPluginResult {\n  /** Whether the plugin executed successfully */\n  success: boolean;\n  /** The full analysis result */\n  analysis: DependencyHealthAnalysis;\n  /** Generated knowledge graph nodes */\n  nodes: KnowledgeNode[];\n  /** Generated knowledge graph edges */\n  edges: GraphEdge[];\n  /** Markdown report content */\n  report: string;\n  /** Any errors encountered */\n  errors: string[];\n}\n\n/**\n * DependencyHealthPlugin class\n *\n * Main plugin entry point that coordinates analysis and graph generation.\n */\nexport class DependencyHealthPlugin {\n  private projectRoot: string;\n  private config: Partial<DependencyHealthConfig>;\n  private analyzer: DependencyHealthAnalyzer;\n  private graphGenerator: DependencyGraphGenerator;\n\n  constructor(projectRoot: string, config: Partial<DependencyHealthConfig> = {}) {\n    this.projectRoot = projectRoot;\n    this.config = config;\n    this.analyzer = createDependencyHealthAnalyzer(projectRoot, config);\n\n    // Extract project name from path\n    const projectName = projectRoot.split('/').pop() ?? 'project';\n    this.graphGenerator = createDependencyGraphGenerator(projectName);\n  }\n\n  /**\n   * Run the full dependency health analysis pipeline\n   */\n  async run(): Promise<DependencyHealthPluginResult> {\n    logger.info('Starting dependency health plugin', { projectRoot: this.projectRoot });\n\n    const result: DependencyHealthPluginResult = {\n      success: false,\n      analysis: {\n        analyzedAt: new Date().toISOString(),\n        projectRoot: this.projectRoot,\n        packageManager: 'npm',\n        totalDependencies: 0,\n        summary: {\n          vulnerabilities: { critical: 0, high: 0, moderate: 0, low: 0, info: 0, total: 0 },\n          outdated: { major: 0, minor: 0, patch: 0, total: 0 },\n          healthScores: { healthy: 0, warning: 0, critical: 0, unknown: 0 },\n          averageHealthScore: 0,\n        },\n        dependencies: [],\n        nodes: [],\n        edges: [],\n        warnings: [],\n        errors: [],\n        duration: 0,\n      },\n      nodes: [],\n      edges: [],\n      report: '',\n      errors: [],\n    };\n\n    try {\n      // Step 1: Run the analysis\n      const analysis = await this.analyzer.analyze();\n      result.analysis = analysis;\n\n      // Step 2: Generate knowledge graph\n      const graph = this.graphGenerator.generateGraph(analysis);\n      result.nodes = graph.nodes;\n      result.edges = graph.edges;\n\n      // Step 3: Generate markdown report\n      result.report = this.graphGenerator.generateMarkdownReport(analysis);\n\n      // Step 4: Add nodes and edges to analysis result\n      result.analysis.nodes = this.graphGenerator.generateNodes(analysis);\n      result.analysis.edges = this.graphGenerator.generateEdges(result.analysis.nodes);\n\n      result.success = analysis.errors.length === 0;\n      result.errors = [...analysis.errors, ...analysis.warnings];\n\n      logger.info('Dependency health plugin complete', {\n        success: result.success,\n        nodes: result.nodes.length,\n        edges: result.edges.length,\n        avgScore: analysis.summary.averageHealthScore,\n      });\n\n    } catch (error) {\n      logger.error('Dependency health plugin failed', error instanceof Error ? error : undefined);\n      result.errors.push(error instanceof Error ? error.message : String(error));\n    }\n\n    return result;\n  }\n\n  /**\n   * Hook into SeedGenerator pipeline\n   *\n   * This method can be called after package.json parsing to enhance\n   * DependencyInfo objects with health data.\n   */\n  async enhanceSeedAnalysis(seedAnalysis: SeedAnalysis): Promise<SeedAnalysis> {\n    logger.info('Enhancing seed analysis with health data');\n\n    try {\n      const healthAnalysis = await this.analyzer.analyze();\n      const healthMap = new Map(\n        healthAnalysis.dependencies.map(d => [d.name, d])\n      );\n\n      // Enhance each dependency with health info\n      for (const dep of seedAnalysis.dependencies) {\n        const health = healthMap.get(dep.name);\n        if (health) {\n          // Add health metadata to dependency\n          (dep as DependencyInfo & { health?: DependencyHealthScore }).health = health;\n\n          // Update description with health summary\n          dep.description = dep.description\n            ? `${dep.description} (Health: ${health.overallScore}/100)`\n            : `Health Score: ${health.overallScore}/100 - ${health.status}`;\n        }\n      }\n\n      logger.info('Seed analysis enhanced', {\n        total: seedAnalysis.dependencies.length,\n        withHealth: healthMap.size,\n      });\n\n    } catch (error) {\n      logger.warn('Failed to enhance seed analysis', {\n        error: error instanceof Error ? error.message : String(error),\n      });\n    }\n\n    return seedAnalysis;\n  }\n\n  /**\n   * Add health nodes to an existing knowledge graph\n   */\n  async addToGraph(graph: KnowledgeGraphManager): Promise<void> {\n    logger.info('Adding dependency health nodes to graph');\n\n    const result = await this.run();\n\n    if (!result.success) {\n      logger.warn('Analysis had errors, adding partial results', {\n        errors: result.errors.length,\n      });\n    }\n\n    // Add nodes\n    for (const node of result.nodes) {\n      graph.addNode(node);\n    }\n\n    // Add edges\n    for (const edge of result.edges) {\n      graph.addEdge(edge);\n    }\n\n    logger.info('Added dependency health data to graph', {\n      nodes: result.nodes.length,\n      edges: result.edges.length,\n    });\n  }\n\n  /**\n   * Get analysis for a single package\n   */\n  async analyzePackage(packageName: string): Promise<DependencyHealthScore | null> {\n    return this.analyzer.getPackageHealth(packageName);\n  }\n\n  /**\n   * Get all unhealthy packages\n   */\n  async getUnhealthyPackages(): Promise<DependencyHealthScore[]> {\n    return this.analyzer.getUnhealthyPackages();\n  }\n\n  /**\n   * Clear internal caches\n   */\n  clearCache(): void {\n    this.analyzer.clearCache();\n  }\n}\n\n/**\n * Create a dependency health plugin instance\n */\nexport function createDependencyHealthPlugin(\n  projectRoot: string,\n  config?: Partial<DependencyHealthConfig>\n): DependencyHealthPlugin {\n  return new DependencyHealthPlugin(projectRoot, config);\n}\n\n/**\n * Run dependency health analysis as a standalone function\n */\nexport async function analyzeDependencyHealth(\n  projectRoot: string,\n  config?: Partial<DependencyHealthConfig>\n): Promise<DependencyHealthPluginResult> {\n  const plugin = createDependencyHealthPlugin(projectRoot, config);\n  return plugin.run();\n}\n\n/**\n * Integration hook for SeedGenerator\n *\n * Usage in seed-generator.ts:\n * ```typescript\n * import { enhanceDependenciesWithHealth } from '../plugins/analyzers/dependency-health';\n *\n * // After analyzing dependencies\n * if (options.analyzeHealth) {\n *   analysis = await enhanceDependenciesWithHealth(analysis, projectRoot);\n * }\n * ```\n */\nexport async function enhanceDependenciesWithHealth(\n  seedAnalysis: SeedAnalysis,\n  projectRoot: string,\n  config?: Partial<DependencyHealthConfig>\n): Promise<SeedAnalysis> {\n  const plugin = createDependencyHealthPlugin(projectRoot, config);\n  return plugin.enhanceSeedAnalysis(seedAnalysis);\n}\n\n// ============================================================================\n// AnalyzerPlugin Implementation\n// ============================================================================\n\n/**\n * Known vulnerable version patterns for basic security checks\n */\nconst KNOWN_VULNERABLE_PATTERNS: Array<{\n  package: string;\n  versionMatch: RegExp;\n  severity: 'critical' | 'high' | 'moderate' | 'low';\n  description: string;\n}> = [\n  // lodash prototype pollution\n  { package: 'lodash', versionMatch: /^[0-3]\\./, severity: 'high', description: 'Prototype pollution vulnerability' },\n  { package: 'lodash', versionMatch: /^4\\.[0-9]\\.|^4\\.1[0-6]\\./, severity: 'high', description: 'Prototype pollution CVE-2019-10744' },\n  // minimist prototype pollution\n  { package: 'minimist', versionMatch: /^0\\.[0-1]\\./, severity: 'critical', description: 'Prototype pollution CVE-2020-7598' },\n  { package: 'minimist', versionMatch: /^1\\.2\\.[0-5]$/, severity: 'critical', description: 'Prototype pollution CVE-2021-44906' },\n  // node-fetch\n  { package: 'node-fetch', versionMatch: /^[0-1]\\./, severity: 'moderate', description: 'Known security issues in older versions' },\n  { package: 'node-fetch', versionMatch: /^2\\.[0-5]\\./, severity: 'moderate', description: 'Exposure of sensitive information CVE-2022-0235' },\n  // axios\n  { package: 'axios', versionMatch: /^0\\.[0-9]\\.|^0\\.1[0-8]\\./, severity: 'moderate', description: 'SSRF vulnerability in older versions' },\n  // express\n  { package: 'express', versionMatch: /^[0-3]\\./, severity: 'high', description: 'Multiple security vulnerabilities in older versions' },\n  // jsonwebtoken\n  { package: 'jsonwebtoken', versionMatch: /^[0-7]\\./, severity: 'critical', description: 'Algorithm confusion CVE-2022-23529' },\n  // moment.js\n  { package: 'moment', versionMatch: /^2\\.29\\.[0-3]$/, severity: 'high', description: 'Path traversal CVE-2022-31129' },\n  // shell-quote\n  { package: 'shell-quote', versionMatch: /^1\\.[0-6]\\./, severity: 'critical', description: 'Command injection CVE-2021-42740' },\n  // tar\n  { package: 'tar', versionMatch: /^[0-5]\\./, severity: 'high', description: 'Arbitrary file overwrite vulnerabilities' },\n  // glob-parent\n  { package: 'glob-parent', versionMatch: /^[0-4]\\./, severity: 'high', description: 'Regular expression denial of service' },\n  { package: 'glob-parent', versionMatch: /^5\\.[0-1]\\./, severity: 'high', description: 'ReDoS CVE-2020-28469' },\n];\n\n/**\n * DependencyHealthAnalyzerPlugin\n *\n * Implements the AnalyzerPlugin interface for analyzing npm dependencies.\n * Provides vulnerability scanning, outdated package detection, and health scoring.\n *\n * @example\n * ```typescript\n * const plugin = new DependencyHealthAnalyzerPlugin();\n * await plugin.initialize(context);\n *\n * const result = await plugin.analyze({\n *   id: 'analysis-1',\n *   content: packageJsonContent,\n *   contentType: 'package.json',\n *   filePath: '/project/package.json'\n * });\n *\n * console.log(`Health Score: ${result.qualityScore}`);\n * ```\n */\nexport class DependencyHealthAnalyzerPlugin implements AnalyzerPlugin {\n  readonly name = 'dependency-health-analyzer';\n  readonly version = '1.0.0';\n  readonly type = 'analyzer' as const;\n  readonly supportedContentTypes = ['json', 'package.json'];\n\n  private context: PluginContext | null = null;\n  private config: DependencyAnalyzerPluginConfig;\n  private analyzer: DependencyHealthAnalyzer | null = null;\n  private graphGenerator: DependencyGraphGenerator | null = null;\n\n  constructor(config: Partial<DependencyAnalyzerPluginConfig> = {}) {\n    this.config = {\n      minHealthScore: config.minHealthScore ?? 50,\n      includeDev: config.includeDev ?? true,\n      includePeer: config.includePeer ?? false,\n      includeOptional: config.includeOptional ?? false,\n      skipPackages: config.skipPackages ?? [],\n      vulnerabilitySeverityThreshold: config.vulnerabilitySeverityThreshold ?? 'low',\n      fetchRegistryMetadata: config.fetchRegistryMetadata ?? true,\n      registryUrl: config.registryUrl ?? 'https://registry.npmjs.org',\n      timeout: config.timeout ?? 30000,\n      cacheTtl: config.cacheTtl ?? 3600000,\n      storeInDatabase: config.storeInDatabase ?? true,\n      generateGraphNodes: config.generateGraphNodes ?? true,\n      generateReport: config.generateReport ?? false,\n      reportPath: config.reportPath ?? '',\n      enableStreaming: config.enableStreaming ?? true,\n      vulnerablePatterns: config.vulnerablePatterns ?? [],\n      unusedThresholdDays: config.unusedThresholdDays ?? 90,\n    };\n  }\n\n  /**\n   * Initialize the plugin\n   */\n  async initialize(context: PluginContext): Promise<void> {\n    this.context = context;\n    this.analyzer = createDependencyHealthAnalyzer(context.projectRoot, this.config);\n    this.graphGenerator = createDependencyGraphGenerator(context.projectRoot.split('/').pop() ?? 'project');\n\n    context.logger.info('DependencyHealthAnalyzerPlugin initialized', {\n      projectRoot: context.projectRoot,\n      config: this.config,\n    });\n  }\n\n  /**\n   * Destroy the plugin and clean up resources\n   */\n  async destroy(): Promise<void> {\n    if (this.analyzer) {\n      this.analyzer.clearCache();\n    }\n    this.context = null;\n    this.analyzer = null;\n    this.graphGenerator = null;\n    logger.info('DependencyHealthAnalyzerPlugin destroyed');\n  }\n\n  /**\n   * Check if this analyzer can handle the given content type\n   */\n  canAnalyze(contentType: string): boolean {\n    const normalizedType = contentType.toLowerCase();\n    return this.supportedContentTypes.some(\n      t => normalizedType === t || normalizedType.includes(t)\n    );\n  }\n\n  /**\n   * Analyze content and return structured results\n   */\n  async analyze(input: AnalysisInput): Promise<AnalysisResult> {\n    const startTime = Date.now();\n    const log = this.context?.logger ?? logger;\n\n    log.info('Starting dependency health analysis', { id: input.id, contentType: input.contentType });\n\n    try {\n      // Parse the package.json content\n      let packageJson: PackageJson;\n      try {\n        packageJson = JSON.parse(input.content);\n      } catch {\n        return this.createErrorResult(input.id, 'PARSE_ERROR', 'Failed to parse package.json content');\n      }\n\n      // Extract all dependencies\n      const allDeps = this.extractDependencies(packageJson);\n      if (allDeps.length === 0) {\n        return this.createSuccessResult(input.id, startTime, {\n          entities: [],\n          relationships: [],\n          tags: [{ value: 'no-dependencies', confidence: 1 }],\n          qualityScore: 100,\n          summary: 'No dependencies found in package.json',\n          metrics: { durationMs: Date.now() - startTime, entitiesFound: 0 },\n        });\n      }\n\n      // Check for vulnerabilities using pattern matching\n      const vulnerabilities = this.checkVulnerabilities(allDeps);\n\n      // Check for outdated packages (basic check based on version patterns)\n      const outdatedInfo = this.identifyOutdatedPatterns(allDeps);\n\n      // Calculate health metrics\n      const metrics = this.calculateHealthMetrics(allDeps, vulnerabilities, outdatedInfo);\n\n      // Generate entities for each dependency\n      const entities = this.generateEntities(allDeps, vulnerabilities, outdatedInfo);\n\n      // Generate relationships\n      const relationships = this.generateRelationships(allDeps, packageJson);\n\n      // Generate tags\n      const tags = this.generateTags(metrics, vulnerabilities);\n\n      // Generate suggestions\n      const suggestions = this.generateSuggestions(vulnerabilities, outdatedInfo, metrics);\n\n      return this.createSuccessResult(input.id, startTime, {\n        entities,\n        relationships,\n        tags,\n        qualityScore: metrics.averageHealthScore,\n        summary: this.generateSummary(metrics, vulnerabilities, outdatedInfo),\n        metrics: {\n          durationMs: Date.now() - startTime,\n          entitiesFound: entities.length,\n          relationshipsFound: relationships.length,\n        },\n        suggestions,\n        raw: {\n          packageJson,\n          vulnerabilities,\n          outdatedInfo,\n          healthMetrics: metrics,\n        },\n      });\n    } catch (error) {\n      log.error('Dependency health analysis failed', error instanceof Error ? error : undefined);\n      return this.createErrorResult(\n        input.id,\n        'ANALYSIS_ERROR',\n        error instanceof Error ? error.message : String(error)\n      );\n    }\n  }\n\n  /**\n   * Stream analysis results for large content\n   */\n  async *analyzeStream(input: AnalysisInput): AsyncIterable<AnalysisStreamChunk> {\n    const log = this.context?.logger ?? logger;\n    log.info('Starting streaming dependency health analysis', { id: input.id });\n\n    // Emit start progress\n    yield {\n      type: 'progress',\n      data: { phase: 'parsing', message: 'Parsing package.json' },\n      progress: 5,\n      timestamp: new Date(),\n    };\n\n    // Parse the package.json content\n    let packageJson: PackageJson;\n    try {\n      packageJson = JSON.parse(input.content);\n    } catch {\n      yield {\n        type: 'error',\n        data: { code: 'PARSE_ERROR', message: 'Failed to parse package.json content' },\n        timestamp: new Date(),\n      };\n      return;\n    }\n\n    yield {\n      type: 'progress',\n      data: { phase: 'extracting', message: 'Extracting dependencies' },\n      progress: 15,\n      timestamp: new Date(),\n    };\n\n    // Extract all dependencies\n    const allDeps = this.extractDependencies(packageJson);\n    const totalDeps = allDeps.length;\n\n    if (totalDeps === 0) {\n      yield {\n        type: 'complete',\n        data: { message: 'No dependencies found', qualityScore: 100 },\n        progress: 100,\n        timestamp: new Date(),\n      };\n      return;\n    }\n\n    yield {\n      type: 'progress',\n      data: { phase: 'checking', message: `Found ${totalDeps} dependencies` },\n      progress: 20,\n      timestamp: new Date(),\n    };\n\n    // Stream entity analysis for each dependency\n    const vulnerabilities: Map<string, Array<{ severity: string; description: string }>> = new Map();\n    const outdatedInfo: Map<string, { isOutdated: boolean; pattern?: string }> = new Map();\n\n    let processed = 0;\n    for (const dep of allDeps) {\n      // Check vulnerability\n      const vulns = this.checkSingleDependency(dep.name, dep.version);\n      if (vulns.length > 0) {\n        vulnerabilities.set(dep.name, vulns);\n      }\n\n      // Check outdated patterns\n      const outdated = this.checkOutdatedPattern(dep.version);\n      outdatedInfo.set(dep.name, outdated);\n\n      // Calculate health score for this dependency\n      const healthScore = this.calculateSingleHealthScore(dep, vulns, outdated);\n\n      // Emit entity\n      yield {\n        type: 'entity',\n        data: {\n          id: `dep:${dep.name.replace(/[@/]/g, '-')}`,\n          type: 'dependency',\n          value: dep.name,\n          confidence: 0.95,\n          metadata: {\n            version: dep.version,\n            isDev: dep.isDev,\n            healthScore,\n            hasVulnerabilities: vulns.length > 0,\n            isOutdated: outdated.isOutdated,\n          },\n        },\n        timestamp: new Date(),\n      };\n\n      processed++;\n      const progressPercent = 20 + Math.floor((processed / totalDeps) * 60);\n\n      if (processed % 5 === 0 || processed === totalDeps) {\n        yield {\n          type: 'progress',\n          data: { phase: 'analyzing', message: `Analyzed ${processed}/${totalDeps} dependencies` },\n          progress: progressPercent,\n          timestamp: new Date(),\n        };\n      }\n    }\n\n    // Emit relationships\n    yield {\n      type: 'progress',\n      data: { phase: 'relationships', message: 'Generating relationships' },\n      progress: 85,\n      timestamp: new Date(),\n    };\n\n    const relationships = this.generateRelationships(allDeps, packageJson);\n    for (const rel of relationships) {\n      yield {\n        type: 'relationship',\n        data: rel,\n        timestamp: new Date(),\n      };\n    }\n\n    // Calculate final metrics\n    const metrics = this.calculateHealthMetrics(allDeps, vulnerabilities, outdatedInfo);\n\n    // Emit tags\n    yield {\n      type: 'progress',\n      data: { phase: 'finalizing', message: 'Generating tags and summary' },\n      progress: 95,\n      timestamp: new Date(),\n    };\n\n    const tags = this.generateTags(metrics, vulnerabilities);\n    for (const tag of tags) {\n      yield {\n        type: 'tag',\n        data: tag,\n        timestamp: new Date(),\n      };\n    }\n\n    // Emit completion\n    yield {\n      type: 'complete',\n      data: {\n        message: this.generateSummary(metrics, vulnerabilities, outdatedInfo),\n        qualityScore: metrics.averageHealthScore,\n        metrics,\n      },\n      progress: 100,\n      timestamp: new Date(),\n    };\n  }\n\n  /**\n   * Get analyzer-specific configuration options\n   */\n  getConfigOptions(): Record<string, {\n    type: 'string' | 'number' | 'boolean' | 'array' | 'object';\n    description: string;\n    default?: unknown;\n    required?: boolean;\n  }> {\n    return {\n      minHealthScore: {\n        type: 'number',\n        description: 'Minimum health score threshold (0-100)',\n        default: 50,\n      },\n      includeDev: {\n        type: 'boolean',\n        description: 'Include dev dependencies in analysis',\n        default: true,\n      },\n      includePeer: {\n        type: 'boolean',\n        description: 'Include peer dependencies in analysis',\n        default: false,\n      },\n      includeOptional: {\n        type: 'boolean',\n        description: 'Include optional dependencies in analysis',\n        default: false,\n      },\n      skipPackages: {\n        type: 'array',\n        description: 'Packages to skip during analysis',\n        default: [],\n      },\n      vulnerabilitySeverityThreshold: {\n        type: 'string',\n        description: 'Minimum severity to report (info, low, moderate, high, critical)',\n        default: 'low',\n      },\n      fetchRegistryMetadata: {\n        type: 'boolean',\n        description: 'Fetch metadata from npm registry',\n        default: true,\n      },\n      enableStreaming: {\n        type: 'boolean',\n        description: 'Enable streaming analysis mode',\n        default: true,\n      },\n    };\n  }\n\n  /**\n   * Get plugin health status\n   */\n  async healthCheck(): Promise<{ healthy: boolean; message?: string; details?: Record<string, unknown> }> {\n    return {\n      healthy: true,\n      message: 'Dependency Health Analyzer is operational',\n      details: {\n        supportedContentTypes: this.supportedContentTypes,\n        knownVulnerablePatterns: KNOWN_VULNERABLE_PATTERNS.length,\n        cacheEnabled: (this.config?.cacheTtl ?? 0) > 0,\n      },\n    };\n  }\n\n  /**\n   * Get plugin statistics\n   */\n  async getStats(): Promise<Record<string, unknown>> {\n    return {\n      name: this.name,\n      version: this.version,\n      supportedContentTypes: this.supportedContentTypes,\n      config: this.config,\n    };\n  }\n\n  // ==========================================================================\n  // Private Helper Methods\n  // ==========================================================================\n\n  private extractDependencies(pkg: PackageJson): Array<{ name: string; version: string; isDev: boolean }> {\n    const deps: Array<{ name: string; version: string; isDev: boolean }> = [];\n\n    if (pkg.dependencies) {\n      for (const [name, version] of Object.entries(pkg.dependencies)) {\n        deps.push({ name, version: this.cleanVersion(version), isDev: false });\n      }\n    }\n\n    if (this.config.includeDev && pkg.devDependencies) {\n      for (const [name, version] of Object.entries(pkg.devDependencies)) {\n        deps.push({ name, version: this.cleanVersion(version), isDev: true });\n      }\n    }\n\n    if (this.config.includePeer && pkg.peerDependencies) {\n      for (const [name, version] of Object.entries(pkg.peerDependencies)) {\n        deps.push({ name, version: this.cleanVersion(version), isDev: false });\n      }\n    }\n\n    if (this.config.includeOptional && pkg.optionalDependencies) {\n      for (const [name, version] of Object.entries(pkg.optionalDependencies)) {\n        deps.push({ name, version: this.cleanVersion(version), isDev: false });\n      }\n    }\n\n    return deps.filter(d => !this.config.skipPackages?.includes(d.name));\n  }\n\n  private cleanVersion(version: string): string {\n    return version.replace(/^[\\^~>=<]/, '').split(' ')[0];\n  }\n\n  private checkVulnerabilities(\n    deps: Array<{ name: string; version: string }>\n  ): Map<string, Array<{ severity: string; description: string }>> {\n    const vulnerabilities = new Map<string, Array<{ severity: string; description: string }>>();\n\n    for (const dep of deps) {\n      const vulns = this.checkSingleDependency(dep.name, dep.version);\n      if (vulns.length > 0) {\n        vulnerabilities.set(dep.name, vulns);\n      }\n    }\n\n    return vulnerabilities;\n  }\n\n  private checkSingleDependency(\n    name: string,\n    version: string\n  ): Array<{ severity: string; description: string }> {\n    const vulns: Array<{ severity: string; description: string }> = [];\n\n    for (const pattern of KNOWN_VULNERABLE_PATTERNS) {\n      if (pattern.package === name && pattern.versionMatch.test(version)) {\n        vulns.push({\n          severity: pattern.severity,\n          description: pattern.description,\n        });\n      }\n    }\n\n    // Check custom patterns from config\n    for (const custom of this.config.vulnerablePatterns ?? []) {\n      if (custom.package === name || new RegExp(custom.package).test(name)) {\n        // Simple version range check\n        if (this.versionInRange(version, custom.versionRange)) {\n          vulns.push({\n            severity: custom.severity,\n            description: custom.description,\n          });\n        }\n      }\n    }\n\n    return vulns;\n  }\n\n  private versionInRange(version: string, range: string): boolean {\n    // Simple version range check for patterns like \"< 1.0.0\" or \">= 2.0.0\"\n    const match = range.match(/^([<>=]+)\\s*(\\d+\\.\\d+\\.\\d+)/);\n    if (!match) return false;\n\n    const [, op, targetVersion] = match;\n    const comparison = this.compareVersions(version, targetVersion);\n\n    switch (op) {\n      case '<': return comparison < 0;\n      case '<=': return comparison <= 0;\n      case '>': return comparison > 0;\n      case '>=': return comparison >= 0;\n      case '=':\n      case '==': return comparison === 0;\n      default: return false;\n    }\n  }\n\n  private compareVersions(a: string, b: string): number {\n    const partsA = a.split('.').map(n => parseInt(n, 10) || 0);\n    const partsB = b.split('.').map(n => parseInt(n, 10) || 0);\n\n    for (let i = 0; i < Math.max(partsA.length, partsB.length); i++) {\n      const numA = partsA[i] ?? 0;\n      const numB = partsB[i] ?? 0;\n      if (numA < numB) return -1;\n      if (numA > numB) return 1;\n    }\n    return 0;\n  }\n\n  private identifyOutdatedPatterns(\n    deps: Array<{ name: string; version: string }>\n  ): Map<string, { isOutdated: boolean; pattern?: string }> {\n    const outdated = new Map<string, { isOutdated: boolean; pattern?: string }>();\n\n    for (const dep of deps) {\n      outdated.set(dep.name, this.checkOutdatedPattern(dep.version));\n    }\n\n    return outdated;\n  }\n\n  private checkOutdatedPattern(version: string): { isOutdated: boolean; pattern?: string } {\n    // Very old versions (0.x.x for non-pre-1.0 packages)\n    if (/^0\\.[0-9]\\.[0-9]/.test(version)) {\n      return { isOutdated: true, pattern: 'pre-1.0 version' };\n    }\n\n    // Alpha/beta/rc versions\n    if (/-(alpha|beta|rc|canary)/i.test(version)) {\n      return { isOutdated: true, pattern: 'pre-release version' };\n    }\n\n    return { isOutdated: false };\n  }\n\n  private calculateHealthMetrics(\n    deps: Array<{ name: string; version: string; isDev: boolean }>,\n    vulnerabilities: Map<string, Array<{ severity: string; description: string }>>,\n    outdatedInfo: Map<string, { isOutdated: boolean; pattern?: string }>\n  ): DependencyHealthMetrics {\n    const total = deps.length;\n    let healthyCount = 0;\n    let warningCount = 0;\n    let criticalCount = 0;\n    let totalScore = 0;\n\n    for (const dep of deps) {\n      const vulns = vulnerabilities.get(dep.name) ?? [];\n      const outdated = outdatedInfo.get(dep.name) ?? { isOutdated: false };\n      const score = this.calculateSingleHealthScore(dep, vulns, outdated);\n\n      totalScore += score;\n\n      if (score >= 80) {\n        healthyCount++;\n      } else if (score >= 50) {\n        warningCount++;\n      } else {\n        criticalCount++;\n      }\n    }\n\n    const vulnerableCount = vulnerabilities.size;\n    const outdatedCount = Array.from(outdatedInfo.values()).filter(o => o.isOutdated).length;\n\n    // Calculate component scores\n    const securityScore = total > 0 ? Math.max(0, 100 - (vulnerableCount / total) * 100) : 100;\n    const freshnessScore = total > 0 ? Math.max(0, 100 - (outdatedCount / total) * 100) : 100;\n    const maintenanceScore = (securityScore + freshnessScore) / 2;\n\n    return {\n      totalDependencies: total,\n      healthyCount,\n      warningCount,\n      criticalCount,\n      averageHealthScore: total > 0 ? Math.round(totalScore / total) : 100,\n      outdatedCount,\n      vulnerableCount,\n      unusedCount: 0, // Would require import analysis\n      securityScore: Math.round(securityScore),\n      freshnessScore: Math.round(freshnessScore),\n      maintenanceScore: Math.round(maintenanceScore),\n    };\n  }\n\n  private calculateSingleHealthScore(\n    dep: { name: string; version: string; isDev: boolean },\n    vulns: Array<{ severity: string; description: string }>,\n    outdated: { isOutdated: boolean; pattern?: string }\n  ): number {\n    let score = 100;\n\n    // Deduct for vulnerabilities\n    for (const vuln of vulns) {\n      switch (vuln.severity) {\n        case 'critical': score -= 40; break;\n        case 'high': score -= 25; break;\n        case 'moderate': score -= 15; break;\n        case 'low': score -= 5; break;\n      }\n    }\n\n    // Deduct for outdated\n    if (outdated.isOutdated) {\n      score -= 15;\n    }\n\n    return Math.max(0, score);\n  }\n\n  private generateEntities(\n    deps: Array<{ name: string; version: string; isDev: boolean }>,\n    vulnerabilities: Map<string, Array<{ severity: string; description: string }>>,\n    outdatedInfo: Map<string, { isOutdated: boolean; pattern?: string }>\n  ): NonNullable<AnalysisResult['entities']> {\n    return deps.map((dep, index) => {\n      const vulns = vulnerabilities.get(dep.name) ?? [];\n      const outdated = outdatedInfo.get(dep.name) ?? { isOutdated: false };\n      const score = this.calculateSingleHealthScore(dep, vulns, outdated);\n\n      return {\n        id: `dep:${dep.name.replace(/[@/]/g, '-')}`,\n        type: 'dependency',\n        value: dep.name,\n        confidence: 0.95,\n        position: { start: index, end: index + 1 },\n        metadata: {\n          version: dep.version,\n          isDev: dep.isDev,\n          healthScore: score,\n          hasVulnerabilities: vulns.length > 0,\n          vulnerabilities: vulns,\n          isOutdated: outdated.isOutdated,\n          outdatedReason: outdated.pattern,\n        },\n      };\n    });\n  }\n\n  private generateRelationships(\n    deps: Array<{ name: string; version: string; isDev: boolean }>,\n    pkg: PackageJson\n  ): NonNullable<AnalysisResult['relationships']> {\n    const relationships: NonNullable<AnalysisResult['relationships']> = [];\n    const projectId = `project:${pkg.name ?? 'unknown'}`;\n\n    // Create relationships from project to each dependency\n    for (const dep of deps) {\n      relationships.push({\n        sourceId: projectId,\n        targetId: `dep:${dep.name.replace(/[@/]/g, '-')}`,\n        type: dep.isDev ? 'dev-depends-on' : 'depends-on',\n        confidence: 1,\n        metadata: { version: dep.version },\n      });\n    }\n\n    // Create relationships between scoped packages\n    const scopedDeps = deps.filter(d => d.name.startsWith('@'));\n    const scopeGroups = new Map<string, string[]>();\n\n    for (const dep of scopedDeps) {\n      const scope = dep.name.split('/')[0];\n      const existing = scopeGroups.get(scope) ?? [];\n      existing.push(dep.name);\n      scopeGroups.set(scope, existing);\n    }\n\n    for (const [, packages] of scopeGroups) {\n      if (packages.length > 1) {\n        for (let i = 0; i < packages.length - 1; i++) {\n          relationships.push({\n            sourceId: `dep:${packages[i].replace(/[@/]/g, '-')}`,\n            targetId: `dep:${packages[i + 1].replace(/[@/]/g, '-')}`,\n            type: 'related',\n            confidence: 0.8,\n          });\n        }\n      }\n    }\n\n    return relationships;\n  }\n\n  private generateTags(\n    metrics: DependencyHealthMetrics,\n    vulnerabilities: Map<string, Array<{ severity: string; description: string }>>\n  ): NonNullable<AnalysisResult['tags']> {\n    const tags: NonNullable<AnalysisResult['tags']> = [];\n\n    // Health status tag\n    if (metrics.averageHealthScore >= 80) {\n      tags.push({ value: 'healthy-dependencies', confidence: 0.9, category: 'health' });\n    } else if (metrics.averageHealthScore >= 50) {\n      tags.push({ value: 'needs-attention', confidence: 0.9, category: 'health' });\n    } else {\n      tags.push({ value: 'critical-issues', confidence: 0.9, category: 'health' });\n    }\n\n    // Security tags\n    if (vulnerabilities.size > 0) {\n      tags.push({ value: 'has-vulnerabilities', confidence: 1, category: 'security' });\n\n      const hasCritical = Array.from(vulnerabilities.values())\n        .flat()\n        .some(v => v.severity === 'critical');\n\n      if (hasCritical) {\n        tags.push({ value: 'critical-vulnerabilities', confidence: 1, category: 'security' });\n      }\n    } else {\n      tags.push({ value: 'no-known-vulnerabilities', confidence: 0.8, category: 'security' });\n    }\n\n    // Maintenance tags\n    if (metrics.outdatedCount > 0) {\n      tags.push({ value: 'has-outdated-deps', confidence: 0.9, category: 'maintenance' });\n    }\n\n    // Size tags\n    if (metrics.totalDependencies > 100) {\n      tags.push({ value: 'large-dependency-tree', confidence: 0.9, category: 'size' });\n    } else if (metrics.totalDependencies > 50) {\n      tags.push({ value: 'medium-dependency-tree', confidence: 0.9, category: 'size' });\n    } else {\n      tags.push({ value: 'small-dependency-tree', confidence: 0.9, category: 'size' });\n    }\n\n    return tags;\n  }\n\n  private generateSuggestions(\n    vulnerabilities: Map<string, Array<{ severity: string; description: string }>>,\n    outdatedInfo: Map<string, { isOutdated: boolean; pattern?: string }>,\n    metrics: DependencyHealthMetrics\n  ): AnalysisResult['suggestions'] {\n    const suggestions: AnalysisResult['suggestions'] = [];\n\n    // Security suggestions\n    if (vulnerabilities.size > 0) {\n      suggestions.push({\n        type: 'other',\n        message: `Run 'npm audit fix' to address ${vulnerabilities.size} package(s) with known vulnerabilities`,\n        confidence: 0.95,\n        action: { command: 'npm audit fix' },\n      });\n\n      for (const [name, vulns] of vulnerabilities) {\n        const critical = vulns.filter(v => v.severity === 'critical' || v.severity === 'high');\n        if (critical.length > 0) {\n          suggestions.push({\n            type: 'other',\n            message: `Update ${name} to address: ${critical[0].description}`,\n            confidence: 0.9,\n            action: { package: name, severity: critical[0].severity },\n          });\n        }\n      }\n    }\n\n    // Outdated suggestions\n    const outdatedPackages = Array.from(outdatedInfo.entries())\n      .filter(([, info]) => info.isOutdated)\n      .map(([name]) => name);\n\n    if (outdatedPackages.length > 0) {\n      suggestions.push({\n        type: 'other',\n        message: `Consider updating ${outdatedPackages.length} package(s) with outdated version patterns`,\n        confidence: 0.7,\n      });\n    }\n\n    // Health improvement suggestions\n    if (metrics.averageHealthScore < 70) {\n      suggestions.push({\n        type: 'add_content',\n        message: 'Consider auditing and updating dependencies to improve overall health score',\n        confidence: 0.8,\n      });\n    }\n\n    return suggestions;\n  }\n\n  private generateSummary(\n    metrics: DependencyHealthMetrics,\n    vulnerabilities: Map<string, Array<{ severity: string; description: string }>>,\n    outdatedInfo: Map<string, { isOutdated: boolean; pattern?: string }>\n  ): string {\n    const parts: string[] = [];\n\n    parts.push(`Analyzed ${metrics.totalDependencies} dependencies.`);\n    parts.push(`Average health score: ${metrics.averageHealthScore}/100.`);\n\n    if (vulnerabilities.size > 0) {\n      parts.push(`Found ${vulnerabilities.size} package(s) with known vulnerabilities.`);\n    }\n\n    if (metrics.outdatedCount > 0) {\n      parts.push(`${metrics.outdatedCount} package(s) may be outdated.`);\n    }\n\n    parts.push(`Health distribution: ${metrics.healthyCount} healthy, ${metrics.warningCount} warning, ${metrics.criticalCount} critical.`);\n\n    return parts.join(' ');\n  }\n\n  private createSuccessResult(\n    inputId: string,\n    startTime: number,\n    data: Partial<AnalysisResult>\n  ): AnalysisResult {\n    return {\n      success: true,\n      analysisType: 'dependency-health',\n      entities: data.entities ?? [],\n      relationships: data.relationships ?? [],\n      tags: data.tags ?? [],\n      summary: data.summary,\n      qualityScore: data.qualityScore,\n      metrics: {\n        durationMs: Date.now() - startTime,\n        ...data.metrics,\n      },\n      suggestions: data.suggestions,\n      raw: data.raw,\n    };\n  }\n\n  private createErrorResult(\n    inputId: string,\n    code: string,\n    message: string\n  ): AnalysisResult {\n    return {\n      success: false,\n      analysisType: 'dependency-health',\n      error: { code, message },\n    };\n  }\n}\n\n/**\n * Factory function to create a DependencyHealthAnalyzerPlugin instance\n */\nexport function createDependencyHealthAnalyzerPlugin(\n  config?: Partial<DependencyAnalyzerPluginConfig>\n): DependencyHealthAnalyzerPlugin {\n  return new DependencyHealthAnalyzerPlugin(config);\n}\n"],"names":[],"mappings":"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"}