{"version":3,"file":"index.js","sources":["../../src/reasoning/index.ts"],"sourcesContent":["/**\n * Reasoning Module\n *\n * Provides decision tracking, reasoning chains, and explainability.\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport type DecisionType =\n  | 'classification'\n  | 'selection'\n  | 'routing'\n  | 'prioritization'\n  | 'validation'\n  | 'transformation';\n\nexport type ConfidenceLevel = 'very_low' | 'low' | 'medium' | 'high' | 'very_high';\n\nexport interface DecisionContext {\n  id: string;\n  input: Record<string, unknown>;\n  options?: string[];\n  constraints?: string[];\n  timestamp: Date;\n}\n\nexport interface Alternative {\n  id: string;\n  description: string;\n  score: number;\n  reasonNotSelected?: string;\n}\n\nexport interface DecisionOutcome {\n  selected: string;\n  confidence: ConfidenceLevel;\n  confidenceScore: number;\n  alternatives: Alternative[];\n  reasoning: string[];\n}\n\nexport interface Decision {\n  id: string;\n  type: DecisionType;\n  context: DecisionContext;\n  outcome: DecisionOutcome;\n  duration: number;\n  metadata?: Record<string, unknown>;\n}\n\nexport interface ReasoningChain {\n  id: string;\n  decisions: Decision[];\n  conclusion?: string;\n  confidence: ConfidenceLevel;\n  totalDuration: number;\n  metadata?: Record<string, unknown>;\n}\n\n// ============================================================================\n// Decision Tracker\n// ============================================================================\n\nexport class DecisionTracker {\n  private decisions: Map<string, Decision> = new Map();\n  private chains: Map<string, ReasoningChain> = new Map();\n  private currentChainId?: string;\n\n  startChain(metadata?: Record<string, unknown>): string {\n    const id = `chain-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;\n\n    this.chains.set(id, {\n      id,\n      decisions: [],\n      confidence: 'medium',\n      totalDuration: 0,\n      metadata,\n    });\n\n    this.currentChainId = id;\n    return id;\n  }\n\n  endChain(conclusion?: string): ReasoningChain | undefined {\n    if (!this.currentChainId) return undefined;\n\n    const chain = this.chains.get(this.currentChainId);\n    if (chain) {\n      chain.conclusion = conclusion;\n      chain.totalDuration = chain.decisions.reduce((sum, d) => sum + d.duration, 0);\n      chain.confidence = this.calculateChainConfidence(chain);\n    }\n\n    this.currentChainId = undefined;\n    return chain;\n  }\n\n  recordDecision(\n    type: DecisionType,\n    context: Omit<DecisionContext, 'id' | 'timestamp'>,\n    outcome: DecisionOutcome,\n    duration: number,\n    metadata?: Record<string, unknown>\n  ): Decision {\n    const id = `decision-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;\n\n    const decision: Decision = {\n      id,\n      type,\n      context: {\n        ...context,\n        id: `ctx-${id}`,\n        timestamp: new Date(),\n      },\n      outcome,\n      duration,\n      metadata,\n    };\n\n    this.decisions.set(id, decision);\n\n    if (this.currentChainId) {\n      const chain = this.chains.get(this.currentChainId);\n      if (chain) {\n        chain.decisions.push(decision);\n      }\n    }\n\n    return decision;\n  }\n\n  getDecision(id: string): Decision | undefined {\n    return this.decisions.get(id);\n  }\n\n  getChain(id: string): ReasoningChain | undefined {\n    return this.chains.get(id);\n  }\n\n  getAllDecisions(): Decision[] {\n    return Array.from(this.decisions.values());\n  }\n\n  getAllChains(): ReasoningChain[] {\n    return Array.from(this.chains.values());\n  }\n\n  getDecisionsByType(type: DecisionType): Decision[] {\n    return Array.from(this.decisions.values()).filter((d) => d.type === type);\n  }\n\n  getRecentDecisions(limit: number = 10): Decision[] {\n    return Array.from(this.decisions.values())\n      .sort((a, b) => b.context.timestamp.getTime() - a.context.timestamp.getTime())\n      .slice(0, limit);\n  }\n\n  getStatistics(): {\n    totalDecisions: number;\n    totalChains: number;\n    averageDuration: number;\n    byType: Record<DecisionType, number>;\n    byConfidence: Record<ConfidenceLevel, number>;\n  } {\n    const decisions = Array.from(this.decisions.values());\n    const byType: Record<string, number> = {};\n    const byConfidence: Record<string, number> = {};\n\n    let totalDuration = 0;\n\n    for (const decision of decisions) {\n      byType[decision.type] = (byType[decision.type] || 0) + 1;\n      byConfidence[decision.outcome.confidence] =\n        (byConfidence[decision.outcome.confidence] || 0) + 1;\n      totalDuration += decision.duration;\n    }\n\n    return {\n      totalDecisions: decisions.length,\n      totalChains: this.chains.size,\n      averageDuration: decisions.length > 0 ? totalDuration / decisions.length : 0,\n      byType: byType as Record<DecisionType, number>,\n      byConfidence: byConfidence as Record<ConfidenceLevel, number>,\n    };\n  }\n\n  export(): {\n    decisions: Decision[];\n    chains: ReasoningChain[];\n    exportedAt: Date;\n  } {\n    return {\n      decisions: Array.from(this.decisions.values()),\n      chains: Array.from(this.chains.values()),\n      exportedAt: new Date(),\n    };\n  }\n\n  clear(): void {\n    this.decisions.clear();\n    this.chains.clear();\n    this.currentChainId = undefined;\n  }\n\n  private calculateChainConfidence(chain: ReasoningChain): ConfidenceLevel {\n    if (chain.decisions.length === 0) return 'medium';\n\n    const avgScore =\n      chain.decisions.reduce((sum, d) => sum + d.outcome.confidenceScore, 0) /\n      chain.decisions.length;\n\n    if (avgScore >= 0.9) return 'very_high';\n    if (avgScore >= 0.7) return 'high';\n    if (avgScore >= 0.5) return 'medium';\n    if (avgScore >= 0.3) return 'low';\n    return 'very_low';\n  }\n}\n\n// ============================================================================\n// Singleton Instance\n// ============================================================================\n\nlet defaultTracker: DecisionTracker | undefined;\n\nexport function createDecisionTracker(): DecisionTracker {\n  return new DecisionTracker();\n}\n\nexport function getDecisionTracker(): DecisionTracker {\n  if (!defaultTracker) {\n    defaultTracker = new DecisionTracker();\n  }\n  return defaultTracker;\n}\n"],"names":[],"mappings":"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"}