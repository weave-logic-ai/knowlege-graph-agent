{"version":3,"file":"gap-analyzer.js","sources":["../../src/sops/gap-analyzer.ts"],"sourcesContent":["/**\n * SOP Gap Analyzer\n *\n * Analyzes compliance gaps and generates remediation recommendations.\n *\n * @module sops/gap-analyzer\n */\n\nimport {\n  SOPDefinition,\n  SOPRequirement,\n  SOPAssessment,\n  ComplianceGap,\n  ComplianceStatus,\n  SOPPriority,\n  SOPCategory,\n} from './types.js';\nimport { getSOPById, getAllSOPs, getSOPsByCategory } from './registry.js';\nimport { ComplianceCheckResult } from './compliance-checker.js';\nimport { createLogger } from '../utils/logger.js';\n\nconst logger = createLogger('gap-analyzer');\n\n/**\n * Gap analysis options\n */\nexport interface GapAnalysisOptions {\n  /** Minimum score threshold to consider compliant */\n  complianceThreshold?: number;\n\n  /** Include SOPs with partial compliance */\n  includePartial?: boolean;\n\n  /** Filter by priority */\n  minPriority?: SOPPriority;\n\n  /** Filter by category */\n  categories?: SOPCategory[];\n\n  /** Generate remediation plans */\n  generateRemediation?: boolean;\n}\n\n/**\n * Gap analysis result\n */\nexport interface GapAnalysisResult {\n  /** All identified gaps */\n  gaps: ComplianceGap[];\n\n  /** Gaps grouped by priority */\n  byPriority: Record<SOPPriority, ComplianceGap[]>;\n\n  /** Gaps grouped by category */\n  byCategory: Record<SOPCategory, ComplianceGap[]>;\n\n  /** Total gap count */\n  totalGaps: number;\n\n  /** Critical gaps that need immediate attention */\n  criticalGaps: ComplianceGap[];\n\n  /** Summary statistics */\n  summary: GapSummary;\n\n  /** Remediation roadmap */\n  roadmap?: RemediationRoadmap;\n}\n\n/**\n * Gap summary statistics\n */\nexport interface GapSummary {\n  /** Total requirements checked */\n  totalRequirements: number;\n\n  /** Requirements met */\n  requirementsMet: number;\n\n  /** Requirements with gaps */\n  requirementsGaps: number;\n\n  /** Compliance percentage */\n  compliancePercentage: number;\n\n  /** Effort estimate (total) */\n  totalEffort: {\n    low: number;\n    medium: number;\n    high: number;\n  };\n\n  /** Estimated remediation complexity */\n  overallComplexity: 'low' | 'medium' | 'high';\n}\n\n/**\n * Remediation roadmap\n */\nexport interface RemediationRoadmap {\n  /** Phases of remediation */\n  phases: RemediationPhase[];\n\n  /** Quick wins (low effort, high impact) */\n  quickWins: ComplianceGap[];\n\n  /** Dependencies between gaps */\n  dependencies: GapDependency[];\n}\n\n/**\n * Remediation phase\n */\nexport interface RemediationPhase {\n  /** Phase number */\n  phase: number;\n\n  /** Phase name */\n  name: string;\n\n  /** Gaps to address in this phase */\n  gaps: ComplianceGap[];\n\n  /** Focus area */\n  focus: string;\n\n  /** Expected effort */\n  effort: 'low' | 'medium' | 'high';\n}\n\n/**\n * Gap dependency\n */\nexport interface GapDependency {\n  /** Gap that depends on another */\n  gapId: string;\n\n  /** Gap that must be addressed first */\n  dependsOn: string;\n\n  /** Reason for dependency */\n  reason: string;\n}\n\n/**\n * Remediation templates for common gaps\n */\nconst REMEDIATION_TEMPLATES: Record<string, string> = {\n  'requirements-definition': 'Create a requirements document using the provided template. Include functional requirements, non-functional requirements, and acceptance criteria for each feature.',\n  'architecture-documentation': 'Document the system architecture using C4 diagrams or similar notation. Include system context, containers, components, and deployment views.',\n  'testing-infrastructure': 'Set up a comprehensive test suite including unit tests, integration tests, and end-to-end tests. Aim for at least 80% code coverage.',\n  'security-assessment': 'Conduct a security assessment including threat modeling, vulnerability scanning, and penetration testing. Document findings and remediation steps.',\n  'bias-fairness-assessment': 'Perform a bias and fairness assessment of AI/ML models. Document potential biases, mitigation strategies, and ongoing monitoring plans.',\n  'monitoring-setup': 'Implement comprehensive monitoring including metrics collection, alerting, and dashboards. Cover application health, performance, and business metrics.',\n  'documentation': 'Create or update documentation including README, API documentation, deployment guides, and operational runbooks.',\n  'ci-cd-pipeline': 'Set up CI/CD pipelines including automated testing, security scanning, and deployment automation.',\n  'data-governance': 'Establish data governance policies including data classification, retention, access controls, and privacy compliance.',\n  'change-management': 'Implement change management processes including code review, approval workflows, and rollback procedures.',\n  'incident-response': 'Create incident response procedures including escalation paths, communication templates, and post-mortem processes.',\n  'risk-management': 'Conduct risk assessment and create risk register with mitigation strategies and ownership assignments.',\n};\n\n/**\n * Effort estimation factors\n */\nconst EFFORT_FACTORS: Record<string, 'low' | 'medium' | 'high'> = {\n  'document': 'low',\n  'test': 'medium',\n  'review': 'medium',\n  'audit': 'high',\n  'automated': 'high',\n};\n\n/**\n * Analyze compliance gaps from check results\n */\nexport function analyzeGaps(\n  checkResult: ComplianceCheckResult,\n  options: GapAnalysisOptions = {}\n): GapAnalysisResult {\n  const {\n    complianceThreshold = 90,\n    includePartial = true,\n    minPriority,\n    categories,\n    generateRemediation = true,\n  } = options;\n\n  logger.info('Analyzing compliance gaps', {\n    assessments: checkResult.assessments.length,\n    threshold: complianceThreshold,\n  });\n\n  const gaps: ComplianceGap[] = [];\n  let gapIdCounter = 1;\n\n  // Process each assessment\n  for (const assessment of checkResult.assessments) {\n    // Skip if above threshold\n    if (assessment.score >= complianceThreshold) continue;\n\n    // Skip partial if not included\n    if (!includePartial && assessment.status === ComplianceStatus.PARTIAL) continue;\n\n    const sop = getSOPById(assessment.sopId);\n    if (!sop) continue;\n\n    // Filter by priority\n    if (minPriority && !isPriorityAtLeast(sop.priority, minPriority)) continue;\n\n    // Filter by category\n    if (categories && !categories.includes(sop.category)) continue;\n\n    // Create gap for each unmet requirement\n    for (const reqId of assessment.requirementsGaps) {\n      const requirement = sop.requirements.find(r => r.id === reqId);\n      if (!requirement) continue;\n\n      const gap = createGap(\n        `gap-${gapIdCounter++}`,\n        sop,\n        requirement,\n        assessment\n      );\n      gaps.push(gap);\n    }\n  }\n\n  // Group by priority and category\n  const byPriority = groupByPriority(gaps);\n  const byCategory = groupByCategory(gaps);\n\n  // Identify critical gaps\n  const criticalGaps = gaps.filter(g => g.priority === SOPPriority.CRITICAL);\n\n  // Calculate summary\n  const summary = calculateSummary(checkResult, gaps);\n\n  // Generate roadmap if requested\n  let roadmap: RemediationRoadmap | undefined;\n  if (generateRemediation) {\n    roadmap = generateRemediationRoadmap(gaps, byPriority);\n  }\n\n  logger.info('Gap analysis complete', {\n    totalGaps: gaps.length,\n    criticalGaps: criticalGaps.length,\n    compliancePercentage: summary.compliancePercentage,\n  });\n\n  return {\n    gaps,\n    byPriority,\n    byCategory,\n    totalGaps: gaps.length,\n    criticalGaps,\n    summary,\n    roadmap,\n  };\n}\n\n/**\n * Create a compliance gap object\n */\nfunction createGap(\n  id: string,\n  sop: SOPDefinition,\n  requirement: SOPRequirement,\n  assessment: SOPAssessment\n): ComplianceGap {\n  const effort = EFFORT_FACTORS[requirement.verification] || 'medium';\n  const remediation = generateRemediation(sop, requirement);\n\n  return {\n    id,\n    sopId: sop.id,\n    requirementId: requirement.id,\n    description: `${sop.title}: ${requirement.description}`,\n    priority: requirement.mandatory ? sop.priority : lowerPriority(sop.priority),\n    impact: generateImpactDescription(sop, requirement),\n    remediation,\n    effort,\n    status: 'open',\n    createdAt: new Date(),\n  };\n}\n\n/**\n * Generate remediation recommendation\n */\nfunction generateRemediation(sop: SOPDefinition, requirement: SOPRequirement): string {\n  // Check for template match\n  for (const [key, template] of Object.entries(REMEDIATION_TEMPLATES)) {\n    if (sop.id.toLowerCase().includes(key) ||\n        requirement.description.toLowerCase().includes(key)) {\n      return template;\n    }\n  }\n\n  // Generate based on verification method\n  switch (requirement.verification) {\n    case 'document':\n      return `Create documentation to address: ${requirement.description}. Required evidence: ${requirement.evidence.join(', ')}.`;\n    case 'test':\n      return `Implement tests to verify: ${requirement.description}. Ensure tests cover the specified acceptance criteria.`;\n    case 'review':\n      return `Schedule a review meeting to assess: ${requirement.description}. Document findings and action items.`;\n    case 'audit':\n      return `Conduct an audit to verify: ${requirement.description}. Create audit trail and compliance report.`;\n    case 'automated':\n      return `Implement automated checks for: ${requirement.description}. Integrate into CI/CD pipeline.`;\n    default:\n      return `Address requirement: ${requirement.description}`;\n  }\n}\n\n/**\n * Generate impact description\n */\nfunction generateImpactDescription(sop: SOPDefinition, requirement: SOPRequirement): string {\n  const impacts: string[] = [];\n\n  if (requirement.mandatory) {\n    impacts.push('This is a mandatory requirement');\n  }\n\n  switch (sop.category) {\n    case SOPCategory.GOVERNANCE:\n      impacts.push('May affect regulatory compliance and audit readiness');\n      break;\n    case SOPCategory.DEVELOPMENT:\n      impacts.push('May impact code quality and maintainability');\n      break;\n    case SOPCategory.OPERATIONS:\n      impacts.push('May affect system reliability and operations');\n      break;\n    case SOPCategory.QUALITY:\n      impacts.push('May impact overall quality assurance');\n      break;\n    case SOPCategory.PROGRAM_MANAGEMENT:\n      impacts.push('May affect project governance and tracking');\n      break;\n  }\n\n  if (sop.irbTypicallyRequired) {\n    impacts.push('AI-IRB review may be required');\n  }\n\n  return impacts.join('. ');\n}\n\n/**\n * Group gaps by priority\n */\nfunction groupByPriority(gaps: ComplianceGap[]): Record<SOPPriority, ComplianceGap[]> {\n  const result: Record<SOPPriority, ComplianceGap[]> = {\n    [SOPPriority.CRITICAL]: [],\n    [SOPPriority.HIGH]: [],\n    [SOPPriority.MEDIUM]: [],\n    [SOPPriority.LOW]: [],\n  };\n\n  for (const gap of gaps) {\n    result[gap.priority].push(gap);\n  }\n\n  return result;\n}\n\n/**\n * Group gaps by category\n */\nfunction groupByCategory(gaps: ComplianceGap[]): Record<SOPCategory, ComplianceGap[]> {\n  const result: Record<SOPCategory, ComplianceGap[]> = {\n    [SOPCategory.PROGRAM_MANAGEMENT]: [],\n    [SOPCategory.OPERATIONS]: [],\n    [SOPCategory.DEVELOPMENT]: [],\n    [SOPCategory.GOVERNANCE]: [],\n    [SOPCategory.QUALITY]: [],\n  };\n\n  for (const gap of gaps) {\n    const sop = getSOPById(gap.sopId);\n    if (sop) {\n      result[sop.category].push(gap);\n    }\n  }\n\n  return result;\n}\n\n/**\n * Calculate gap summary\n */\nfunction calculateSummary(\n  checkResult: ComplianceCheckResult,\n  gaps: ComplianceGap[]\n): GapSummary {\n  let totalRequirements = 0;\n  let requirementsMet = 0;\n\n  for (const assessment of checkResult.assessments) {\n    totalRequirements += assessment.requirementsMet.length + assessment.requirementsGaps.length;\n    requirementsMet += assessment.requirementsMet.length;\n  }\n\n  const requirementsGaps = totalRequirements - requirementsMet;\n  const compliancePercentage = totalRequirements > 0\n    ? Math.round((requirementsMet / totalRequirements) * 100)\n    : 0;\n\n  // Count effort levels\n  const totalEffort = {\n    low: gaps.filter(g => g.effort === 'low').length,\n    medium: gaps.filter(g => g.effort === 'medium').length,\n    high: gaps.filter(g => g.effort === 'high').length,\n  };\n\n  // Determine overall complexity\n  let overallComplexity: 'low' | 'medium' | 'high';\n  if (totalEffort.high > gaps.length * 0.3 || gaps.length > 20) {\n    overallComplexity = 'high';\n  } else if (totalEffort.medium > gaps.length * 0.5 || gaps.length > 10) {\n    overallComplexity = 'medium';\n  } else {\n    overallComplexity = 'low';\n  }\n\n  return {\n    totalRequirements,\n    requirementsMet,\n    requirementsGaps,\n    compliancePercentage,\n    totalEffort,\n    overallComplexity,\n  };\n}\n\n/**\n * Generate remediation roadmap\n */\nfunction generateRemediationRoadmap(\n  gaps: ComplianceGap[],\n  byPriority: Record<SOPPriority, ComplianceGap[]>\n): RemediationRoadmap {\n  const phases: RemediationPhase[] = [];\n  const dependencies: GapDependency[] = [];\n\n  // Phase 1: Critical gaps\n  if (byPriority[SOPPriority.CRITICAL].length > 0) {\n    phases.push({\n      phase: 1,\n      name: 'Critical Remediation',\n      gaps: byPriority[SOPPriority.CRITICAL],\n      focus: 'Address critical compliance gaps immediately',\n      effort: 'high',\n    });\n  }\n\n  // Phase 2: High priority gaps\n  if (byPriority[SOPPriority.HIGH].length > 0) {\n    phases.push({\n      phase: phases.length + 1,\n      name: 'High Priority Remediation',\n      gaps: byPriority[SOPPriority.HIGH],\n      focus: 'Address high-priority gaps to improve compliance posture',\n      effort: 'high',\n    });\n  }\n\n  // Phase 3: Medium priority gaps\n  if (byPriority[SOPPriority.MEDIUM].length > 0) {\n    phases.push({\n      phase: phases.length + 1,\n      name: 'Standard Remediation',\n      gaps: byPriority[SOPPriority.MEDIUM],\n      focus: 'Address medium-priority gaps for comprehensive compliance',\n      effort: 'medium',\n    });\n  }\n\n  // Phase 4: Low priority gaps\n  if (byPriority[SOPPriority.LOW].length > 0) {\n    phases.push({\n      phase: phases.length + 1,\n      name: 'Enhancement',\n      gaps: byPriority[SOPPriority.LOW],\n      focus: 'Address remaining gaps for full compliance',\n      effort: 'low',\n    });\n  }\n\n  // Identify quick wins (low effort from any priority)\n  const quickWins = gaps.filter(g =>\n    g.effort === 'low' &&\n    (g.priority === SOPPriority.HIGH || g.priority === SOPPriority.CRITICAL)\n  );\n\n  // Identify dependencies\n  // Governance gaps should be addressed before development gaps\n  const governanceGaps = gaps.filter(g => {\n    const sop = getSOPById(g.sopId);\n    return sop?.category === SOPCategory.GOVERNANCE;\n  });\n\n  const developmentGaps = gaps.filter(g => {\n    const sop = getSOPById(g.sopId);\n    return sop?.category === SOPCategory.DEVELOPMENT;\n  });\n\n  for (const devGap of developmentGaps) {\n    for (const govGap of governanceGaps) {\n      if (govGap.priority === SOPPriority.CRITICAL || govGap.priority === SOPPriority.HIGH) {\n        dependencies.push({\n          gapId: devGap.id,\n          dependsOn: govGap.id,\n          reason: 'Governance requirements should be established before development practices',\n        });\n        break; // Only add one dependency per dev gap\n      }\n    }\n  }\n\n  return {\n    phases,\n    quickWins,\n    dependencies,\n  };\n}\n\n/**\n * Check if priority is at least a certain level\n */\nfunction isPriorityAtLeast(priority: SOPPriority, minimum: SOPPriority): boolean {\n  const levels = {\n    [SOPPriority.LOW]: 1,\n    [SOPPriority.MEDIUM]: 2,\n    [SOPPriority.HIGH]: 3,\n    [SOPPriority.CRITICAL]: 4,\n  };\n\n  return levels[priority] >= levels[minimum];\n}\n\n/**\n * Lower priority by one level\n */\nfunction lowerPriority(priority: SOPPriority): SOPPriority {\n  switch (priority) {\n    case SOPPriority.CRITICAL:\n      return SOPPriority.HIGH;\n    case SOPPriority.HIGH:\n      return SOPPriority.MEDIUM;\n    case SOPPriority.MEDIUM:\n      return SOPPriority.LOW;\n    case SOPPriority.LOW:\n      return SOPPriority.LOW;\n  }\n}\n\n/**\n * Get gaps for a specific SOP\n */\nexport function getGapsForSOP(\n  analysisResult: GapAnalysisResult,\n  sopId: string\n): ComplianceGap[] {\n  return analysisResult.gaps.filter(g => g.sopId === sopId);\n}\n\n/**\n * Get high-impact quick wins\n */\nexport function getQuickWins(analysisResult: GapAnalysisResult): ComplianceGap[] {\n  return analysisResult.roadmap?.quickWins || [];\n}\n\n/**\n * Calculate remediation progress\n */\nexport function calculateProgress(gaps: ComplianceGap[]): {\n  total: number;\n  resolved: number;\n  inProgress: number;\n  open: number;\n  percentage: number;\n} {\n  const total = gaps.length;\n  const resolved = gaps.filter(g => g.status === 'resolved').length;\n  const inProgress = gaps.filter(g => g.status === 'in-progress').length;\n  const open = gaps.filter(g => g.status === 'open').length;\n  const percentage = total > 0 ? Math.round((resolved / total) * 100) : 100;\n\n  return { total, resolved, inProgress, open, percentage };\n}\n"],"names":["generateRemediation"],"mappings":"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"}