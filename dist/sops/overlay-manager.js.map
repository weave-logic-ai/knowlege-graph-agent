{"version":3,"file":"overlay-manager.js","sources":["../../src/sops/overlay-manager.ts"],"sourcesContent":["/**\n * SOP Overlay Manager\n *\n * Manages multi-layer knowledge graph overlays for SOP compliance visualization.\n * Supports standards layer, project layer, and compliance overlay.\n *\n * @module sops/overlay-manager\n */\n\nimport {\n  GraphLayer,\n  LayerDefinition,\n  LayerNode,\n  LayerEdge,\n  MultiLayerGraph,\n  SOPDefinition,\n  ComplianceStatus,\n  ComplianceGap,\n  SOPAssessment,\n  SOPCategory,\n} from './types.js';\nimport { getAllSOPs, getSOPById, getSOPsByCategory } from './registry.js';\nimport { ComplianceCheckResult } from './compliance-checker.js';\nimport { GapAnalysisResult } from './gap-analyzer.js';\nimport { createLogger } from '../utils/logger.js';\n\nconst logger = createLogger('overlay-manager');\n\n/**\n * Overlay manager options\n */\nexport interface OverlayManagerOptions {\n  /** Graph ID */\n  graphId?: string;\n\n  /** Graph name */\n  graphName?: string;\n\n  /** Include all SOPs in standards layer */\n  includeAllSOPs?: boolean;\n\n  /** SOP categories to include */\n  categories?: SOPCategory[];\n\n  /** Custom node styling */\n  nodeStyles?: NodeStyleConfig;\n}\n\n/**\n * Node style configuration\n */\nexport interface NodeStyleConfig {\n  /** Colors by compliance status */\n  statusColors?: Record<ComplianceStatus, string>;\n\n  /** Colors by layer */\n  layerColors?: Record<GraphLayer, string>;\n\n  /** Node size by type */\n  nodeSizes?: Record<string, number>;\n}\n\n/**\n * Default node styles\n */\nconst DEFAULT_STYLES: Required<NodeStyleConfig> = {\n  statusColors: {\n    [ComplianceStatus.COMPLIANT]: '#22c55e',      // green\n    [ComplianceStatus.PARTIAL]: '#f59e0b',         // amber\n    [ComplianceStatus.NON_COMPLIANT]: '#ef4444',   // red\n    [ComplianceStatus.NOT_APPLICABLE]: '#9ca3af',  // gray\n    [ComplianceStatus.PENDING]: '#6b7280',         // dark gray\n  },\n  layerColors: {\n    [GraphLayer.STANDARDS]: '#3b82f6',   // blue\n    [GraphLayer.PROJECT]: '#8b5cf6',     // purple\n    [GraphLayer.COMPLIANCE]: '#ec4899',  // pink\n    [GraphLayer.CUSTOM]: '#06b6d4',      // cyan\n  },\n  nodeSizes: {\n    'sop': 30,\n    'requirement': 20,\n    'artifact': 15,\n    'gap': 25,\n    'category': 35,\n  },\n};\n\n/**\n * Create a multi-layer graph with SOP standards overlay\n */\nexport function createMultiLayerGraph(\n  options: OverlayManagerOptions = {}\n): MultiLayerGraph {\n  const {\n    graphId = `mlg-${Date.now()}`,\n    graphName = 'AI-SDLC Compliance Graph',\n    includeAllSOPs = true,\n    categories,\n  } = options;\n\n  logger.info('Creating multi-layer graph', { graphId, graphName });\n\n  // Create layer definitions\n  const layers: LayerDefinition[] = [\n    {\n      id: 'standards-layer',\n      name: 'AI-SDLC Standards',\n      type: GraphLayer.STANDARDS,\n      description: 'Reference layer containing AI-SDLC SOP definitions',\n      visible: true,\n      order: 0,\n    },\n    {\n      id: 'project-layer',\n      name: 'Project Implementation',\n      type: GraphLayer.PROJECT,\n      description: 'Project-specific nodes and artifacts',\n      visible: true,\n      order: 1,\n    },\n    {\n      id: 'compliance-layer',\n      name: 'Compliance Overlay',\n      type: GraphLayer.COMPLIANCE,\n      description: 'Compliance status and gap visualization',\n      visible: true,\n      order: 2,\n    },\n  ];\n\n  // Create standards layer nodes\n  const nodes: LayerNode[] = [];\n  const edges: LayerEdge[] = [];\n\n  // Get SOPs to include\n  let sops: SOPDefinition[];\n  if (categories && categories.length > 0) {\n    sops = categories.flatMap(cat => getSOPsByCategory(cat));\n  } else if (includeAllSOPs) {\n    sops = getAllSOPs();\n  } else {\n    sops = [];\n  }\n\n  // Create category nodes\n  const categorySet = new Set(sops.map(s => s.category));\n  for (const category of categorySet) {\n    const categoryNode: LayerNode = {\n      id: `cat-${category}`,\n      title: formatCategoryName(category),\n      type: 'category',\n      layer: GraphLayer.STANDARDS,\n      tags: ['category', category],\n      metadata: {\n        category,\n        sopCount: sops.filter(s => s.category === category).length,\n      },\n    };\n    nodes.push(categoryNode);\n  }\n\n  // Create SOP nodes and edges\n  for (const sop of sops) {\n    // SOP node\n    const sopNode: LayerNode = {\n      id: `sop-${sop.id}`,\n      title: sop.title,\n      type: 'sop',\n      layer: GraphLayer.STANDARDS,\n      sopRef: sop.id,\n      tags: [...sop.tags, sop.category],\n      metadata: {\n        number: sop.number,\n        priority: sop.priority,\n        version: sop.version,\n        requirementCount: sop.requirements.length,\n        checkpointCount: sop.checkpoints.length,\n        irbRequired: sop.irbTypicallyRequired,\n      },\n    };\n    nodes.push(sopNode);\n\n    // Edge from category to SOP\n    edges.push({\n      source: `cat-${sop.category}`,\n      target: `sop-${sop.id}`,\n      type: 'references',\n      layer: GraphLayer.STANDARDS,\n      weight: 1,\n    });\n\n    // Create edges to related SOPs\n    for (const relatedId of sop.relatedSOPs) {\n      if (sops.some(s => s.id === relatedId)) {\n        edges.push({\n          source: `sop-${sop.id}`,\n          target: `sop-${relatedId}`,\n          type: 'references',\n          layer: GraphLayer.STANDARDS,\n          weight: 0.5,\n          metadata: { relationship: 'related' },\n        });\n      }\n    }\n  }\n\n  logger.info('Created standards layer', {\n    categories: categorySet.size,\n    sops: sops.length,\n    nodes: nodes.length,\n    edges: edges.length,\n  });\n\n  return {\n    id: graphId,\n    name: graphName,\n    layers,\n    nodes,\n    edges,\n    crossLayerEdges: [],\n    metadata: {\n      createdAt: new Date().toISOString(),\n      sopCount: sops.length,\n      categories: Array.from(categorySet),\n    },\n  };\n}\n\n/**\n * Add project layer to graph from knowledge graph data\n */\nexport function addProjectLayer(\n  graph: MultiLayerGraph,\n  projectNodes: Array<{ id: string; title: string; type: string; tags?: string[] }>,\n  projectEdges: Array<{ source: string; target: string; type?: string }>\n): MultiLayerGraph {\n  logger.info('Adding project layer', {\n    nodes: projectNodes.length,\n    edges: projectEdges.length,\n  });\n\n  // Add project nodes\n  for (const node of projectNodes) {\n    const layerNode: LayerNode = {\n      id: `proj-${node.id}`,\n      title: node.title,\n      type: node.type,\n      layer: GraphLayer.PROJECT,\n      tags: node.tags || [],\n    };\n    graph.nodes.push(layerNode);\n  }\n\n  // Add project edges\n  for (const edge of projectEdges) {\n    const layerEdge: LayerEdge = {\n      source: `proj-${edge.source}`,\n      target: `proj-${edge.target}`,\n      type: (edge.type as LayerEdge['type']) || 'wikilink',\n      layer: GraphLayer.PROJECT,\n      weight: 1,\n    };\n    graph.edges.push(layerEdge);\n  }\n\n  return graph;\n}\n\n/**\n * Add compliance overlay from check results\n */\nexport function addComplianceOverlay(\n  graph: MultiLayerGraph,\n  checkResult: ComplianceCheckResult,\n  gapResult?: GapAnalysisResult\n): MultiLayerGraph {\n  logger.info('Adding compliance overlay', {\n    assessments: checkResult.assessments.length,\n    gaps: gapResult?.totalGaps || 0,\n  });\n\n  // Update SOP nodes with compliance status\n  for (const assessment of checkResult.assessments) {\n    const sopNode = graph.nodes.find(n => n.sopRef === assessment.sopId);\n    if (sopNode) {\n      sopNode.complianceStatus = assessment.status;\n      sopNode.metadata = {\n        ...sopNode.metadata,\n        complianceScore: assessment.score,\n        requirementsMet: assessment.requirementsMet.length,\n        requirementsGaps: assessment.requirementsGaps.length,\n        irbStatus: assessment.irbStatus,\n        assessedAt: assessment.assessedAt.toISOString(),\n      };\n    }\n  }\n\n  // Add evidence nodes and cross-layer edges\n  for (const evidence of checkResult.evidence) {\n    // Create evidence node in project layer\n    const evidenceNode: LayerNode = {\n      id: `evidence-${evidence.requirementId}-${Date.now()}`,\n      title: evidence.description,\n      type: 'artifact',\n      layer: GraphLayer.PROJECT,\n      tags: ['evidence', evidence.type],\n      metadata: {\n        filePath: evidence.filePath,\n        confidence: evidence.confidence,\n        excerpt: evidence.excerpt,\n      },\n    };\n    graph.nodes.push(evidenceNode);\n\n    // Find the SOP node for this requirement\n    const sopId = findSOPForRequirement(evidence.requirementId);\n    if (sopId) {\n      // Cross-layer edge from evidence to SOP\n      graph.crossLayerEdges.push({\n        source: evidenceNode.id,\n        target: `sop-${sopId}`,\n        type: 'implements',\n        layer: GraphLayer.COMPLIANCE,\n        weight: evidence.confidence,\n        metadata: {\n          requirementId: evidence.requirementId,\n          evidenceType: evidence.type,\n        },\n      });\n    }\n  }\n\n  // Add gap nodes if gap analysis provided\n  if (gapResult) {\n    for (const gap of gapResult.gaps) {\n      // Create gap node\n      const gapNode: LayerNode = {\n        id: `gap-${gap.id}`,\n        title: `Gap: ${gap.description.substring(0, 50)}...`,\n        type: 'gap',\n        layer: GraphLayer.COMPLIANCE,\n        complianceStatus: ComplianceStatus.NON_COMPLIANT,\n        tags: ['gap', gap.priority, gap.status],\n        metadata: {\n          sopId: gap.sopId,\n          requirementId: gap.requirementId,\n          priority: gap.priority,\n          effort: gap.effort,\n          remediation: gap.remediation,\n          impact: gap.impact,\n        },\n      };\n      graph.nodes.push(gapNode);\n\n      // Cross-layer edge from gap to SOP\n      graph.crossLayerEdges.push({\n        source: gapNode.id,\n        target: `sop-${gap.sopId}`,\n        type: 'compliance-gap',\n        layer: GraphLayer.COMPLIANCE,\n        weight: 1,\n        metadata: {\n          requirementId: gap.requirementId,\n          priority: gap.priority,\n        },\n      });\n    }\n  }\n\n  // Update graph metadata\n  graph.metadata = {\n    ...graph.metadata,\n    complianceScore: checkResult.overallScore,\n    categoryScores: checkResult.categoryScores,\n    gapCount: gapResult?.totalGaps || 0,\n    checkedAt: checkResult.checkedAt.toISOString(),\n  };\n\n  return graph;\n}\n\n/**\n * Find SOP ID for a requirement ID\n */\nfunction findSOPForRequirement(requirementId: string): string | null {\n  const allSOPs = getAllSOPs();\n  for (const sop of allSOPs) {\n    if (sop.requirements.some(r => r.id === requirementId)) {\n      return sop.id;\n    }\n  }\n  return null;\n}\n\n/**\n * Format category name for display\n */\nfunction formatCategoryName(category: SOPCategory): string {\n  return category\n    .split('-')\n    .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n    .join(' ');\n}\n\n/**\n * Filter graph by layer\n */\nexport function filterByLayer(\n  graph: MultiLayerGraph,\n  layer: GraphLayer\n): { nodes: LayerNode[]; edges: LayerEdge[] } {\n  return {\n    nodes: graph.nodes.filter(n => n.layer === layer),\n    edges: graph.edges.filter(e => e.layer === layer),\n  };\n}\n\n/**\n * Filter graph by compliance status\n */\nexport function filterByComplianceStatus(\n  graph: MultiLayerGraph,\n  status: ComplianceStatus\n): { nodes: LayerNode[]; edges: LayerEdge[] } {\n  const filteredNodes = graph.nodes.filter(n => n.complianceStatus === status);\n  const nodeIds = new Set(filteredNodes.map(n => n.id));\n\n  return {\n    nodes: filteredNodes,\n    edges: graph.edges.filter(e => nodeIds.has(e.source) || nodeIds.has(e.target)),\n  };\n}\n\n/**\n * Get compliance summary from graph\n */\nexport function getComplianceSummary(graph: MultiLayerGraph): {\n  totalSOPs: number;\n  compliant: number;\n  partial: number;\n  nonCompliant: number;\n  pending: number;\n  overallScore: number;\n} {\n  const sopNodes = graph.nodes.filter(n => n.type === 'sop' && n.sopRef);\n\n  const compliant = sopNodes.filter(n => n.complianceStatus === ComplianceStatus.COMPLIANT).length;\n  const partial = sopNodes.filter(n => n.complianceStatus === ComplianceStatus.PARTIAL).length;\n  const nonCompliant = sopNodes.filter(n => n.complianceStatus === ComplianceStatus.NON_COMPLIANT).length;\n  const pending = sopNodes.filter(n =>\n    n.complianceStatus === ComplianceStatus.PENDING || !n.complianceStatus\n  ).length;\n\n  const overallScore = (graph.metadata?.complianceScore as number) || 0;\n\n  return {\n    totalSOPs: sopNodes.length,\n    compliant,\n    partial,\n    nonCompliant,\n    pending,\n    overallScore,\n  };\n}\n\n/**\n * Get gap nodes from graph\n */\nexport function getGapNodes(graph: MultiLayerGraph): LayerNode[] {\n  return graph.nodes.filter(n => n.type === 'gap');\n}\n\n/**\n * Toggle layer visibility\n */\nexport function toggleLayerVisibility(\n  graph: MultiLayerGraph,\n  layerType: GraphLayer,\n  visible: boolean\n): MultiLayerGraph {\n  const layer = graph.layers.find(l => l.type === layerType);\n  if (layer) {\n    layer.visible = visible;\n  }\n  return graph;\n}\n\n/**\n * Export graph to visualization format (Obsidian/D3 compatible)\n */\nexport function exportToVisualizationFormat(\n  graph: MultiLayerGraph,\n  styles: NodeStyleConfig = DEFAULT_STYLES\n): {\n  nodes: Array<{\n    id: string;\n    label: string;\n    group: string;\n    color: string;\n    size: number;\n    metadata: Record<string, unknown>;\n  }>;\n  edges: Array<{\n    source: string;\n    target: string;\n    type: string;\n    weight: number;\n  }>;\n} {\n  const mergedStyles = { ...DEFAULT_STYLES, ...styles };\n\n  const nodes = graph.nodes\n    .filter(n => {\n      const layer = graph.layers.find(l => l.type === n.layer);\n      return layer?.visible !== false;\n    })\n    .map(n => ({\n      id: n.id,\n      label: n.title,\n      group: n.layer,\n      color: n.complianceStatus\n        ? mergedStyles.statusColors[n.complianceStatus]\n        : mergedStyles.layerColors[n.layer],\n      size: mergedStyles.nodeSizes[n.type] || 20,\n      metadata: n.metadata || {},\n    }));\n\n  const nodeIds = new Set(nodes.map(n => n.id));\n\n  const edges = [...graph.edges, ...graph.crossLayerEdges]\n    .filter(e => nodeIds.has(e.source) && nodeIds.has(e.target))\n    .map(e => ({\n      source: e.source,\n      target: e.target,\n      type: e.type,\n      weight: e.weight,\n    }));\n\n  return { nodes, edges };\n}\n\n/**\n * Create a focused subgraph around a specific SOP\n */\nexport function createSOPFocusedSubgraph(\n  graph: MultiLayerGraph,\n  sopId: string,\n  depth: number = 1\n): MultiLayerGraph {\n  const focusNodeId = `sop-${sopId}`;\n  const includedNodeIds = new Set<string>([focusNodeId]);\n\n  // BFS to find connected nodes within depth\n  const queue: Array<{ id: string; currentDepth: number }> = [\n    { id: focusNodeId, currentDepth: 0 },\n  ];\n\n  const allEdges = [...graph.edges, ...graph.crossLayerEdges];\n\n  while (queue.length > 0) {\n    const { id, currentDepth } = queue.shift()!;\n    if (currentDepth >= depth) continue;\n\n    for (const edge of allEdges) {\n      if (edge.source === id && !includedNodeIds.has(edge.target)) {\n        includedNodeIds.add(edge.target);\n        queue.push({ id: edge.target, currentDepth: currentDepth + 1 });\n      }\n      if (edge.target === id && !includedNodeIds.has(edge.source)) {\n        includedNodeIds.add(edge.source);\n        queue.push({ id: edge.source, currentDepth: currentDepth + 1 });\n      }\n    }\n  }\n\n  const filteredNodes = graph.nodes.filter(n => includedNodeIds.has(n.id));\n  const filteredEdges = graph.edges.filter(\n    e => includedNodeIds.has(e.source) && includedNodeIds.has(e.target)\n  );\n  const filteredCrossLayerEdges = graph.crossLayerEdges.filter(\n    e => includedNodeIds.has(e.source) && includedNodeIds.has(e.target)\n  );\n\n  return {\n    ...graph,\n    id: `${graph.id}-focus-${sopId}`,\n    name: `${graph.name} (Focus: ${sopId})`,\n    nodes: filteredNodes,\n    edges: filteredEdges,\n    crossLayerEdges: filteredCrossLayerEdges,\n  };\n}\n"],"names":[],"mappings":"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"}