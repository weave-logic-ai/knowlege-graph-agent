{"version":3,"file":"config.js","sources":["../../src/workflow/config.ts"],"sourcesContent":["/**\n * Workflow DevKit Configuration\n *\n * Provides configuration management for different execution environments\n * (Worlds) including Postgres, Vercel, and Local persistence options.\n *\n * @module workflow/config\n */\n\n/**\n * PostgreSQL connection pool configuration\n */\nexport interface PostgresPoolConfig {\n  /** Maximum number of connections in the pool */\n  max: number;\n  /** Time in milliseconds before idle connections are closed */\n  idleTimeoutMillis: number;\n}\n\n/**\n * PostgreSQL World configuration\n */\nexport interface PostgresWorldConfig {\n  /** Database connection string */\n  connectionString: string;\n  /** Schema name for workflow tables */\n  schema: string;\n  /** Connection pool configuration */\n  poolConfig?: PostgresPoolConfig;\n}\n\n/**\n * Vercel World configuration\n */\nexport interface VercelWorldConfig {\n  /** Vercel project identifier */\n  projectId?: string;\n}\n\n/**\n * Local World configuration\n */\nexport interface LocalWorldConfig {\n  /** Directory for local workflow data storage */\n  dataDir: string;\n}\n\n/**\n * Workflow configuration supporting multiple execution environments\n *\n * @example\n * ```typescript\n * // Postgres World\n * const config: WorkflowConfig = {\n *   world: 'postgres',\n *   postgres: {\n *     connectionString: 'postgres://localhost:5432/kg_agent',\n *     schema: 'workflow',\n *   },\n * };\n *\n * // Local World (default)\n * const config: WorkflowConfig = {\n *   world: 'local',\n *   local: {\n *     dataDir: '.workflow',\n *   },\n * };\n * ```\n */\nexport interface WorkflowConfig {\n  /** The execution environment (World) type */\n  world: 'postgres' | 'vercel' | 'local';\n  /** PostgreSQL configuration (required when world is 'postgres') */\n  postgres?: PostgresWorldConfig;\n  /** Vercel configuration (required when world is 'vercel') */\n  vercel?: VercelWorldConfig;\n  /** Local configuration (required when world is 'local') */\n  local?: LocalWorldConfig;\n}\n\n/**\n * Creates a workflow configuration based on environment variables\n *\n * Environment variables:\n * - `WORKFLOW_WORLD`: The world type ('postgres' | 'vercel' | 'local')\n * - `DATABASE_URL`: PostgreSQL connection string (for postgres world)\n * - `VERCEL_PROJECT_ID`: Vercel project ID (for vercel world)\n *\n * @returns The workflow configuration for the current environment\n *\n * @example\n * ```typescript\n * // Set WORKFLOW_WORLD=postgres and DATABASE_URL before running\n * const config = createWorkflowConfig();\n * console.log(config.world); // 'postgres'\n * ```\n */\nexport function createWorkflowConfig(): WorkflowConfig {\n  const worldType = (process.env.WORKFLOW_WORLD || 'local') as WorkflowConfig['world'];\n\n  switch (worldType) {\n    case 'postgres':\n      return {\n        world: 'postgres',\n        postgres: {\n          connectionString: process.env.DATABASE_URL || 'postgres://localhost:5432/kg_agent',\n          schema: 'workflow',\n          poolConfig: {\n            max: 20,\n            idleTimeoutMillis: 30000,\n          },\n        },\n      };\n    case 'vercel':\n      return {\n        world: 'vercel',\n        vercel: {\n          projectId: process.env.VERCEL_PROJECT_ID,\n        },\n      };\n    default:\n      return {\n        world: 'local',\n        local: {\n          dataDir: '.workflow',\n        },\n      };\n  }\n}\n\n/**\n * Validates a workflow configuration\n *\n * @param config - The configuration to validate\n * @returns True if valid, throws if invalid\n * @throws Error if configuration is missing required fields\n */\nexport function validateWorkflowConfig(config: WorkflowConfig): boolean {\n  switch (config.world) {\n    case 'postgres':\n      if (!config.postgres?.connectionString) {\n        throw new Error('PostgreSQL configuration requires a connectionString');\n      }\n      if (!config.postgres?.schema) {\n        throw new Error('PostgreSQL configuration requires a schema name');\n      }\n      break;\n    case 'vercel':\n      // Vercel config is optional, projectId can be auto-detected\n      break;\n    case 'local':\n      if (!config.local?.dataDir) {\n        throw new Error('Local configuration requires a dataDir path');\n      }\n      break;\n    default:\n      throw new Error(`Unknown world type: ${config.world}`);\n  }\n  return true;\n}\n\n/**\n * Creates a PostgreSQL World configuration\n *\n * @param connectionString - Database connection string\n * @param options - Optional configuration overrides\n * @returns PostgreSQL workflow configuration\n */\nexport function createPostgresConfig(\n  connectionString: string,\n  options?: Partial<Omit<PostgresWorldConfig, 'connectionString'>>\n): WorkflowConfig {\n  return {\n    world: 'postgres',\n    postgres: {\n      connectionString,\n      schema: options?.schema || 'workflow',\n      poolConfig: options?.poolConfig || {\n        max: 20,\n        idleTimeoutMillis: 30000,\n      },\n    },\n  };\n}\n\n/**\n * Creates a Vercel World configuration\n *\n * @param projectId - Optional Vercel project ID\n * @returns Vercel workflow configuration\n */\nexport function createVercelConfig(projectId?: string): WorkflowConfig {\n  return {\n    world: 'vercel',\n    vercel: {\n      projectId,\n    },\n  };\n}\n\n/**\n * Creates a Local World configuration\n *\n * @param dataDir - Directory for workflow data storage\n * @returns Local workflow configuration\n */\nexport function createLocalConfig(dataDir: string = '.workflow'): WorkflowConfig {\n  return {\n    world: 'local',\n    local: {\n      dataDir,\n    },\n  };\n}\n\n/**\n * Default workflow configuration based on environment\n *\n * @example\n * ```typescript\n * import { defaultConfig } from './config.js';\n *\n * console.log(defaultConfig.world); // Based on WORKFLOW_WORLD env var\n * ```\n */\nexport const defaultConfig: WorkflowConfig = createWorkflowConfig();\n"],"names":[],"mappings":"AAkGO,SAAS,uBAAuC;AACrD,QAAM,YAAa,QAAQ,IAAI,kBAAkB;AAEjD,UAAQ,WAAA;AAAA,IACN,KAAK;AACH,aAAO;AAAA,QACL,OAAO;AAAA,QACP,UAAU;AAAA,UACR,kBAAkB,QAAQ,IAAI,gBAAgB;AAAA,UAC9C,QAAQ;AAAA,UACR,YAAY;AAAA,YACV,KAAK;AAAA,YACL,mBAAmB;AAAA,UAAA;AAAA,QACrB;AAAA,MACF;AAAA,IAEJ,KAAK;AACH,aAAO;AAAA,QACL,OAAO;AAAA,QACP,QAAQ;AAAA,UACN,WAAW,QAAQ,IAAI;AAAA,QAAA;AAAA,MACzB;AAAA,IAEJ;AACE,aAAO;AAAA,QACL,OAAO;AAAA,QACP,OAAO;AAAA,UACL,SAAS;AAAA,QAAA;AAAA,MACX;AAAA,EACF;AAEN;AASO,SAAS,uBAAuB,QAAiC;AACtE,UAAQ,OAAO,OAAA;AAAA,IACb,KAAK;AACH,UAAI,CAAC,OAAO,UAAU,kBAAkB;AACtC,cAAM,IAAI,MAAM,sDAAsD;AAAA,MACxE;AACA,UAAI,CAAC,OAAO,UAAU,QAAQ;AAC5B,cAAM,IAAI,MAAM,iDAAiD;AAAA,MACnE;AACA;AAAA,IACF,KAAK;AAEH;AAAA,IACF,KAAK;AACH,UAAI,CAAC,OAAO,OAAO,SAAS;AAC1B,cAAM,IAAI,MAAM,6CAA6C;AAAA,MAC/D;AACA;AAAA,IACF;AACE,YAAM,IAAI,MAAM,uBAAuB,OAAO,KAAK,EAAE;AAAA,EAAA;AAEzD,SAAO;AACT;AASO,SAAS,qBACd,kBACA,SACgB;AAChB,SAAO;AAAA,IACL,OAAO;AAAA,IACP,UAAU;AAAA,MACR;AAAA,MACA,QAAQ,SAAS,UAAU;AAAA,MAC3B,YAAY,SAAS,cAAc;AAAA,QACjC,KAAK;AAAA,QACL,mBAAmB;AAAA,MAAA;AAAA,IACrB;AAAA,EACF;AAEJ;AAQO,SAAS,mBAAmB,WAAoC;AACrE,SAAO;AAAA,IACL,OAAO;AAAA,IACP,QAAQ;AAAA,MACN;AAAA,IAAA;AAAA,EACF;AAEJ;AAQO,SAAS,kBAAkB,UAAkB,aAA6B;AAC/E,SAAO;AAAA,IACL,OAAO;AAAA,IACP,OAAO;AAAA,MACL;AAAA,IAAA;AAAA,EACF;AAEJ;AAYO,MAAM,gBAAgC,qBAAA;"}