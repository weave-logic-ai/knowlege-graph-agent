{"version":3,"file":"types.js","sources":["../../src/workflows/types.ts"],"sourcesContent":["/**\n * Workflow Types\n *\n * Type definitions for the workflow registry and execution system.\n *\n * @module workflows/types\n */\n\n/**\n * Workflow execution status\n */\nexport enum WorkflowStatus {\n  /** Workflow has not started */\n  Pending = 'pending',\n  /** Workflow is currently running */\n  Running = 'running',\n  /** Workflow completed successfully */\n  Completed = 'completed',\n  /** Workflow failed with error */\n  Failed = 'failed',\n  /** Workflow was cancelled */\n  Cancelled = 'cancelled',\n  /** Workflow is paused */\n  Paused = 'paused',\n  /** Workflow is waiting for dependencies */\n  Waiting = 'waiting',\n  /** Workflow is rolling back due to failure */\n  RollingBack = 'rolling-back',\n  /** Workflow rollback completed */\n  RolledBack = 'rolled-back',\n}\n\n/**\n * Step execution context passed to step handlers\n */\nexport interface StepContext {\n  /** Workflow ID */\n  workflowId: string;\n  /** Current step ID */\n  stepId: string;\n  /** Results from previous steps */\n  previousResults: Map<string, unknown>;\n  /** Shared workflow state */\n  state: Record<string, unknown>;\n  /** Logger function */\n  log: (message: string, data?: Record<string, unknown>) => void;\n  /** Abort signal for cancellation */\n  signal?: AbortSignal;\n}\n\n/**\n * Step handler function type\n */\nexport type StepHandler<TInput = unknown, TOutput = unknown> = (\n  input: TInput,\n  context: StepContext\n) => Promise<TOutput>;\n\n/**\n * Rollback handler function type\n */\nexport type RollbackHandler<TOutput = unknown> = (\n  result: TOutput,\n  context: StepContext\n) => Promise<void>;\n\n/**\n * Workflow step definition\n */\nexport interface WorkflowStep<TInput = unknown, TOutput = unknown> {\n  /** Unique step identifier */\n  id: string;\n  /** Human-readable step name */\n  name: string;\n  /** Step description */\n  description?: string;\n  /** Step execution handler */\n  handler: StepHandler<TInput, TOutput>;\n  /** Rollback handler for failure recovery */\n  rollback?: RollbackHandler<TOutput>;\n  /** IDs of steps this step depends on */\n  dependencies?: string[];\n  /** Timeout in milliseconds */\n  timeout?: number;\n  /** Number of retry attempts */\n  retries?: number;\n  /** Retry delay in milliseconds */\n  retryDelay?: number;\n  /** Whether step can run in parallel with siblings */\n  parallel?: boolean;\n  /** Whether step is optional (failure won't stop workflow) */\n  optional?: boolean;\n  /** Condition function to determine if step should run */\n  condition?: (context: StepContext) => boolean | Promise<boolean>;\n  /** Input transformer */\n  transformInput?: (previousResults: Map<string, unknown>) => TInput;\n  /** Metadata for the step */\n  metadata?: Record<string, unknown>;\n}\n\n/**\n * Workflow definition\n */\nexport interface WorkflowDefinition<TInput = unknown, TOutput = unknown> {\n  /** Unique workflow identifier */\n  id: string;\n  /** Workflow name */\n  name: string;\n  /** Workflow description */\n  description?: string;\n  /** Workflow version */\n  version: string;\n  /** Workflow steps */\n  steps: WorkflowStep[];\n  /** Default input for the workflow */\n  defaultInput?: TInput;\n  /** Initial state for the workflow */\n  initialState?: Record<string, unknown>;\n  /** Global timeout for entire workflow */\n  timeout?: number;\n  /** Whether to enable rollback on failure */\n  enableRollback?: boolean;\n  /** Handler called before workflow starts */\n  onStart?: (input: TInput, context: StepContext) => Promise<void>;\n  /** Handler called after workflow completes */\n  onComplete?: (result: TOutput, context: StepContext) => Promise<void>;\n  /** Handler called on workflow failure */\n  onError?: (error: Error, context: StepContext) => Promise<void>;\n  /** Output transformer */\n  transformOutput?: (results: Map<string, unknown>) => TOutput;\n  /** Workflow metadata */\n  metadata?: Record<string, unknown>;\n  /** Tags for categorization */\n  tags?: string[];\n}\n\n/**\n * Step execution record\n */\nexport interface StepExecution {\n  /** Step ID */\n  stepId: string;\n  /** Step status */\n  status: WorkflowStatus;\n  /** Step result */\n  result?: unknown;\n  /** Error if failed */\n  error?: string;\n  /** Error stack trace */\n  errorStack?: string;\n  /** Start timestamp */\n  startedAt?: Date;\n  /** End timestamp */\n  completedAt?: Date;\n  /** Duration in milliseconds */\n  durationMs?: number;\n  /** Number of attempts */\n  attempts: number;\n  /** Whether step was skipped */\n  skipped?: boolean;\n  /** Skip reason */\n  skipReason?: string;\n}\n\n/**\n * Workflow execution record\n */\nexport interface WorkflowExecution<TInput = unknown, TOutput = unknown> {\n  /** Unique execution ID */\n  id: string;\n  /** Workflow definition ID */\n  workflowId: string;\n  /** Execution status */\n  status: WorkflowStatus;\n  /** Input provided to workflow */\n  input: TInput;\n  /** Final output (if completed) */\n  output?: TOutput;\n  /** Shared workflow state */\n  state: Record<string, unknown>;\n  /** Step execution records */\n  steps: Map<string, StepExecution>;\n  /** Overall error (if failed) */\n  error?: string;\n  /** Error stack trace */\n  errorStack?: string;\n  /** Created timestamp */\n  createdAt: Date;\n  /** Started timestamp */\n  startedAt?: Date;\n  /** Completed timestamp */\n  completedAt?: Date;\n  /** Total duration in milliseconds */\n  durationMs?: number;\n  /** Execution metadata */\n  metadata?: Record<string, unknown>;\n  /** Progress percentage (0-100) */\n  progress: number;\n  /** Current step being executed */\n  currentStep?: string;\n  /** Whether rollback was performed */\n  rolledBack?: boolean;\n}\n\n/**\n * Workflow execution result\n */\nexport interface WorkflowResult<TOutput = unknown> {\n  /** Whether workflow completed successfully */\n  success: boolean;\n  /** Execution ID */\n  executionId: string;\n  /** Workflow ID */\n  workflowId: string;\n  /** Final status */\n  status: WorkflowStatus;\n  /** Output result (if successful) */\n  output?: TOutput;\n  /** Error message (if failed) */\n  error?: string;\n  /** Error stack trace */\n  errorStack?: string;\n  /** Total duration in milliseconds */\n  durationMs: number;\n  /** Step results */\n  stepResults: Map<string, unknown>;\n  /** Step errors */\n  stepErrors: Map<string, string>;\n  /** Whether rollback was performed */\n  rolledBack: boolean;\n  /** Execution statistics */\n  stats: WorkflowExecutionStats;\n}\n\n/**\n * Workflow execution statistics\n */\nexport interface WorkflowExecutionStats {\n  /** Total steps */\n  totalSteps: number;\n  /** Completed steps */\n  completedSteps: number;\n  /** Failed steps */\n  failedSteps: number;\n  /** Skipped steps */\n  skippedSteps: number;\n  /** Total retry attempts across all steps */\n  totalRetries: number;\n  /** Start time */\n  startTime: Date;\n  /** End time */\n  endTime: Date;\n  /** Total duration in milliseconds */\n  totalDurationMs: number;\n  /** Average step duration in milliseconds */\n  avgStepDurationMs: number;\n}\n\n/**\n * Workflow registry options\n */\nexport interface WorkflowRegistryOptions {\n  /** Maximum concurrent workflow executions */\n  maxConcurrentExecutions?: number;\n  /** Default step timeout in milliseconds */\n  defaultStepTimeout?: number;\n  /** Default retry count */\n  defaultRetries?: number;\n  /** Default retry delay in milliseconds */\n  defaultRetryDelay?: number;\n  /** Whether to persist execution history */\n  persistHistory?: boolean;\n  /** Maximum history entries to keep */\n  maxHistoryEntries?: number;\n  /** Logger function */\n  logger?: (level: string, message: string, data?: Record<string, unknown>) => void;\n}\n\n/**\n * Workflow list filter options\n */\nexport interface WorkflowListOptions {\n  /** Filter by tags */\n  tags?: string[];\n  /** Filter by version pattern */\n  version?: string;\n  /** Include only workflows matching name pattern */\n  namePattern?: string;\n  /** Limit results */\n  limit?: number;\n  /** Offset for pagination */\n  offset?: number;\n}\n\n/**\n * Execution history query options\n */\nexport interface ExecutionHistoryOptions {\n  /** Filter by workflow ID */\n  workflowId?: string;\n  /** Filter by status */\n  status?: WorkflowStatus;\n  /** Filter by start date (after) */\n  after?: Date;\n  /** Filter by start date (before) */\n  before?: Date;\n  /** Limit results */\n  limit?: number;\n  /** Offset for pagination */\n  offset?: number;\n  /** Sort order */\n  sortOrder?: 'asc' | 'desc';\n}\n\n/**\n * Workflow event types\n */\nexport type WorkflowEventType =\n  | 'workflow:started'\n  | 'workflow:completed'\n  | 'workflow:failed'\n  | 'workflow:cancelled'\n  | 'workflow:paused'\n  | 'workflow:resumed'\n  | 'step:started'\n  | 'step:completed'\n  | 'step:failed'\n  | 'step:skipped'\n  | 'step:retrying'\n  | 'rollback:started'\n  | 'rollback:completed'\n  | 'rollback:failed';\n\n/**\n * Workflow event\n */\nexport interface WorkflowEvent {\n  /** Event type */\n  type: WorkflowEventType;\n  /** Execution ID */\n  executionId: string;\n  /** Workflow ID */\n  workflowId: string;\n  /** Step ID (if step event) */\n  stepId?: string;\n  /** Event timestamp */\n  timestamp: Date;\n  /** Event data */\n  data?: Record<string, unknown>;\n  /** Error (if applicable) */\n  error?: string;\n}\n\n/**\n * Workflow event listener\n */\nexport type WorkflowEventListener = (event: WorkflowEvent) => void | Promise<void>;\n"],"names":["WorkflowStatus"],"mappings":"AAWO,IAAK,mCAAAA,oBAAL;AAELA,kBAAA,SAAA,IAAU;AAEVA,kBAAA,SAAA,IAAU;AAEVA,kBAAA,WAAA,IAAY;AAEZA,kBAAA,QAAA,IAAS;AAETA,kBAAA,WAAA,IAAY;AAEZA,kBAAA,QAAA,IAAS;AAETA,kBAAA,SAAA,IAAU;AAEVA,kBAAA,aAAA,IAAc;AAEdA,kBAAA,YAAA,IAAa;AAlBH,SAAAA;AAAA,GAAA,kBAAA,CAAA,CAAA;"}