{"version":3,"file":"claude.js","sources":["../../../src/cli/commands/claude.ts"],"sourcesContent":["/**\n * Claude Command\n *\n * Manage CLAUDE.md configuration file.\n */\n\nimport { Command } from 'commander';\nimport chalk from 'chalk';\nimport ora from 'ora';\nimport { existsSync, readFileSync } from 'fs';\nimport { join } from 'path';\nimport {\n  generateClaudeMd,\n  updateClaudeMd,\n  addSection,\n  getSectionTemplate,\n  listSectionTemplates,\n} from '../../generators/claude-md.js';\nimport { validateProjectRoot, validatePath } from '../../core/security.js';\n\n/**\n * Create claude command\n */\nexport function createClaudeCommand(): Command {\n  const command = new Command('claude');\n\n  command\n    .description('CLAUDE.md management commands');\n\n  // Update/generate subcommand\n  command\n    .command('update')\n    .description('Generate or update CLAUDE.md file')\n    .option('-p, --path <path>', 'Project root path', '.')\n    .option('-o, --output <path>', 'Output path for CLAUDE.md')\n    .option('-t, --template <template>', 'Template to use (default, minimal, full)')\n    .option('--no-kg', 'Skip knowledge graph section')\n    .option('--no-cf', 'Skip claude-flow section')\n    .option('-f, --force', 'Overwrite existing file')\n    .action(async (options) => {\n      const spinner = ora('Updating CLAUDE.md...').start();\n\n      try {\n        // Validate paths to prevent traversal attacks\n        const projectRoot = validateProjectRoot(options.path);\n        const claudeMdPath = options.output\n          ? validatePath(projectRoot, options.output)\n          : join(projectRoot, 'CLAUDE.md');\n\n        // Check if file exists\n        if (existsSync(claudeMdPath) && !options.force) {\n          spinner.warn('CLAUDE.md already exists. Use --force to overwrite.');\n          return;\n        }\n\n        const result = await updateClaudeMd({\n          projectRoot,\n          outputPath: claudeMdPath,\n          template: options.template,\n          includeKnowledgeGraph: options.kg !== false,\n          includeClaudeFlow: options.cf !== false,\n        });\n\n        if (result.created) {\n          spinner.succeed('CLAUDE.md created!');\n        } else {\n          spinner.succeed('CLAUDE.md updated!');\n        }\n\n        console.log();\n        console.log(chalk.gray('  Path:'), chalk.white(result.path));\n        console.log(chalk.gray('  Size:'), chalk.white(`${result.content.length} bytes`));\n        console.log();\n\n      } catch (error) {\n        spinner.fail('Failed to update CLAUDE.md');\n        console.error(chalk.red(String(error)));\n        process.exit(1);\n      }\n    });\n\n  // Preview subcommand\n  command\n    .command('preview')\n    .description('Preview CLAUDE.md without writing')\n    .option('-p, --path <path>', 'Project root path', '.')\n    .option('-t, --template <template>', 'Template to use')\n    .action(async (options) => {\n      try {\n        const projectRoot = validateProjectRoot(options.path);\n\n        const content = generateClaudeMd({\n          projectRoot,\n          template: options.template,\n          includeKnowledgeGraph: true,\n          includeClaudeFlow: true,\n        });\n\n        console.log(chalk.cyan('\\n--- CLAUDE.md Preview ---\\n'));\n        console.log(content);\n        console.log(chalk.cyan('\\n--- End Preview ---\\n'));\n\n      } catch (error) {\n        console.error(chalk.red('Failed to generate preview:'), String(error));\n        process.exit(1);\n      }\n    });\n\n  // Add section subcommand\n  command\n    .command('add-section <name>')\n    .description('Add a section to existing CLAUDE.md')\n    .option('-p, --path <path>', 'Project root path', '.')\n    .action(async (name, options) => {\n      try {\n        const projectRoot = validateProjectRoot(options.path);\n\n        // Check for built-in section template\n        const template = getSectionTemplate(name);\n\n        if (!template) {\n          console.log(chalk.yellow(`Unknown section template: ${name}`));\n          console.log();\n          console.log(chalk.white('Available templates:'));\n          listSectionTemplates().forEach(t => {\n            console.log(chalk.gray(`  - ${t}`));\n          });\n          return;\n        }\n\n        const added = addSection(projectRoot, template);\n\n        if (added) {\n          console.log(chalk.green(`âœ“ Added section: ${template.title}`));\n        } else {\n          console.log(chalk.yellow(`Section \"${template.title}\" already exists or CLAUDE.md not found`));\n        }\n\n      } catch (error) {\n        console.error(chalk.red('Failed to add section:'), String(error));\n        process.exit(1);\n      }\n    });\n\n  // List templates subcommand\n  command\n    .command('templates')\n    .description('List available section templates')\n    .action(() => {\n      console.log(chalk.white('\\n  Available Section Templates\\n'));\n\n      const templates = listSectionTemplates();\n      templates.forEach(name => {\n        const template = getSectionTemplate(name);\n        if (template) {\n          console.log(chalk.cyan(`  ${name}`));\n          console.log(chalk.gray(`    ${template.title}`));\n        }\n      });\n\n      console.log();\n      console.log(chalk.gray('  Add with: ') + chalk.white('kg claude add-section <name>'));\n      console.log();\n    });\n\n  return command;\n}\n"],"names":[],"mappings":"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"}