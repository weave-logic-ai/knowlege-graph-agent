{"version":3,"file":"commit.js","sources":["../../../src/cli/commands/commit.ts"],"sourcesContent":["/**\n * Commit Command\n *\n * CLI command for creating commits with optional AI-powered message generation.\n */\n\nimport { Command } from 'commander';\nimport chalk from 'chalk';\nimport ora from 'ora';\nimport inquirer from 'inquirer';\nimport { createGitClient, GitClient, GitStatusSummary } from '../../integrations/git.js';\nimport { createAutoCommit, AutoCommit, ChangeAnalysis, ChangeType } from '../../integrations/auto-commit.js';\nimport { validateProjectRoot } from '../../core/security.js';\n\n/**\n * Commit command options\n */\ninterface CommitOptions {\n  message?: string;\n  dryRun: boolean;\n  auto: boolean;\n  push: boolean;\n  path: string;\n  interactive: boolean;\n  all: boolean;\n  amend: boolean;\n}\n\n/**\n * Format status for display\n */\nfunction formatStatus(status: GitStatusSummary): void {\n  console.log();\n  console.log(chalk.cyan.bold('  Git Status'));\n  console.log();\n  console.log(chalk.white(`  Branch: ${chalk.green(status.branch)}`));\n\n  if (status.tracking) {\n    const ahead = status.tracking.ahead > 0 ? chalk.green(`+${status.tracking.ahead}`) : '';\n    const behind = status.tracking.behind > 0 ? chalk.red(`-${status.tracking.behind}`) : '';\n    const tracking = [ahead, behind].filter(Boolean).join(' ');\n    console.log(chalk.gray(`  Tracking: ${status.tracking.remote} ${tracking}`));\n  }\n\n  console.log();\n\n  if (status.isClean) {\n    console.log(chalk.green('  Working tree is clean'));\n    return;\n  }\n\n  // Show file counts\n  const counts: string[] = [];\n  if (status.staged > 0) counts.push(chalk.green(`${status.staged} staged`));\n  if (status.modified > 0) counts.push(chalk.yellow(`${status.modified} modified`));\n  if (status.untracked > 0) counts.push(chalk.gray(`${status.untracked} untracked`));\n  if (status.deleted > 0) counts.push(chalk.red(`${status.deleted} deleted`));\n  if (status.conflicted > 0) counts.push(chalk.red(`${status.conflicted} conflicted`));\n\n  console.log(chalk.white(`  Changes: ${counts.join(', ')}`));\n  console.log();\n\n  // Group files by status\n  const staged = status.files.filter(f => f.isStaged);\n  const unstaged = status.files.filter(f => !f.isStaged);\n\n  if (staged.length > 0) {\n    console.log(chalk.green('  Staged Changes:'));\n    staged.slice(0, 10).forEach(f => {\n      const icon = getStatusIcon(f.indexStatus);\n      console.log(chalk.green(`    ${icon} ${f.path}`));\n    });\n    if (staged.length > 10) {\n      console.log(chalk.gray(`    ... and ${staged.length - 10} more`));\n    }\n    console.log();\n  }\n\n  if (unstaged.length > 0) {\n    console.log(chalk.yellow('  Unstaged Changes:'));\n    unstaged.slice(0, 10).forEach(f => {\n      const icon = getStatusIcon(f.workingTreeStatus);\n      console.log(chalk.yellow(`    ${icon} ${f.path}`));\n    });\n    if (unstaged.length > 10) {\n      console.log(chalk.gray(`    ... and ${unstaged.length - 10} more`));\n    }\n    console.log();\n  }\n}\n\n/**\n * Get icon for file status\n */\nfunction getStatusIcon(status: string): string {\n  switch (status) {\n    case 'M':\n      return 'modified:';\n    case 'A':\n      return 'added:   ';\n    case 'D':\n      return 'deleted: ';\n    case 'R':\n      return 'renamed: ';\n    case '?':\n      return 'new:     ';\n    case 'U':\n      return 'conflict:';\n    default:\n      return '         ';\n  }\n}\n\n/**\n * Format analysis for display\n */\nfunction formatAnalysis(analysis: ChangeAnalysis): void {\n  console.log();\n  console.log(chalk.cyan.bold('  Change Analysis'));\n  console.log();\n  console.log(chalk.white(`  Type: ${chalk.yellow(analysis.type)}`));\n  if (analysis.scope) {\n    console.log(chalk.white(`  Scope: ${chalk.blue(analysis.scope)}`));\n  }\n  console.log(chalk.white(`  Description: ${analysis.description}`));\n  if (analysis.breaking) {\n    console.log(chalk.red(`  Breaking Change: Yes`));\n  }\n  console.log();\n}\n\n/**\n * Interactive mode for reviewing and editing commit\n */\nasync function interactiveCommit(\n  git: GitClient,\n  autoCommit: AutoCommit,\n  status: GitStatusSummary,\n  analysis: ChangeAnalysis,\n  options: CommitOptions\n): Promise<boolean> {\n  // Show current state\n  formatStatus(status);\n  formatAnalysis(analysis);\n\n  // Generate suggested message\n  const suggestedMessage = autoCommit.generateCommitMessage(analysis);\n\n  console.log(chalk.cyan.bold('  Suggested Commit Message:'));\n  console.log();\n  console.log(chalk.gray('  ---'));\n  suggestedMessage.split('\\n').forEach(line => {\n    console.log(chalk.white(`  ${line}`));\n  });\n  console.log(chalk.gray('  ---'));\n  console.log();\n\n  // Ask for confirmation\n  const { action } = await inquirer.prompt([\n    {\n      type: 'list',\n      name: 'action',\n      message: 'What would you like to do?',\n      choices: [\n        { name: 'Commit with suggested message', value: 'commit' },\n        { name: 'Edit message', value: 'edit' },\n        { name: 'Stage all changes first', value: 'stage-all' },\n        { name: 'Select files to stage', value: 'select' },\n        { name: 'View diff', value: 'diff' },\n        { name: 'Cancel', value: 'cancel' },\n      ],\n    },\n  ]);\n\n  switch (action) {\n    case 'commit':\n      return performCommit(git, autoCommit, suggestedMessage, options);\n\n    case 'edit':\n      const { editedMessage } = await inquirer.prompt([\n        {\n          type: 'editor',\n          name: 'editedMessage',\n          message: 'Edit commit message:',\n          default: suggestedMessage,\n        },\n      ]);\n      return performCommit(git, autoCommit, editedMessage.trim(), options);\n\n    case 'stage-all':\n      await git.add('.');\n      const newStatus = await git.getStatus();\n      const newAnalysis = await autoCommit.analyzeChanges(newStatus);\n      return interactiveCommit(git, autoCommit, newStatus, newAnalysis, options);\n\n    case 'select':\n      const unstaged = status.files.filter(f => !f.isStaged);\n      if (unstaged.length === 0) {\n        console.log(chalk.yellow('\\n  No unstaged files to select.\\n'));\n        return interactiveCommit(git, autoCommit, status, analysis, options);\n      }\n\n      const { filesToStage } = await inquirer.prompt([\n        {\n          type: 'checkbox',\n          name: 'filesToStage',\n          message: 'Select files to stage:',\n          choices: unstaged.map(f => ({\n            name: `${getStatusIcon(f.workingTreeStatus).trim()} ${f.path}`,\n            value: f.path,\n          })),\n        },\n      ]);\n\n      if (filesToStage.length > 0) {\n        await git.add(filesToStage);\n      }\n      const updatedStatus = await git.getStatus();\n      const updatedAnalysis = await autoCommit.analyzeChanges(updatedStatus);\n      return interactiveCommit(git, autoCommit, updatedStatus, updatedAnalysis, options);\n\n    case 'diff':\n      const diff = await git.getDiffContent({ staged: true });\n      console.log();\n      console.log(chalk.cyan.bold('  Staged Diff:'));\n      console.log(chalk.gray('  ---'));\n      if (diff) {\n        diff.split('\\n').slice(0, 50).forEach(line => {\n          if (line.startsWith('+') && !line.startsWith('+++')) {\n            console.log(chalk.green(`  ${line}`));\n          } else if (line.startsWith('-') && !line.startsWith('---')) {\n            console.log(chalk.red(`  ${line}`));\n          } else {\n            console.log(chalk.gray(`  ${line}`));\n          }\n        });\n        if (diff.split('\\n').length > 50) {\n          console.log(chalk.gray('  ... (truncated)'));\n        }\n      } else {\n        console.log(chalk.gray('  No staged changes'));\n      }\n      console.log(chalk.gray('  ---'));\n      console.log();\n      return interactiveCommit(git, autoCommit, status, analysis, options);\n\n    case 'cancel':\n    default:\n      console.log(chalk.yellow('\\n  Commit cancelled.\\n'));\n      return false;\n  }\n}\n\n/**\n * Perform the actual commit\n */\nasync function performCommit(\n  git: GitClient,\n  autoCommit: AutoCommit,\n  message: string,\n  options: CommitOptions\n): Promise<boolean> {\n  const spinner = ora('Creating commit...').start();\n\n  try {\n    const result = await autoCommit.commit({\n      message,\n      stageAll: options.all,\n      dryRun: options.dryRun,\n    });\n\n    if (options.dryRun) {\n      spinner.info('Dry run - no commit created');\n      console.log();\n      console.log(chalk.cyan('  Would commit with message:'));\n      console.log(chalk.gray('  ---'));\n      message.split('\\n').forEach(line => {\n        console.log(chalk.white(`  ${line}`));\n      });\n      console.log(chalk.gray('  ---'));\n      console.log();\n      return true;\n    }\n\n    if (!result.success) {\n      spinner.fail('Commit failed');\n      console.error(chalk.red(`  Error: ${result.error}`));\n      return false;\n    }\n\n    spinner.succeed('Commit created');\n    console.log();\n    console.log(chalk.white(`  Hash: ${chalk.green(result.hash || 'unknown')}`));\n    console.log();\n\n    // Push if requested\n    if (options.push) {\n      const pushSpinner = ora('Pushing to remote...').start();\n      try {\n        await git.push();\n        pushSpinner.succeed('Pushed to remote');\n      } catch (error) {\n        pushSpinner.fail('Push failed');\n        console.error(chalk.red(`  Error: ${error instanceof Error ? error.message : String(error)}`));\n        return false;\n      }\n    }\n\n    return true;\n  } catch (error) {\n    spinner.fail('Commit failed');\n    console.error(chalk.red(`  Error: ${error instanceof Error ? error.message : String(error)}`));\n    return false;\n  }\n}\n\n/**\n * Create commit command\n */\nexport function createCommitCommand(): Command {\n  const command = new Command('commit');\n\n  command\n    .description('Create a git commit with optional auto-generated message')\n    .option('-m, --message <message>', 'Commit message (skips auto-generation)')\n    .option('-n, --dry-run', 'Show what would be committed without committing', false)\n    .option('-a, --auto', 'Automatically generate commit message', false)\n    .option('-p, --push', 'Push to remote after committing', false)\n    .option('--path <path>', 'Repository path', '.')\n    .option('-i, --interactive', 'Interactive mode for reviewing changes', false)\n    .option('-A, --all', 'Stage all changes before committing', false)\n    .option('--amend', 'Amend the previous commit', false)\n    .action(async (options: CommitOptions) => {\n      try {\n        // Validate path\n        const projectRoot = validateProjectRoot(options.path);\n\n        // Create clients\n        const git = createGitClient({ workingDirectory: projectRoot });\n        const autoCommit = createAutoCommit({\n          workingDirectory: projectRoot,\n          stageAll: options.all,\n        });\n\n        // Check if this is a git repository\n        if (!(await git.isRepo())) {\n          console.error(chalk.red('\\n  Error: Not a git repository\\n'));\n          process.exit(1);\n        }\n\n        // Get current status\n        const status = await git.getStatus();\n\n        // Handle clean working directory\n        if (status.isClean && !options.amend) {\n          console.log(chalk.yellow('\\n  Nothing to commit, working tree clean\\n'));\n          process.exit(0);\n        }\n\n        // Analyze changes\n        const analysis = await autoCommit.analyzeChanges(status);\n\n        // Interactive mode\n        if (options.interactive) {\n          const success = await interactiveCommit(git, autoCommit, status, analysis, options);\n          process.exit(success ? 0 : 1);\n        }\n\n        // If message provided, use it directly\n        if (options.message) {\n          const success = await performCommit(git, autoCommit, options.message, options);\n          process.exit(success ? 0 : 1);\n        }\n\n        // Auto mode - generate and commit\n        if (options.auto) {\n          const message = autoCommit.generateCommitMessage(analysis);\n          const success = await performCommit(git, autoCommit, message, options);\n          process.exit(success ? 0 : 1);\n        }\n\n        // Default: show status and suggested message\n        formatStatus(status);\n        formatAnalysis(analysis);\n\n        const suggestedMessage = autoCommit.generateCommitMessage(analysis);\n\n        console.log(chalk.cyan.bold('  Suggested Commit Message:'));\n        console.log();\n        console.log(chalk.gray('  ---'));\n        suggestedMessage.split('\\n').forEach(line => {\n          console.log(chalk.white(`  ${line}`));\n        });\n        console.log(chalk.gray('  ---'));\n        console.log();\n\n        console.log(chalk.gray('  Use -a/--auto to commit with this message'));\n        console.log(chalk.gray('  Use -i/--interactive for interactive mode'));\n        console.log(chalk.gray('  Use -m/--message to provide your own message'));\n        console.log();\n\n      } catch (error) {\n        console.error(chalk.red(`\\n  Error: ${error instanceof Error ? error.message : String(error)}\\n`));\n        process.exit(1);\n      }\n    });\n\n  // Status subcommand\n  command\n    .command('status')\n    .description('Show git status with analysis')\n    .option('--path <path>', 'Repository path', '.')\n    .action(async (opts) => {\n      try {\n        const projectRoot = validateProjectRoot(opts.path);\n        const git = createGitClient({ workingDirectory: projectRoot });\n        const autoCommit = createAutoCommit({ workingDirectory: projectRoot });\n\n        if (!(await git.isRepo())) {\n          console.error(chalk.red('\\n  Error: Not a git repository\\n'));\n          process.exit(1);\n        }\n\n        const status = await git.getStatus();\n        formatStatus(status);\n\n        if (!status.isClean) {\n          const analysis = await autoCommit.analyzeChanges(status);\n          formatAnalysis(analysis);\n        }\n      } catch (error) {\n        console.error(chalk.red(`\\n  Error: ${error instanceof Error ? error.message : String(error)}\\n`));\n        process.exit(1);\n      }\n    });\n\n  // Log subcommand\n  command\n    .command('log')\n    .description('Show recent commits')\n    .option('--path <path>', 'Repository path', '.')\n    .option('-n, --count <count>', 'Number of commits to show', '10')\n    .action(async (opts) => {\n      try {\n        const projectRoot = validateProjectRoot(opts.path);\n        const git = createGitClient({ workingDirectory: projectRoot });\n\n        if (!(await git.isRepo())) {\n          console.error(chalk.red('\\n  Error: Not a git repository\\n'));\n          process.exit(1);\n        }\n\n        const log = await git.getLog({ maxCount: parseInt(opts.count, 10) });\n\n        console.log();\n        console.log(chalk.cyan.bold('  Recent Commits'));\n        console.log();\n\n        log.forEach(commit => {\n          const date = commit.date.toISOString().split('T')[0];\n          console.log(chalk.yellow(`  ${commit.hashAbbrev}`) + chalk.gray(` (${date})`) + chalk.white(` ${commit.message}`));\n          console.log(chalk.gray(`           ${commit.author} <${commit.email}>`));\n        });\n\n        console.log();\n      } catch (error) {\n        console.error(chalk.red(`\\n  Error: ${error instanceof Error ? error.message : String(error)}\\n`));\n        process.exit(1);\n      }\n    });\n\n  // Diff subcommand\n  command\n    .command('diff')\n    .description('Show diff of changes')\n    .option('--path <path>', 'Repository path', '.')\n    .option('-s, --staged', 'Show only staged changes', false)\n    .option('-f, --file <file>', 'Show diff for specific file')\n    .action(async (opts) => {\n      try {\n        const projectRoot = validateProjectRoot(opts.path);\n        const git = createGitClient({ workingDirectory: projectRoot });\n\n        if (!(await git.isRepo())) {\n          console.error(chalk.red('\\n  Error: Not a git repository\\n'));\n          process.exit(1);\n        }\n\n        const diff = await git.getDiffContent({\n          staged: opts.staged,\n          file: opts.file,\n        });\n\n        if (!diff) {\n          console.log(chalk.yellow('\\n  No changes to show\\n'));\n          process.exit(0);\n        }\n\n        console.log();\n        diff.split('\\n').forEach(line => {\n          if (line.startsWith('+') && !line.startsWith('+++')) {\n            console.log(chalk.green(line));\n          } else if (line.startsWith('-') && !line.startsWith('---')) {\n            console.log(chalk.red(line));\n          } else if (line.startsWith('@@')) {\n            console.log(chalk.cyan(line));\n          } else if (line.startsWith('diff ') || line.startsWith('index ')) {\n            console.log(chalk.blue(line));\n          } else {\n            console.log(line);\n          }\n        });\n        console.log();\n      } catch (error) {\n        console.error(chalk.red(`\\n  Error: ${error instanceof Error ? error.message : String(error)}\\n`));\n        process.exit(1);\n      }\n    });\n\n  return command;\n}\n"],"names":[],"mappings":"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"}