{"version":3,"file":"dashboard.js","sources":["../../../src/cli/commands/dashboard.ts"],"sourcesContent":["/**\n * Dashboard Command\n *\n * CLI commands for managing the Knowledge Graph Dashboard.\n * Supports development server, production build, serving, and browser opening.\n *\n * @module cli/commands/dashboard\n */\n\nimport { Command } from 'commander';\nimport chalk from 'chalk';\nimport ora from 'ora';\nimport { spawn, exec } from 'child_process';\nimport { join, dirname } from 'path';\nimport { existsSync, mkdirSync, writeFileSync } from 'fs';\nimport { fileURLToPath } from 'url';\nimport {\n  DEFAULT_DASHBOARD_PORT,\n  DEFAULT_GRAPHQL_PORT,\n} from '../../server/types.js';\nimport {\n  createDashboardServer,\n} from '../../dashboard-server/server.js';\nimport type {\n  DashboardConfig,\n  DashboardMode,\n} from '../../dashboard-server/server.js';\n\n/**\n * Execute a command asynchronously\n */\nfunction execAsync(command: string): Promise<{ stdout: string; stderr: string }> {\n  return new Promise((resolve, reject) => {\n    exec(command, (error, stdout, stderr) => {\n      if (error) {\n        reject(error);\n      } else {\n        resolve({ stdout: stdout.toString(), stderr: stderr.toString() });\n      }\n    });\n  });\n}\n\n// ============================================================================\n// Constants\n// ============================================================================\n\nconst DASHBOARD_DIR_NAME = 'dashboard';\n\n/**\n * Get the dashboard directory path\n * The dashboard is expected to be at the package root level or in a subdirectory\n */\nfunction getDashboardPath(projectRoot: string): string {\n  // Check if dashboard exists at package root level\n  const packageDashboard = join(projectRoot, DASHBOARD_DIR_NAME);\n  if (existsSync(packageDashboard)) {\n    return packageDashboard;\n  }\n\n  // Check if we're in the src directory and dashboard is at parent level\n  const parentDashboard = join(projectRoot, '..', DASHBOARD_DIR_NAME);\n  if (existsSync(parentDashboard)) {\n    return parentDashboard;\n  }\n\n  // Default to project root level\n  return packageDashboard;\n}\n\n/**\n * Detect the GraphQL endpoint\n */\nfunction detectGraphQLEndpoint(port?: number): string {\n  const graphqlPort = port ?? DEFAULT_GRAPHQL_PORT;\n  return `http://localhost:${graphqlPort}/graphql`;\n}\n\n/**\n * Check if a port is available\n */\nasync function isPortAvailable(port: number): Promise<boolean> {\n  try {\n    const { stdout } = await execAsync(`lsof -i :${port} -t`);\n    return stdout.trim() === '';\n  } catch {\n    // If lsof fails, port is likely available\n    return true;\n  }\n}\n\n/**\n * Open a URL in the default browser\n */\nasync function openBrowser(url: string): Promise<void> {\n  const platform = process.platform;\n  let command: string;\n\n  if (platform === 'darwin') {\n    command = `open \"${url}\"`;\n  } else if (platform === 'win32') {\n    command = `start \"${url}\"`;\n  } else {\n    // Linux and others\n    command = `xdg-open \"${url}\" || sensible-browser \"${url}\" || x-www-browser \"${url}\"`;\n  }\n\n  await execAsync(command);\n}\n\n// ============================================================================\n// Dashboard Start Command\n// ============================================================================\n\ninterface DashboardStartOptions {\n  port?: string | number;\n  graphqlPort?: string | number;\n  open?: boolean;\n  verbose?: boolean;\n}\n\nasync function handleDashboardStart(options: DashboardStartOptions): Promise<void> {\n  const projectRoot = process.cwd();\n  const spinner = ora('Starting dashboard development server...').start();\n\n  try {\n    // Parse ports\n    const dashboardPort =\n      typeof options.port === 'string'\n        ? parseInt(options.port, 10)\n        : options.port ?? DEFAULT_DASHBOARD_PORT;\n\n    const graphqlPort =\n      typeof options.graphqlPort === 'string'\n        ? parseInt(options.graphqlPort, 10)\n        : options.graphqlPort ?? DEFAULT_GRAPHQL_PORT;\n\n    // Validate port\n    if (isNaN(dashboardPort) || dashboardPort < 1 || dashboardPort > 65535) {\n      throw new Error(`Invalid port: ${options.port}`);\n    }\n\n    // Check if port is available\n    spinner.text = 'Checking port availability...';\n    const portAvailable = await isPortAvailable(dashboardPort);\n    if (!portAvailable) {\n      throw new Error(`Port ${dashboardPort} is already in use. Try a different port with --port`);\n    }\n\n    // Create dashboard server configuration\n    const config: DashboardConfig = {\n      projectRoot,\n      port: dashboardPort,\n      graphqlEndpoint: detectGraphQLEndpoint(graphqlPort),\n      mode: 'development',\n      verbose: options.verbose ?? false,\n    };\n\n    // Create and start dashboard server\n    spinner.text = 'Initializing dashboard server...';\n    const server = createDashboardServer(config);\n\n    // Start the development server\n    spinner.text = 'Starting Next.js development server...';\n    await server.start();\n\n    spinner.succeed('Dashboard development server started!');\n\n    // Display server information\n    console.log(chalk.cyan.bold('\\n  Dashboard Dev Server\\n'));\n    console.log(`  ${chalk.white('URL:')}         ${chalk.green(`http://localhost:${dashboardPort}`)}`);\n    console.log(`  ${chalk.white('GraphQL:')}     ${chalk.gray(config.graphqlEndpoint)}`);\n    console.log(`  ${chalk.white('Mode:')}        ${chalk.yellow('development')}`);\n    console.log();\n    console.log(chalk.gray('  Hot reload is enabled. Changes will be reflected automatically.'));\n    console.log(chalk.gray('  Press Ctrl+C to stop the server.'));\n    console.log();\n\n    // Open browser if requested\n    if (options.open) {\n      await openBrowser(`http://localhost:${dashboardPort}`);\n    }\n\n    // Keep the process alive\n    await server.waitForShutdown();\n  } catch (error) {\n    spinner.fail('Failed to start dashboard');\n    console.error(chalk.red(`\\n  Error: ${String(error)}`));\n    process.exit(1);\n  }\n}\n\n// ============================================================================\n// Dashboard Build Command\n// ============================================================================\n\ninterface DashboardBuildOptions {\n  output?: string;\n  verbose?: boolean;\n}\n\nasync function handleDashboardBuild(options: DashboardBuildOptions): Promise<void> {\n  const projectRoot = process.cwd();\n  const spinner = ora('Building dashboard for production...').start();\n\n  try {\n    const config: DashboardConfig = {\n      projectRoot,\n      port: DEFAULT_DASHBOARD_PORT,\n      graphqlEndpoint: detectGraphQLEndpoint(),\n      mode: 'production',\n      outputDir: options.output,\n      verbose: options.verbose ?? false,\n    };\n\n    const server = createDashboardServer(config);\n\n    // Run the build process\n    spinner.text = 'Running Next.js build...';\n    await server.build();\n\n    spinner.succeed('Dashboard built successfully!');\n\n    const outputPath = options.output ?? join(getDashboardPath(projectRoot), '.next');\n    console.log(chalk.cyan.bold('\\n  Build Complete\\n'));\n    console.log(`  ${chalk.white('Output:')}  ${chalk.gray(outputPath)}`);\n    console.log();\n    console.log(chalk.gray('  To serve the production build:'));\n    console.log(chalk.white('    kg dashboard serve'));\n    console.log();\n  } catch (error) {\n    spinner.fail('Failed to build dashboard');\n    console.error(chalk.red(`\\n  Error: ${String(error)}`));\n    process.exit(1);\n  }\n}\n\n// ============================================================================\n// Dashboard Serve Command\n// ============================================================================\n\ninterface DashboardServeOptions {\n  port?: string | number;\n  graphqlPort?: string | number;\n  open?: boolean;\n  verbose?: boolean;\n}\n\nasync function handleDashboardServe(options: DashboardServeOptions): Promise<void> {\n  const projectRoot = process.cwd();\n  const spinner = ora('Starting production dashboard server...').start();\n\n  try {\n    const dashboardPort =\n      typeof options.port === 'string'\n        ? parseInt(options.port, 10)\n        : options.port ?? DEFAULT_DASHBOARD_PORT;\n\n    const graphqlPort =\n      typeof options.graphqlPort === 'string'\n        ? parseInt(options.graphqlPort, 10)\n        : options.graphqlPort ?? DEFAULT_GRAPHQL_PORT;\n\n    // Validate port\n    if (isNaN(dashboardPort) || dashboardPort < 1 || dashboardPort > 65535) {\n      throw new Error(`Invalid port: ${options.port}`);\n    }\n\n    // Check if port is available\n    spinner.text = 'Checking port availability...';\n    const portAvailable = await isPortAvailable(dashboardPort);\n    if (!portAvailable) {\n      throw new Error(`Port ${dashboardPort} is already in use. Try a different port with --port`);\n    }\n\n    const config: DashboardConfig = {\n      projectRoot,\n      port: dashboardPort,\n      graphqlEndpoint: detectGraphQLEndpoint(graphqlPort),\n      mode: 'production',\n      verbose: options.verbose ?? false,\n    };\n\n    // Create and start dashboard server\n    spinner.text = 'Initializing production server...';\n    const server = createDashboardServer(config);\n\n    spinner.text = 'Starting production server...';\n    await server.start();\n\n    spinner.succeed('Dashboard production server started!');\n\n    // Display server information\n    console.log(chalk.cyan.bold('\\n  Dashboard Production Server\\n'));\n    console.log(`  ${chalk.white('URL:')}         ${chalk.green(`http://localhost:${dashboardPort}`)}`);\n    console.log(`  ${chalk.white('GraphQL:')}     ${chalk.gray(config.graphqlEndpoint)}`);\n    console.log(`  ${chalk.white('Mode:')}        ${chalk.blue('production')}`);\n    console.log();\n    console.log(chalk.gray('  Press Ctrl+C to stop the server.'));\n    console.log();\n\n    // Open browser if requested\n    if (options.open) {\n      await openBrowser(`http://localhost:${dashboardPort}`);\n    }\n\n    // Keep the process alive\n    await server.waitForShutdown();\n  } catch (error) {\n    spinner.fail('Failed to start production server');\n    console.error(chalk.red(`\\n  Error: ${String(error)}`));\n    process.exit(1);\n  }\n}\n\n// ============================================================================\n// Dashboard Open Command\n// ============================================================================\n\ninterface DashboardOpenOptions {\n  port?: string | number;\n}\n\nasync function handleDashboardOpen(options: DashboardOpenOptions): Promise<void> {\n  const spinner = ora('Opening dashboard in browser...').start();\n\n  try {\n    const dashboardPort =\n      typeof options.port === 'string'\n        ? parseInt(options.port, 10)\n        : options.port ?? DEFAULT_DASHBOARD_PORT;\n\n    const url = `http://localhost:${dashboardPort}`;\n\n    await openBrowser(url);\n\n    spinner.succeed(`Opened ${url} in browser`);\n  } catch (error) {\n    spinner.fail('Failed to open browser');\n    console.error(chalk.red(`\\n  Error: ${String(error)}`));\n    console.log(chalk.gray('\\n  Try opening manually: ') + chalk.white(`http://localhost:${options.port ?? DEFAULT_DASHBOARD_PORT}`));\n    process.exit(1);\n  }\n}\n\n// ============================================================================\n// Dashboard Status Command\n// ============================================================================\n\ninterface DashboardStatusOptions {\n  port?: string | number;\n  graphqlPort?: string | number;\n}\n\nasync function handleDashboardStatus(options: DashboardStatusOptions): Promise<void> {\n  const spinner = ora('Checking dashboard status...').start();\n\n  try {\n    const dashboardPort =\n      typeof options.port === 'string'\n        ? parseInt(options.port, 10)\n        : options.port ?? DEFAULT_DASHBOARD_PORT;\n\n    const graphqlPort =\n      typeof options.graphqlPort === 'string'\n        ? parseInt(options.graphqlPort, 10)\n        : options.graphqlPort ?? DEFAULT_GRAPHQL_PORT;\n\n    // Check dashboard availability\n    const dashboardAvailable = !(await isPortAvailable(dashboardPort));\n    const graphqlAvailable = !(await isPortAvailable(graphqlPort));\n\n    spinner.stop();\n\n    console.log(chalk.cyan.bold('\\n  Dashboard Status\\n'));\n\n    // Dashboard status\n    const dashboardStatus = dashboardAvailable ? chalk.green('running') : chalk.gray('stopped');\n    console.log(`  ${chalk.white('Dashboard:')}     ${dashboardStatus}`);\n    if (dashboardAvailable) {\n      console.log(`                  ${chalk.gray(`http://localhost:${dashboardPort}`)}`);\n    }\n\n    // GraphQL status\n    const graphqlStatus = graphqlAvailable ? chalk.green('running') : chalk.gray('stopped');\n    console.log(`  ${chalk.white('GraphQL:')}       ${graphqlStatus}`);\n    if (graphqlAvailable) {\n      console.log(`                  ${chalk.gray(`http://localhost:${graphqlPort}/graphql`)}`);\n    }\n\n    // Connection status\n    console.log();\n    if (dashboardAvailable && graphqlAvailable) {\n      console.log(chalk.green('  Dashboard is connected to GraphQL server.'));\n    } else if (dashboardAvailable && !graphqlAvailable) {\n      console.log(chalk.yellow('  Dashboard is running but GraphQL server is not available.'));\n      console.log(chalk.gray('  Start GraphQL server: kg serve --graphql'));\n    } else if (!dashboardAvailable && graphqlAvailable) {\n      console.log(chalk.gray('  GraphQL server is running. Start dashboard: kg dashboard start'));\n    } else {\n      console.log(chalk.gray('  No servers are running.'));\n      console.log(chalk.gray('  Start all: kg serve --all'));\n      console.log(chalk.gray('  Start dashboard only: kg dashboard start'));\n    }\n\n    console.log();\n  } catch (error) {\n    spinner.fail('Failed to check status');\n    console.error(chalk.red(`\\n  Error: ${String(error)}`));\n    process.exit(1);\n  }\n}\n\n// ============================================================================\n// Create Dashboard Command\n// ============================================================================\n\n/**\n * Create the dashboard command with subcommands\n */\nexport function createDashboardCommand(): Command {\n  const dashboard = new Command('dashboard')\n    .description('Manage the Knowledge Graph Dashboard')\n    .addHelpText(\n      'after',\n      `\nExamples:\n  $ kg dashboard start               # Start dashboard dev server (port 3000)\n  $ kg dashboard start --port 8080   # Start on custom port\n  $ kg dashboard start --open        # Start and open in browser\n\n  $ kg dashboard build               # Build for production\n  $ kg dashboard serve               # Serve production build\n\n  $ kg dashboard open                # Open dashboard in browser\n  $ kg dashboard status              # Check dashboard status\n\nConfiguration:\n  The dashboard auto-detects the GraphQL endpoint from running servers.\n  Use --graphql-port to specify a custom GraphQL server port.\n`\n    );\n\n  // ============================================================================\n  // start subcommand\n  // ============================================================================\n\n  dashboard\n    .command('start')\n    .description('Start the dashboard development server')\n    .option('-p, --port <port>', `Dashboard port (default: ${DEFAULT_DASHBOARD_PORT})`)\n    .option('--graphql-port <port>', `GraphQL server port (default: ${DEFAULT_GRAPHQL_PORT})`)\n    .option('-o, --open', 'Open dashboard in browser')\n    .option('-v, --verbose', 'Enable verbose logging')\n    .action(handleDashboardStart);\n\n  // ============================================================================\n  // build subcommand\n  // ============================================================================\n\n  dashboard\n    .command('build')\n    .description('Build the dashboard for production')\n    .option('-o, --output <path>', 'Output directory for build')\n    .option('-v, --verbose', 'Enable verbose logging')\n    .action(handleDashboardBuild);\n\n  // ============================================================================\n  // serve subcommand\n  // ============================================================================\n\n  dashboard\n    .command('serve')\n    .description('Serve the production dashboard build')\n    .option('-p, --port <port>', `Dashboard port (default: ${DEFAULT_DASHBOARD_PORT})`)\n    .option('--graphql-port <port>', `GraphQL server port (default: ${DEFAULT_GRAPHQL_PORT})`)\n    .option('-o, --open', 'Open dashboard in browser')\n    .option('-v, --verbose', 'Enable verbose logging')\n    .action(handleDashboardServe);\n\n  // ============================================================================\n  // open subcommand\n  // ============================================================================\n\n  dashboard\n    .command('open')\n    .description('Open the dashboard in the default browser')\n    .option('-p, --port <port>', `Dashboard port (default: ${DEFAULT_DASHBOARD_PORT})`)\n    .action(handleDashboardOpen);\n\n  // ============================================================================\n  // status subcommand\n  // ============================================================================\n\n  dashboard\n    .command('status')\n    .description('Check the dashboard and GraphQL server status')\n    .option('-p, --port <port>', `Dashboard port (default: ${DEFAULT_DASHBOARD_PORT})`)\n    .option('--graphql-port <port>', `GraphQL server port (default: ${DEFAULT_GRAPHQL_PORT})`)\n    .action(handleDashboardStatus);\n\n  // ============================================================================\n  // Default action (show help)\n  // ============================================================================\n\n  dashboard.action(() => {\n    console.log(chalk.cyan.bold('\\n  Knowledge Graph Dashboard\\n'));\n    console.log(chalk.gray('  Web interface for exploring and managing the knowledge graph.\\n'));\n\n    console.log(chalk.white('  Commands:'));\n    console.log(chalk.gray('    start    ') + chalk.white('Start development server'));\n    console.log(chalk.gray('    build    ') + chalk.white('Build for production'));\n    console.log(chalk.gray('    serve    ') + chalk.white('Serve production build'));\n    console.log(chalk.gray('    open     ') + chalk.white('Open in browser'));\n    console.log(chalk.gray('    status   ') + chalk.white('Check server status'));\n\n    console.log('\\n  Run', chalk.cyan('kg dashboard <command> --help'), 'for more information\\n');\n  });\n\n  return dashboard;\n}\n"],"names":[],"mappings":"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"}