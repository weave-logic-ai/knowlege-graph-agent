{"version":3,"file":"docs.js","sources":["../../../src/cli/commands/docs.ts"],"sourcesContent":["/**\n * Docs Command\n *\n * Initialize and manage documentation directory.\n */\n\nimport { Command } from 'commander';\nimport chalk from 'chalk';\nimport ora from 'ora';\nimport { initDocs, docsExist, getDocsPath } from '../../generators/docs-init.js';\nimport { validateProjectRoot, validateDocsPath } from '../../core/security.js';\n\n/**\n * Create docs command\n */\nexport function createDocsCommand(): Command {\n  const command = new Command('docs');\n\n  command\n    .description('Documentation management commands');\n\n  // Init subcommand\n  command\n    .command('init')\n    .description('Initialize documentation directory with weave-nn structure')\n    .option('-p, --path <path>', 'Project root path', '.')\n    .option('-d, --docs <path>', 'Docs directory path', 'docs')\n    .option('-t, --template <template>', 'Template to use (default, minimal)')\n    .option('--no-examples', 'Skip example files')\n    .option('--no-detect', 'Skip framework detection')\n    .option('-f, --force', 'Overwrite existing files')\n    .action(async (options) => {\n      const spinner = ora('Initializing documentation...').start();\n\n      try {\n        // Validate paths to prevent traversal attacks\n        const projectRoot = validateProjectRoot(options.path);\n        const docsPath = options.docs;\n        validateDocsPath(projectRoot, docsPath); // Ensure docs stays within project\n\n        // Check if docs already exist\n        if (docsExist(projectRoot, docsPath) && !options.force) {\n          spinner.warn(`Documentation already exists at ${docsPath}`);\n          console.log(chalk.gray('  Use --force to reinitialize'));\n          return;\n        }\n\n        const result = await initDocs({\n          projectRoot,\n          docsPath,\n          includeExamples: options.examples !== false,\n          detectFramework: options.detect !== false,\n        });\n\n        if (result.success) {\n          spinner.succeed('Documentation initialized!');\n        } else {\n          spinner.warn('Documentation initialized with errors');\n        }\n\n        console.log();\n        console.log(chalk.white('  Created:'));\n        console.log(chalk.gray(`    Path: ${result.docsPath}`));\n        console.log(chalk.green(`    Files: ${result.filesCreated.length}`));\n\n        if (result.errors.length > 0) {\n          console.log();\n          console.log(chalk.yellow('  Errors:'));\n          result.errors.forEach(err => {\n            console.log(chalk.gray(`    - ${err}`));\n          });\n        }\n\n        console.log();\n        console.log(chalk.cyan('Structure created:'));\n        console.log(chalk.gray(`\n    ${docsPath}/\n    ├── README.md           # Documentation home\n    ├── PRIMITIVES.md       # Technology primitives\n    ├── MOC.md              # Map of Content\n    ├── concepts/           # Abstract concepts\n    ├── components/         # Reusable components\n    ├── services/           # Backend services\n    ├── features/           # Product features\n    ├── integrations/       # External integrations\n    ├── standards/          # Coding standards\n    ├── guides/             # How-to guides\n    └── references/         # API references\n        `));\n\n        console.log(chalk.cyan('Next: ') + chalk.white('kg graph') + chalk.gray(' to generate knowledge graph'));\n        console.log();\n\n      } catch (error) {\n        spinner.fail('Failed to initialize documentation');\n        console.error(chalk.red(String(error)));\n        process.exit(1);\n      }\n    });\n\n  // Status subcommand\n  command\n    .command('status')\n    .description('Show documentation status')\n    .option('-p, --path <path>', 'Project root path', '.')\n    .action(async (options) => {\n      // Validate path to prevent traversal\n      const projectRoot = validateProjectRoot(options.path);\n      const docsPath = getDocsPath(projectRoot);\n\n      if (!docsPath) {\n        console.log(chalk.yellow('  No documentation directory found'));\n        console.log(chalk.gray('  Run ') + chalk.cyan('kg docs init') + chalk.gray(' to create one'));\n        return;\n      }\n\n      console.log(chalk.white('\\n  Documentation Status\\n'));\n      console.log(chalk.gray('  Path:'), chalk.white(docsPath));\n      console.log();\n\n      // Count files\n      const fg = await import('fast-glob');\n      const files = await fg.default('**/*.md', {\n        cwd: docsPath,\n        ignore: ['node_modules/**', '.git/**'],\n      });\n\n      console.log(chalk.gray('  Markdown files:'), chalk.white(files.length));\n\n      // Check for key files\n      const keyFiles = ['README.md', 'PRIMITIVES.md', 'MOC.md'];\n      const fs = await import('fs');\n      const path = await import('path');\n\n      console.log();\n      console.log(chalk.white('  Key Files:'));\n      keyFiles.forEach(file => {\n        const exists = fs.existsSync(path.join(docsPath, file));\n        const icon = exists ? chalk.green('✓') : chalk.red('✗');\n        console.log(`    ${icon} ${file}`);\n      });\n\n      // Check directories\n      const dirs = ['concepts', 'components', 'services', 'features', 'guides'];\n      console.log();\n      console.log(chalk.white('  Directories:'));\n      dirs.forEach(dir => {\n        const exists = fs.existsSync(path.join(docsPath, dir));\n        const icon = exists ? chalk.green('✓') : chalk.gray('○');\n        console.log(`    ${icon} ${dir}/`);\n      });\n\n      console.log();\n    });\n\n  return command;\n}\n"],"names":[],"mappings":"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"}