{"version":3,"file":"analyze-links.js","sources":["../../../../src/cli/commands/hive-mind/analyze-links.ts"],"sourcesContent":["/**\n * Hive Mind - Link Analyzer\n *\n * Analyzes wiki-links and markdown links in a vault to build an adjacency list\n * and identify orphan files.\n *\n * SPEC-003: Hive Mind Reconnection Tools\n */\n\nimport { Command } from 'commander';\nimport chalk from 'chalk';\nimport * as path from 'path';\nimport { readFile, access, writeFile } from 'fs/promises';\nimport { glob } from 'fast-glob';\nimport matter from 'gray-matter';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface AnalyzeOptions {\n  output?: string;\n  json?: boolean;\n  verbose?: boolean;\n  includeContent?: boolean;\n}\n\nexport interface BrokenLink {\n  source: string;\n  target: string;\n  type: 'wikilink' | 'markdown';\n  lineNumber?: number;\n}\n\nexport interface LinkAnalysisResult {\n  totalFiles: number;\n  filesWithLinks: number;\n  orphanFiles: string[];\n  orphanRate: number;\n  linkDensity: number;\n  adjacencyList: Map<string, string[]>;\n  brokenLinks: BrokenLink[];\n  statistics: {\n    totalLinks: number;\n    wikiLinks: number;\n    markdownLinks: number;\n    averageLinksPerFile: number;\n    maxLinksInFile: number;\n    maxLinksFile: string;\n    isolatedClusters: number;\n  };\n}\n\n// ============================================================================\n// Link Analyzer Class\n// ============================================================================\n\nexport class LinkAnalyzer {\n  private fileMap: Map<string, string> = new Map();\n  private allFiles: Set<string> = new Set();\n\n  /**\n   * Analyze a vault for links and build adjacency list\n   */\n  async analyzeVault(vaultPath: string, options: AnalyzeOptions = {}): Promise<LinkAnalysisResult> {\n    const resolvedPath = path.resolve(vaultPath);\n\n    // Check if path exists\n    try {\n      await access(resolvedPath);\n    } catch {\n      throw new Error(`Vault path does not exist: ${resolvedPath}`);\n    }\n\n    // Find all markdown files\n    const files = await glob('**/*.md', {\n      cwd: resolvedPath,\n      ignore: ['node_modules/**', '.git/**', 'dist/**'],\n      absolute: false,\n    });\n\n    if (files.length === 0) {\n      throw new Error(`No markdown files found in: ${resolvedPath}`);\n    }\n\n    // Build file map for resolution (filename without extension -> full path)\n    this.buildFileMap(files);\n\n    const adjacencyList = new Map<string, string[]>();\n    const brokenLinks: BrokenLink[] = [];\n    const incomingLinks = new Map<string, Set<string>>();\n    let totalWikiLinks = 0;\n    let totalMarkdownLinks = 0;\n    let maxLinksInFile = 0;\n    let maxLinksFile = '';\n\n    // Initialize adjacency list and incoming links\n    for (const file of files) {\n      adjacencyList.set(file, []);\n      incomingLinks.set(file, new Set());\n    }\n\n    // Process each file\n    for (const file of files) {\n      const filePath = path.join(resolvedPath, file);\n      const content = await readFile(filePath, 'utf-8');\n\n      // Parse frontmatter to skip it for link counting\n      const { content: bodyContent } = matter(content);\n\n      // Extract links\n      const wikiLinks = this.parseWikiLinks(bodyContent);\n      const markdownLinks = this.parseMarkdownLinks(bodyContent);\n\n      totalWikiLinks += wikiLinks.length;\n      totalMarkdownLinks += markdownLinks.length;\n\n      const fileLinks = adjacencyList.get(file) || [];\n      const totalLinksInThisFile = wikiLinks.length + markdownLinks.length;\n\n      if (totalLinksInThisFile > maxLinksInFile) {\n        maxLinksInFile = totalLinksInThisFile;\n        maxLinksFile = file;\n      }\n\n      // Process wiki links\n      for (const link of wikiLinks) {\n        const resolved = this.resolveLink(link, file);\n        if (resolved && this.allFiles.has(resolved)) {\n          fileLinks.push(resolved);\n          incomingLinks.get(resolved)?.add(file);\n        } else {\n          brokenLinks.push({\n            source: file,\n            target: link,\n            type: 'wikilink',\n          });\n        }\n      }\n\n      // Process markdown links\n      for (const link of markdownLinks) {\n        const resolved = this.resolveLink(link, file);\n        if (resolved && this.allFiles.has(resolved)) {\n          fileLinks.push(resolved);\n          incomingLinks.get(resolved)?.add(file);\n        } else if (!this.isExternalLink(link)) {\n          brokenLinks.push({\n            source: file,\n            target: link,\n            type: 'markdown',\n          });\n        }\n      }\n\n      adjacencyList.set(file, [...new Set(fileLinks)]); // Dedupe\n    }\n\n    // Find orphan files (no incoming AND no outgoing links)\n    const orphanFiles: string[] = [];\n    for (const file of files) {\n      const outgoing = adjacencyList.get(file) || [];\n      const incoming = incomingLinks.get(file) || new Set();\n      if (outgoing.length === 0 && incoming.size === 0) {\n        orphanFiles.push(file);\n      }\n    }\n\n    // Calculate metrics\n    const totalFiles = files.length;\n    const filesWithLinks = files.filter(f => {\n      const outgoing = adjacencyList.get(f) || [];\n      const incoming = incomingLinks.get(f) || new Set();\n      return outgoing.length > 0 || incoming.size > 0;\n    }).length;\n\n    const orphanRate = totalFiles > 0 ? (orphanFiles.length / totalFiles) * 100 : 0;\n    const totalLinks = totalWikiLinks + totalMarkdownLinks;\n    const linkDensity = totalFiles > 0 ? totalLinks / totalFiles : 0;\n    const averageLinksPerFile = totalFiles > 0 ? totalLinks / totalFiles : 0;\n\n    // Calculate isolated clusters using union-find\n    const isolatedClusters = this.countClusters(adjacencyList, files);\n\n    return {\n      totalFiles,\n      filesWithLinks,\n      orphanFiles,\n      orphanRate: Math.round(orphanRate * 100) / 100,\n      linkDensity: Math.round(linkDensity * 100) / 100,\n      adjacencyList,\n      brokenLinks,\n      statistics: {\n        totalLinks,\n        wikiLinks: totalWikiLinks,\n        markdownLinks: totalMarkdownLinks,\n        averageLinksPerFile: Math.round(averageLinksPerFile * 100) / 100,\n        maxLinksInFile,\n        maxLinksFile,\n        isolatedClusters,\n      },\n    };\n  }\n\n  /**\n   * Build a map from filename (without extension) to full path\n   */\n  private buildFileMap(files: string[]): void {\n    this.fileMap.clear();\n    this.allFiles.clear();\n\n    for (const file of files) {\n      this.allFiles.add(file);\n\n      // Map by filename without extension\n      const basename = path.basename(file, '.md');\n      if (!this.fileMap.has(basename)) {\n        this.fileMap.set(basename, file);\n      }\n\n      // Also map by full path without extension\n      const pathWithoutExt = file.replace(/\\.md$/, '');\n      this.fileMap.set(pathWithoutExt, file);\n    }\n  }\n\n  /**\n   * Parse [[wiki-links]] from content\n   * Handles: [[link]], [[link|alias]], [[folder/link]], [[link#heading]]\n   */\n  parseWikiLinks(content: string): string[] {\n    const links: string[] = [];\n    // Match [[link]] and [[link|alias]] patterns\n    const regex = /\\[\\[([^\\]|#]+)(?:#[^\\]|]*)?(?:\\|[^\\]]+)?\\]\\]/g;\n    let match;\n\n    while ((match = regex.exec(content)) !== null) {\n      const link = match[1].trim();\n      if (link) {\n        links.push(link);\n      }\n    }\n\n    return links;\n  }\n\n  /**\n   * Parse [markdown](links) from content\n   * Handles: [text](link.md), [text](./link.md), [text](../folder/link.md)\n   */\n  parseMarkdownLinks(content: string): string[] {\n    const links: string[] = [];\n    // Match [text](link) patterns, excluding images ![...](...) and external links\n    const regex = /(?<!!)\\[([^\\]]*)\\]\\(([^)]+)\\)/g;\n    let match;\n\n    while ((match = regex.exec(content)) !== null) {\n      const link = match[2].trim();\n      // Skip external links, anchors, and non-md files\n      if (link && !this.isExternalLink(link) && !link.startsWith('#')) {\n        links.push(link);\n      }\n    }\n\n    return links;\n  }\n\n  /**\n   * Check if a link is external (http, https, etc.)\n   */\n  private isExternalLink(link: string): boolean {\n    return /^(https?:|mailto:|tel:|ftp:)/i.test(link);\n  }\n\n  /**\n   * Resolve a link to a file in the vault\n   */\n  private resolveLink(link: string, sourceFile: string): string | null {\n    // Remove .md extension if present\n    let cleanLink = link.replace(/\\.md$/, '');\n\n    // Remove leading ./ or ../ and resolve relative paths\n    if (cleanLink.startsWith('./') || cleanLink.startsWith('../')) {\n      const sourceDir = path.dirname(sourceFile);\n      const resolved = path.normalize(path.join(sourceDir, cleanLink));\n      cleanLink = resolved;\n    }\n\n    // Try to find in file map\n    const found = this.fileMap.get(cleanLink);\n    if (found) return found;\n\n    // Try with .md extension\n    const withMd = cleanLink + '.md';\n    if (this.allFiles.has(withMd)) return withMd;\n\n    // Try just the basename (for simple wiki-links)\n    const basename = path.basename(cleanLink);\n    const byBasename = this.fileMap.get(basename);\n    if (byBasename) return byBasename;\n\n    return null;\n  }\n\n  /**\n   * Count isolated clusters using union-find algorithm\n   */\n  private countClusters(adjacencyList: Map<string, string[]>, files: string[]): number {\n    const parent = new Map<string, string>();\n    const rank = new Map<string, number>();\n\n    // Initialize each file as its own cluster\n    for (const file of files) {\n      parent.set(file, file);\n      rank.set(file, 0);\n    }\n\n    const find = (x: string): string => {\n      if (parent.get(x) !== x) {\n        parent.set(x, find(parent.get(x)!));\n      }\n      return parent.get(x)!;\n    };\n\n    const union = (x: string, y: string): void => {\n      const rootX = find(x);\n      const rootY = find(y);\n      if (rootX !== rootY) {\n        const rankX = rank.get(rootX) || 0;\n        const rankY = rank.get(rootY) || 0;\n        if (rankX < rankY) {\n          parent.set(rootX, rootY);\n        } else if (rankX > rankY) {\n          parent.set(rootY, rootX);\n        } else {\n          parent.set(rootY, rootX);\n          rank.set(rootX, rankX + 1);\n        }\n      }\n    };\n\n    // Union connected files\n    for (const [source, targets] of adjacencyList) {\n      for (const target of targets) {\n        if (parent.has(target)) {\n          union(source, target);\n        }\n      }\n    }\n\n    // Count unique roots\n    const roots = new Set<string>();\n    for (const file of files) {\n      roots.add(find(file));\n    }\n\n    return roots.size;\n  }\n\n  /**\n   * Generate a detailed report\n   */\n  generateReport(result: LinkAnalysisResult): string {\n    const lines: string[] = [];\n\n    lines.push('# Link Analysis Report\\n');\n    lines.push(`Generated: ${new Date().toISOString()}\\n`);\n\n    lines.push('## Summary\\n');\n    lines.push(`| Metric | Value |`);\n    lines.push(`|--------|-------|`);\n    lines.push(`| Total Files | ${result.totalFiles} |`);\n    lines.push(`| Files with Links | ${result.filesWithLinks} |`);\n    lines.push(`| Orphan Files | ${result.orphanFiles.length} |`);\n    lines.push(`| Orphan Rate | ${result.orphanRate}% |`);\n    lines.push(`| Link Density | ${result.linkDensity} |`);\n    lines.push(`| Total Links | ${result.statistics.totalLinks} |`);\n    lines.push(`| Wiki Links | ${result.statistics.wikiLinks} |`);\n    lines.push(`| Markdown Links | ${result.statistics.markdownLinks} |`);\n    lines.push(`| Avg Links/File | ${result.statistics.averageLinksPerFile} |`);\n    lines.push(`| Max Links in File | ${result.statistics.maxLinksInFile} |`);\n    lines.push(`| Most Linked File | ${result.statistics.maxLinksFile} |`);\n    lines.push(`| Isolated Clusters | ${result.statistics.isolatedClusters} |`);\n    lines.push('');\n\n    if (result.orphanFiles.length > 0) {\n      lines.push('## Orphan Files\\n');\n      lines.push('Files with no incoming or outgoing links:\\n');\n      for (const file of result.orphanFiles.slice(0, 50)) {\n        lines.push(`- \\`${file}\\``);\n      }\n      if (result.orphanFiles.length > 50) {\n        lines.push(`\\n... and ${result.orphanFiles.length - 50} more`);\n      }\n      lines.push('');\n    }\n\n    if (result.brokenLinks.length > 0) {\n      lines.push('## Broken Links\\n');\n      lines.push('Links that point to non-existent files:\\n');\n      for (const broken of result.brokenLinks.slice(0, 50)) {\n        lines.push(`- \\`${broken.source}\\` -> \\`${broken.target}\\` (${broken.type})`);\n      }\n      if (result.brokenLinks.length > 50) {\n        lines.push(`\\n... and ${result.brokenLinks.length - 50} more`);\n      }\n      lines.push('');\n    }\n\n    return lines.join('\\n');\n  }\n}\n\n// ============================================================================\n// CLI Command\n// ============================================================================\n\nexport function createAnalyzeLinksCommand(): Command {\n  const command = new Command('analyze-links')\n    .description('Analyze wiki-links and markdown links in a vault')\n    .argument('<vault-path>', 'Path to Obsidian vault or docs directory')\n    .option('-o, --output <file>', 'Output file for results (JSON or Markdown)')\n    .option('--json', 'Output as JSON')\n    .option('-v, --verbose', 'Show detailed output')\n    .action(async (vaultPath: string, options: AnalyzeOptions) => {\n      const analyzer = new LinkAnalyzer();\n\n      console.log(chalk.cyan('\\nAnalyzing links in vault...\\n'));\n\n      try {\n        const result = await analyzer.analyzeVault(vaultPath, options);\n\n        if (options.json) {\n          // Convert Map to Object for JSON serialization\n          const jsonResult = {\n            ...result,\n            adjacencyList: Object.fromEntries(result.adjacencyList),\n          };\n\n          if (options.output) {\n            await writeFile(options.output, JSON.stringify(jsonResult, null, 2));\n            console.log(chalk.green(`Results written to: ${options.output}`));\n          } else {\n            console.log(JSON.stringify(jsonResult, null, 2));\n          }\n        } else {\n          // Display summary\n          console.log(chalk.bold('Summary:'));\n          console.log(chalk.white(`  Total Files:      ${result.totalFiles}`));\n          console.log(chalk.white(`  Files with Links: ${result.filesWithLinks}`));\n          console.log(chalk.white(`  Orphan Files:     ${chalk.yellow(result.orphanFiles.length.toString())}`));\n          console.log(chalk.white(`  Orphan Rate:      ${chalk.yellow(result.orphanRate + '%')}`));\n          console.log(chalk.white(`  Link Density:     ${result.linkDensity}`));\n          console.log('');\n\n          console.log(chalk.bold('Link Statistics:'));\n          console.log(chalk.white(`  Total Links:      ${result.statistics.totalLinks}`));\n          console.log(chalk.white(`  Wiki Links:       ${result.statistics.wikiLinks}`));\n          console.log(chalk.white(`  Markdown Links:   ${result.statistics.markdownLinks}`));\n          console.log(chalk.white(`  Avg Links/File:   ${result.statistics.averageLinksPerFile}`));\n          console.log(chalk.white(`  Isolated Clusters: ${result.statistics.isolatedClusters}`));\n          console.log('');\n\n          if (result.brokenLinks.length > 0) {\n            console.log(chalk.bold(chalk.red(`Broken Links: ${result.brokenLinks.length}`)));\n            if (options.verbose) {\n              for (const broken of result.brokenLinks.slice(0, 10)) {\n                console.log(chalk.red(`  ${broken.source} -> ${broken.target}`));\n              }\n              if (result.brokenLinks.length > 10) {\n                console.log(chalk.gray(`  ... and ${result.brokenLinks.length - 10} more`));\n              }\n            }\n            console.log('');\n          }\n\n          if (options.verbose && result.orphanFiles.length > 0) {\n            console.log(chalk.bold(chalk.yellow('Orphan Files:')));\n            for (const file of result.orphanFiles.slice(0, 10)) {\n              console.log(chalk.yellow(`  ${file}`));\n            }\n            if (result.orphanFiles.length > 10) {\n              console.log(chalk.gray(`  ... and ${result.orphanFiles.length - 10} more`));\n            }\n            console.log('');\n          }\n\n          // Write report if output specified\n          if (options.output) {\n            const report = analyzer.generateReport(result);\n            await writeFile(options.output, report);\n            console.log(chalk.green(`Report written to: ${options.output}`));\n          }\n\n          // Show target metrics comparison\n          console.log(chalk.bold('Target Metrics:'));\n          const orphanStatus = result.orphanRate < 10 ? chalk.green('PASS') : chalk.red('FAIL');\n          const densityStatus = result.linkDensity > 5.0 ? chalk.green('PASS') : chalk.red('FAIL');\n          console.log(chalk.white(`  Orphan Rate:   ${result.orphanRate}% (target: < 10%) ${orphanStatus}`));\n          console.log(chalk.white(`  Link Density:  ${result.linkDensity} (target: > 5.0) ${densityStatus}`));\n          console.log('');\n        }\n      } catch (error) {\n        console.error(chalk.red('Error:'), error instanceof Error ? error.message : 'Unknown error');\n        process.exit(1);\n      }\n    });\n\n  return command;\n}\n\nexport default createAnalyzeLinksCommand;\n"],"names":[],"mappings":"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"}