{"version":3,"file":"init-primitives.js","sources":["../../../src/cli/commands/init-primitives.ts"],"sourcesContent":["/**\n * Init Primitives Command\n *\n * Bootstrap knowledge graph with primitive nodes from codebase analysis.\n * Analyzes package.json, requirements.txt, Cargo.toml, go.mod, docker-compose,\n * and other project files to generate foundational knowledge nodes.\n *\n * @module cli/commands/init-primitives\n */\n\nimport { Command } from 'commander';\nimport { resolve, join } from 'path';\nimport { existsSync } from 'fs';\nimport { SeedGenerator, initPrimitives } from '../../cultivation/index.js';\nimport type { CultivationOptions, Ecosystem } from '../../cultivation/types.js';\n\n/**\n * Create the init-primitives command\n */\nexport function createInitPrimitivesCommand(): Command {\n  const cmd = new Command('init-primitives')\n    .description('Bootstrap knowledge graph with primitive nodes from codebase')\n    .option('-p, --path <path>', 'Project root path', process.cwd())\n    .option('-d, --docs <path>', 'Documentation path', 'docs')\n    .option('-o, --output <path>', 'Output path for primitives (defaults to docs path)')\n    .option('--dry-run', 'Analyze only, do not write files')\n    .option('-v, --verbose', 'Verbose output')\n    .option('--ecosystem <ecosystems>', 'Filter to specific ecosystems (comma-separated: nodejs,python,rust,go,php,java)')\n    .option('--include-dev', 'Include dev dependencies', false)\n    .option('--major-only', 'Only generate nodes for major dependencies', false)\n    .action(async (options) => {\n      const projectRoot = resolve(options.path);\n      const docsPath = options.docs;\n      const outputPath = options.output || docsPath;\n      const verbose = options.verbose;\n      const dryRun = options.dryRun;\n\n      console.log(`\\nüå± Initializing Primitives\\n`);\n      console.log(`  Project: ${projectRoot}`);\n      console.log(`  Docs: ${docsPath}`);\n      if (dryRun) {\n        console.log(`  Mode: Dry Run (no files will be written)`);\n      }\n      console.log('');\n\n      try {\n        // Parse ecosystem filter\n        let ecosystems: Ecosystem[] | undefined;\n        if (options.ecosystem) {\n          ecosystems = options.ecosystem.split(',').map((e: string) => e.trim() as Ecosystem);\n        }\n\n        // Create options\n        const cultivationOptions: CultivationOptions = {\n          projectRoot,\n          docsPath,\n          outputPath: join(projectRoot, outputPath),\n          dryRun,\n          verbose,\n          ecosystems,\n          includeDev: options.includeDev,\n          minImportance: options.majorOnly ? 'major' : 'all'\n        };\n\n        // Create generator and run\n        console.log('üìä Analyzing codebase...\\n');\n        const generator = await SeedGenerator.create(projectRoot, docsPath);\n        const analysis = await generator.analyze();\n\n        // Display analysis results\n        console.log('üì¶ Analysis Results:');\n        console.log(`  Languages: ${analysis.languages.join(', ') || 'none'}`);\n        console.log(`  Dependencies: ${analysis.dependencies.length}`);\n        console.log(`  Frameworks: ${analysis.frameworks.length}`);\n        console.log(`  Services: ${analysis.services.length}`);\n        console.log(`  Deployments: ${analysis.deployments.length}`);\n        console.log(`  Existing Concepts: ${analysis.existingConcepts.length}`);\n        console.log(`  Files Scanned: ${analysis.metadata.filesScanned}`);\n        console.log(`  Duration: ${analysis.metadata.duration}ms`);\n        console.log('');\n\n        if (verbose) {\n          // Show frameworks\n          if (analysis.frameworks.length > 0) {\n            console.log('üèóÔ∏è  Detected Frameworks:');\n            for (const fw of analysis.frameworks) {\n              console.log(`  - ${fw.name} (${fw.ecosystem}) v${fw.version}`);\n            }\n            console.log('');\n          }\n\n          // Show services\n          if (analysis.services.length > 0) {\n            console.log('üîß Detected Services:');\n            for (const svc of analysis.services) {\n              console.log(`  - ${svc.name} (${svc.type}) - ${svc.technology}`);\n            }\n            console.log('');\n          }\n\n          // Show deployments\n          if (analysis.deployments.length > 0) {\n            console.log('üöÄ Deployment Configurations:');\n            for (const dep of analysis.deployments) {\n              console.log(`  - ${dep}`);\n            }\n            console.log('');\n          }\n        }\n\n        // Generate primitives\n        console.log('üìù Generating primitive nodes...\\n');\n        const documents = await generator.generatePrimitives(analysis);\n\n        if (dryRun) {\n          console.log(`üìÑ Would create ${documents.length} primitive nodes:\\n`);\n          for (const doc of documents) {\n            console.log(`  - ${doc.frontmatter.type}: ${doc.title}`);\n            if (verbose) {\n              console.log(`    Path: ${doc.path}`);\n              console.log(`    Category: ${doc.frontmatter.category}`);\n            }\n          }\n          console.log('\\n‚ú® Dry run complete! Run without --dry-run to create files.\\n');\n        } else {\n          const result = await generator.writePrimitives(documents);\n\n          console.log('‚úÖ Primitives Created:\\n');\n          console.log(`  Documents: ${result.documentsGenerated.length}`);\n          console.log(`  Directories: ${result.directoriesCreated.length}`);\n\n          if (result.warnings.length > 0) {\n            console.log('\\n‚ö†Ô∏è  Warnings:');\n            for (const warning of result.warnings) {\n              console.log(`  - ${warning}`);\n            }\n          }\n\n          if (result.errors.length > 0) {\n            console.log('\\n‚ùå Errors:');\n            for (const error of result.errors) {\n              console.log(`  - ${error}`);\n            }\n          }\n\n          if (verbose && result.documentsGenerated.length > 0) {\n            console.log('\\nüìÑ Created Files:');\n            for (const doc of result.documentsGenerated) {\n              console.log(`  - ${doc.path}`);\n            }\n          }\n\n          console.log('\\n‚ú® Primitives initialization complete!\\n');\n\n          // Suggest next steps\n          console.log('üìö Next Steps:');\n          console.log('  1. Review generated primitives in docs/');\n          console.log('  2. Run \"kg generate\" to build knowledge graph');\n          console.log('  3. Run \"kg sop init\" to initialize compliance tracking');\n          console.log('');\n        }\n\n      } catch (error) {\n        console.error('\\n‚ùå Initialization failed:', error);\n        process.exit(1);\n      }\n    });\n\n  return cmd;\n}\n\n/**\n * Create the analyze-codebase command (alias for analysis without generation)\n */\nexport function createAnalyzeCodebaseCommand(): Command {\n  const cmd = new Command('analyze-codebase')\n    .description('Analyze codebase dependencies and services without generating nodes')\n    .option('-p, --path <path>', 'Project root path', process.cwd())\n    .option('-d, --docs <path>', 'Documentation path', 'docs')\n    .option('-v, --verbose', 'Verbose output')\n    .option('--json', 'Output as JSON')\n    .action(async (options) => {\n      const projectRoot = resolve(options.path);\n      const docsPath = options.docs;\n      const verbose = options.verbose;\n      const jsonOutput = options.json;\n\n      if (!jsonOutput) {\n        console.log(`\\nüîç Analyzing Codebase\\n`);\n        console.log(`  Project: ${projectRoot}`);\n        console.log('');\n      }\n\n      try {\n        const generator = await SeedGenerator.create(projectRoot, docsPath);\n        const analysis = await generator.analyze();\n\n        if (jsonOutput) {\n          console.log(JSON.stringify(analysis, null, 2));\n          return;\n        }\n\n        // Summary\n        console.log('üìä Analysis Summary:');\n        console.log(`  Languages: ${analysis.languages.join(', ') || 'none'}`);\n        console.log(`  Total Dependencies: ${analysis.dependencies.length}`);\n        console.log(`  Frameworks: ${analysis.frameworks.length}`);\n        console.log(`  Services: ${analysis.services.length}`);\n        console.log(`  Deployments: ${analysis.deployments.length}`);\n        console.log('');\n\n        // Dependencies by ecosystem\n        const byEcosystem = new Map<string, number>();\n        for (const dep of analysis.dependencies) {\n          byEcosystem.set(dep.ecosystem, (byEcosystem.get(dep.ecosystem) || 0) + 1);\n        }\n        if (byEcosystem.size > 0) {\n          console.log('üì¶ Dependencies by Ecosystem:');\n          for (const [ecosystem, count] of byEcosystem.entries()) {\n            console.log(`  - ${ecosystem}: ${count}`);\n          }\n          console.log('');\n        }\n\n        // Frameworks\n        if (analysis.frameworks.length > 0) {\n          console.log('üèóÔ∏è  Frameworks:');\n          for (const fw of analysis.frameworks) {\n            console.log(`  - ${fw.name} (${fw.ecosystem}) v${fw.version}`);\n            if (verbose && fw.usedBy.length > 0) {\n              console.log(`    Used by: ${fw.usedBy.slice(0, 3).join(', ')}${fw.usedBy.length > 3 ? '...' : ''}`);\n            }\n          }\n          console.log('');\n        }\n\n        // Services\n        if (analysis.services.length > 0) {\n          console.log('üîß Services:');\n          for (const svc of analysis.services) {\n            console.log(`  - ${svc.name}`);\n            console.log(`    Type: ${svc.type}, Technology: ${svc.technology}`);\n            if (svc.ports && svc.ports.length > 0) {\n              console.log(`    Ports: ${svc.ports.join(', ')}`);\n            }\n          }\n          console.log('');\n        }\n\n        // Deployments\n        if (analysis.deployments.length > 0) {\n          console.log('üöÄ Deployment Configurations:');\n          for (const dep of analysis.deployments) {\n            console.log(`  - ${dep}`);\n          }\n          console.log('');\n        }\n\n        // Existing vault content\n        if (analysis.existingConcepts.length > 0 || analysis.existingFeatures.length > 0) {\n          console.log('üìö Existing Documentation:');\n          console.log(`  Concepts: ${analysis.existingConcepts.length}`);\n          console.log(`  Features: ${analysis.existingFeatures.length}`);\n          console.log('');\n        }\n\n        console.log(`‚è±Ô∏è  Analysis completed in ${analysis.metadata.duration}ms`);\n        console.log(`üìÑ Files scanned: ${analysis.metadata.filesScanned}`);\n        console.log('');\n\n      } catch (error) {\n        console.error('\\n‚ùå Analysis failed:', error);\n        process.exit(1);\n      }\n    });\n\n  return cmd;\n}\n"],"names":[],"mappings":"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"}