{"version":3,"file":"init.js","sources":["../../../src/cli/commands/init.ts"],"sourcesContent":["/**\n * Init Command\n *\n * Initialize knowledge graph in a project.\n */\n\nimport { Command } from 'commander';\nimport chalk from 'chalk';\nimport ora from 'ora';\nimport { existsSync, mkdirSync, writeFileSync } from 'fs';\nimport { join } from 'path';\nimport { ConfigSchema } from '../../core/types.js';\nimport { createDatabase } from '../../core/database.js';\nimport { validateProjectRoot, validateDocsPath } from '../../core/security.js';\n\n/**\n * Create init command\n */\nexport function createInitCommand(): Command {\n  const command = new Command('init');\n\n  command\n    .description('Initialize knowledge graph in the current project')\n    .option('-p, --path <path>', 'Project root path', '.')\n    .option('-d, --docs <path>', 'Docs directory path', 'docs')\n    .option('-n, --name <name>', 'Project name')\n    .option('--no-db', 'Skip database initialization')\n    .option('--no-config', 'Skip config file creation')\n    .option('-f, --force', 'Overwrite existing files')\n    .action(async (options) => {\n      const spinner = ora('Initializing knowledge graph...').start();\n\n      try {\n        // Validate paths to prevent traversal attacks\n        const projectRoot = validateProjectRoot(options.path);\n        const docsPath = options.docs; // Relative path for config, validated when used\n        validateDocsPath(projectRoot, docsPath); // Validate it stays within project\n        const kgDir = join(projectRoot, '.kg');\n\n        // Check if already initialized\n        if (existsSync(kgDir) && !options.force) {\n          spinner.warn('Knowledge graph already initialized. Use --force to reinitialize.');\n          return;\n        }\n\n        // Create .kg directory\n        if (!existsSync(kgDir)) {\n          mkdirSync(kgDir, { recursive: true });\n        }\n\n        // Initialize database\n        if (options.db !== false) {\n          spinner.text = 'Creating database...';\n          const dbPath = join(kgDir, 'knowledge.db');\n          const db = createDatabase(dbPath);\n\n          // Set initial metadata\n          db.setMetadata('projectRoot', projectRoot);\n          db.setMetadata('docsPath', docsPath);\n          db.setMetadata('initialized', new Date().toISOString());\n\n          db.close();\n        }\n\n        // Create config file\n        if (options.config !== false) {\n          spinner.text = 'Creating configuration...';\n          const configPath = join(kgDir, 'config.json');\n\n          if (!existsSync(configPath) || options.force) {\n            const config = ConfigSchema.parse({\n              projectRoot: '.',\n              docsRoot: docsPath,\n              vaultName: options.name,\n              graph: {\n                includePatterns: ['**/*.md'],\n                excludePatterns: ['node_modules/**', 'dist/**', '.git/**'],\n              },\n              database: {\n                path: '.kg/knowledge.db',\n              },\n              claudeFlow: {\n                enabled: true,\n                namespace: 'knowledge-graph',\n                syncOnChange: true,\n              },\n            });\n\n            writeFileSync(configPath, JSON.stringify(config, null, 2), 'utf-8');\n          }\n        }\n\n        // Create .gitignore entry\n        const gitignorePath = join(kgDir, '.gitignore');\n        if (!existsSync(gitignorePath)) {\n          writeFileSync(gitignorePath, '# Knowledge Graph Database\\nknowledge.db\\nknowledge.db-wal\\nknowledge.db-shm\\n', 'utf-8');\n        }\n\n        spinner.succeed('Knowledge graph initialized!');\n\n        // Show next steps\n        console.log('\\n' + chalk.cyan('Next steps:'));\n        console.log(chalk.gray('  1. Initialize docs:    ') + chalk.white('kg docs init'));\n        console.log(chalk.gray('  2. Generate graph:     ') + chalk.white('kg graph'));\n        console.log(chalk.gray('  3. Update CLAUDE.md:   ') + chalk.white('kg claude update'));\n        console.log(chalk.gray('  4. Sync with claude-flow: ') + chalk.white('kg sync'));\n        console.log();\n\n      } catch (error) {\n        spinner.fail('Failed to initialize knowledge graph');\n        console.error(chalk.red(String(error)));\n        process.exit(1);\n      }\n    });\n\n  return command;\n}\n"],"names":[],"mappings":";;;;;;;;AAkBO,SAAS,oBAA6B;AAC3C,QAAM,UAAU,IAAI,QAAQ,MAAM;AAElC,UACG,YAAY,mDAAmD,EAC/D,OAAO,qBAAqB,qBAAqB,GAAG,EACpD,OAAO,qBAAqB,uBAAuB,MAAM,EACzD,OAAO,qBAAqB,cAAc,EAC1C,OAAO,WAAW,8BAA8B,EAChD,OAAO,eAAe,2BAA2B,EACjD,OAAO,eAAe,0BAA0B,EAChD,OAAO,OAAO,YAAY;AACzB,UAAM,UAAU,IAAI,iCAAiC,EAAE,MAAA;AAEvD,QAAI;AAEF,YAAM,cAAc,oBAAoB,QAAQ,IAAI;AACpD,YAAM,WAAW,QAAQ;AACzB,uBAAiB,aAAa,QAAQ;AACtC,YAAM,QAAQ,KAAK,aAAa,KAAK;AAGrC,UAAI,WAAW,KAAK,KAAK,CAAC,QAAQ,OAAO;AACvC,gBAAQ,KAAK,mEAAmE;AAChF;AAAA,MACF;AAGA,UAAI,CAAC,WAAW,KAAK,GAAG;AACtB,kBAAU,OAAO,EAAE,WAAW,KAAA,CAAM;AAAA,MACtC;AAGA,UAAI,QAAQ,OAAO,OAAO;AACxB,gBAAQ,OAAO;AACf,cAAM,SAAS,KAAK,OAAO,cAAc;AACzC,cAAM,KAAK,eAAe,MAAM;AAGhC,WAAG,YAAY,eAAe,WAAW;AACzC,WAAG,YAAY,YAAY,QAAQ;AACnC,WAAG,YAAY,gBAAe,oBAAI,KAAA,GAAO,aAAa;AAEtD,WAAG,MAAA;AAAA,MACL;AAGA,UAAI,QAAQ,WAAW,OAAO;AAC5B,gBAAQ,OAAO;AACf,cAAM,aAAa,KAAK,OAAO,aAAa;AAE5C,YAAI,CAAC,WAAW,UAAU,KAAK,QAAQ,OAAO;AAC5C,gBAAM,SAAS,aAAa,MAAM;AAAA,YAChC,aAAa;AAAA,YACb,UAAU;AAAA,YACV,WAAW,QAAQ;AAAA,YACnB,OAAO;AAAA,cACL,iBAAiB,CAAC,SAAS;AAAA,cAC3B,iBAAiB,CAAC,mBAAmB,WAAW,SAAS;AAAA,YAAA;AAAA,YAE3D,UAAU;AAAA,cACR,MAAM;AAAA,YAAA;AAAA,YAER,YAAY;AAAA,cACV,SAAS;AAAA,cACT,WAAW;AAAA,cACX,cAAc;AAAA,YAAA;AAAA,UAChB,CACD;AAED,wBAAc,YAAY,KAAK,UAAU,QAAQ,MAAM,CAAC,GAAG,OAAO;AAAA,QACpE;AAAA,MACF;AAGA,YAAM,gBAAgB,KAAK,OAAO,YAAY;AAC9C,UAAI,CAAC,WAAW,aAAa,GAAG;AAC9B,sBAAc,eAAe,kFAAkF,OAAO;AAAA,MACxH;AAEA,cAAQ,QAAQ,8BAA8B;AAG9C,cAAQ,IAAI,OAAO,MAAM,KAAK,aAAa,CAAC;AAC5C,cAAQ,IAAI,MAAM,KAAK,2BAA2B,IAAI,MAAM,MAAM,cAAc,CAAC;AACjF,cAAQ,IAAI,MAAM,KAAK,2BAA2B,IAAI,MAAM,MAAM,UAAU,CAAC;AAC7E,cAAQ,IAAI,MAAM,KAAK,2BAA2B,IAAI,MAAM,MAAM,kBAAkB,CAAC;AACrF,cAAQ,IAAI,MAAM,KAAK,8BAA8B,IAAI,MAAM,MAAM,SAAS,CAAC;AAC/E,cAAQ,IAAA;AAAA,IAEV,SAAS,OAAO;AACd,cAAQ,KAAK,sCAAsC;AACnD,cAAQ,MAAM,MAAM,IAAI,OAAO,KAAK,CAAC,CAAC;AACtC,cAAQ,KAAK,CAAC;AAAA,IAChB;AAAA,EACF,CAAC;AAEH,SAAO;AACT;"}