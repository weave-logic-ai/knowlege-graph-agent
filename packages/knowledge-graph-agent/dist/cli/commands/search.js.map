{"version":3,"file":"search.js","sources":["../../../src/cli/commands/search.ts"],"sourcesContent":["/**\n * Search Command\n *\n * Search the knowledge graph.\n */\n\nimport { Command } from 'commander';\nimport chalk from 'chalk';\nimport { existsSync } from 'fs';\nimport { join } from 'path';\nimport { createDatabase } from '../../core/database.js';\nimport { validateProjectRoot } from '../../core/security.js';\n\n/**\n * Create search command\n */\nexport function createSearchCommand(): Command {\n  const command = new Command('search');\n\n  command\n    .description('Search the knowledge graph')\n    .argument('<query>', 'Search query')\n    .option('-p, --path <path>', 'Project root path', '.')\n    .option('-t, --type <type>', 'Filter by node type')\n    .option('-g, --tag <tag>', 'Filter by tag')\n    .option('-l, --limit <number>', 'Limit results', '20')\n    .option('--json', 'Output as JSON')\n    .action(async (query, options) => {\n      try {\n        // Validate path to prevent traversal attacks\n        const projectRoot = validateProjectRoot(options.path);\n        const dbPath = join(projectRoot, '.kg', 'knowledge.db');\n\n        // Check if database exists\n        if (!existsSync(dbPath)) {\n          console.log(chalk.yellow('  Knowledge graph not found'));\n          console.log(chalk.gray('  Run ') + chalk.cyan('kg graph') + chalk.gray(' to generate one'));\n          return;\n        }\n\n        const db = createDatabase(dbPath);\n        const limit = parseInt(options.limit, 10);\n\n        let results;\n\n        if (options.tag) {\n          // Search by tag\n          results = db.getNodesByTag(options.tag);\n        } else if (options.type) {\n          // Search by type\n          results = db.getNodesByType(options.type);\n        } else {\n          // Full-text search\n          results = db.searchNodes(query, limit);\n        }\n\n        // Apply additional filters\n        if (options.type && !options.tag) {\n          results = results.filter(n => n.type === options.type);\n        }\n\n        // Limit results\n        results = results.slice(0, limit);\n\n        if (options.json) {\n          console.log(JSON.stringify(results.map(n => ({\n            id: n.id,\n            title: n.title,\n            type: n.type,\n            status: n.status,\n            path: n.path,\n            tags: n.tags,\n          })), null, 2));\n          db.close();\n          return;\n        }\n\n        console.log(chalk.cyan(`\\n  Search Results for \"${query}\"\\n`));\n\n        if (results.length === 0) {\n          console.log(chalk.gray('  No results found'));\n          db.close();\n          return;\n        }\n\n        console.log(chalk.gray(`  Found ${results.length} result${results.length === 1 ? '' : 's'}\\n`));\n\n        results.forEach((node, i) => {\n          const statusColor = node.status === 'active' ? chalk.green :\n                             node.status === 'draft' ? chalk.yellow :\n                             node.status === 'deprecated' ? chalk.red : chalk.gray;\n\n          console.log(chalk.white(`  ${i + 1}. ${node.title}`));\n          console.log(chalk.gray(`     Type: ${node.type} | Status: `) + statusColor(node.status));\n          console.log(chalk.gray(`     Path: ${node.path}`));\n\n          if (node.tags.length > 0) {\n            console.log(chalk.gray('     Tags: ') + chalk.blue(node.tags.join(', ')));\n          }\n\n          // Show connections\n          const incoming = node.incomingLinks.length;\n          const outgoing = node.outgoingLinks.length;\n          if (incoming > 0 || outgoing > 0) {\n            console.log(chalk.gray(`     Links: ${incoming} incoming, ${outgoing} outgoing`));\n          }\n\n          console.log();\n        });\n\n        db.close();\n\n      } catch (error) {\n        console.error(chalk.red('Search failed:'), String(error));\n        process.exit(1);\n      }\n    });\n\n  return command;\n}\n"],"names":[],"mappings":"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"}