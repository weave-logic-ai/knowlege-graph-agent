{"version":3,"file":"stats.js","sources":["../../../src/cli/commands/stats.ts"],"sourcesContent":["/**\n * Stats Command\n *\n * Display knowledge graph statistics.\n */\n\nimport { Command } from 'commander';\nimport chalk from 'chalk';\nimport { existsSync } from 'fs';\nimport { join } from 'path';\nimport { createDatabase } from '../../core/database.js';\nimport { validateProjectRoot } from '../../core/security.js';\n\n/**\n * Create stats command\n */\nexport function createStatsCommand(): Command {\n  const command = new Command('stats');\n\n  command\n    .description('Display knowledge graph statistics')\n    .option('-p, --path <path>', 'Project root path', '.')\n    .option('--json', 'Output as JSON')\n    .action(async (options) => {\n      try {\n        // Validate path to prevent traversal attacks\n        const projectRoot = validateProjectRoot(options.path);\n        const dbPath = join(projectRoot, '.kg', 'knowledge.db');\n\n        // Check if database exists\n        if (!existsSync(dbPath)) {\n          console.log(chalk.yellow('  Knowledge graph not found'));\n          console.log(chalk.gray('  Run ') + chalk.cyan('kg graph') + chalk.gray(' to generate one'));\n          return;\n        }\n\n        const db = createDatabase(dbPath);\n        const stats = db.getStats();\n        const metadata = {\n          version: db.getMetadata('version'),\n          lastGenerated: db.getMetadata('lastGenerated'),\n          lastUpdated: db.getMetadata('lastUpdated'),\n        };\n\n        if (options.json) {\n          console.log(JSON.stringify({ stats, metadata }, null, 2));\n          db.close();\n          return;\n        }\n\n        console.log(chalk.cyan('\\n  Knowledge Graph Statistics\\n'));\n\n        // Overview\n        console.log(chalk.white('  Overview'));\n        console.log(chalk.gray(`    Total nodes:  ${stats.totalNodes}`));\n        console.log(chalk.gray(`    Total edges:  ${stats.totalEdges}`));\n        console.log(chalk.gray(`    Orphan nodes: ${stats.orphanNodes}`));\n        console.log(chalk.gray(`    Avg links:    ${stats.avgLinksPerNode}/node`));\n\n        // Nodes by type\n        console.log();\n        console.log(chalk.white('  Nodes by Type'));\n        Object.entries(stats.nodesByType).forEach(([type, count]) => {\n          if (count > 0) {\n            const bar = 'â–ˆ'.repeat(Math.min(count, 20));\n            console.log(chalk.gray(`    ${type.padEnd(12)} ${String(count).padStart(4)} ${chalk.blue(bar)}`));\n          }\n        });\n\n        // Nodes by status\n        console.log();\n        console.log(chalk.white('  Nodes by Status'));\n        Object.entries(stats.nodesByStatus).forEach(([status, count]) => {\n          if (count > 0) {\n            const color = status === 'active' ? chalk.green :\n                         status === 'draft' ? chalk.yellow :\n                         status === 'deprecated' ? chalk.red : chalk.gray;\n            console.log(color(`    ${status.padEnd(12)} ${count}`));\n          }\n        });\n\n        // Most connected\n        if (stats.mostConnected.length > 0) {\n          console.log();\n          console.log(chalk.white('  Most Connected Nodes'));\n          stats.mostConnected.forEach(({ id, connections }, i) => {\n            console.log(chalk.gray(`    ${i + 1}. ${id} (${connections} connections)`));\n          });\n        }\n\n        // Metadata\n        if (metadata.lastGenerated || metadata.lastUpdated) {\n          console.log();\n          console.log(chalk.white('  Metadata'));\n          if (metadata.version) {\n            console.log(chalk.gray(`    Version:       ${metadata.version}`));\n          }\n          if (metadata.lastGenerated) {\n            console.log(chalk.gray(`    Generated:     ${metadata.lastGenerated}`));\n          }\n          if (metadata.lastUpdated) {\n            console.log(chalk.gray(`    Last updated:  ${metadata.lastUpdated}`));\n          }\n        }\n\n        db.close();\n        console.log();\n\n      } catch (error) {\n        console.error(chalk.red('Failed to get stats:'), String(error));\n        process.exit(1);\n      }\n    });\n\n  return command;\n}\n"],"names":[],"mappings":"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"}