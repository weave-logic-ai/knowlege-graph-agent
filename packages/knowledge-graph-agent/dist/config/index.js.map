{"version":3,"file":"index.js","sources":["../../src/config/index.ts"],"sourcesContent":["/**\n * Configuration Module\n *\n * Provides configuration management with validation, migrations, and defaults.\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Database configuration\n */\nexport interface DatabaseConfig {\n  /** Path to database file */\n  path: string;\n  /** Enable WAL mode */\n  walMode?: boolean;\n  /** Busy timeout in milliseconds */\n  busyTimeout?: number;\n  /** Cache size in pages */\n  cacheSize?: number;\n}\n\n/**\n * Cache configuration\n */\nexport interface CacheConfig {\n  /** Enable caching */\n  enabled: boolean;\n  /** Maximum cache size in bytes */\n  maxSize?: number;\n  /** Default TTL in milliseconds */\n  defaultTtl?: number;\n  /** Eviction policy */\n  evictionPolicy?: 'lru' | 'lfu' | 'fifo';\n}\n\n/**\n * Agent configuration\n */\nexport interface AgentConfig {\n  /** Maximum concurrent agents */\n  maxConcurrent?: number;\n  /** Default timeout in milliseconds */\n  defaultTimeout?: number;\n  /** Enable agent logging */\n  enableLogging?: boolean;\n}\n\n/**\n * Services configuration\n */\nexport interface ServicesConfig {\n  /** Enable file watcher */\n  fileWatcher?: boolean;\n  /** File watcher paths */\n  watchPaths?: string[];\n  /** Health check interval in milliseconds */\n  healthCheckInterval?: number;\n}\n\n/**\n * Logging configuration\n */\nexport interface LoggingConfig {\n  /** Log level */\n  level: 'debug' | 'info' | 'warn' | 'error';\n  /** Log format */\n  format?: 'json' | 'text';\n  /** Log file path */\n  filePath?: string;\n  /** Enable console logging */\n  console?: boolean;\n}\n\n/**\n * Full knowledge graph configuration\n */\nexport interface KGConfiguration {\n  /** Database settings */\n  database: DatabaseConfig;\n  /** Cache settings */\n  cache?: CacheConfig;\n  /** Agent settings */\n  agents?: AgentConfig;\n  /** Services settings */\n  services?: ServicesConfig;\n  /** Logging settings */\n  logging?: LoggingConfig;\n  /** Project root path */\n  projectRoot?: string;\n  /** Docs path relative to project root */\n  docsPath?: string;\n}\n\n/**\n * Configuration migration\n */\nexport interface ConfigMigration {\n  /** Migration version */\n  version: number;\n  /** Migration description */\n  description: string;\n  /** Migration function */\n  migrate: (config: Partial<KGConfiguration>) => KGConfiguration;\n}\n\n// ============================================================================\n// Default Configuration\n// ============================================================================\n\n/**\n * Get default configuration\n */\nexport function getDefaultConfig(): KGConfiguration {\n  return {\n    database: {\n      path: '.kg/knowledge.db',\n      walMode: true,\n      busyTimeout: 5000,\n      cacheSize: 2000,\n    },\n    cache: {\n      enabled: true,\n      maxSize: 100 * 1024 * 1024, // 100MB\n      defaultTtl: 3600000, // 1 hour\n      evictionPolicy: 'lru',\n    },\n    agents: {\n      maxConcurrent: 5,\n      defaultTimeout: 30000,\n      enableLogging: true,\n    },\n    services: {\n      fileWatcher: true,\n      watchPaths: ['docs', 'src'],\n      healthCheckInterval: 60000,\n    },\n    logging: {\n      level: 'info',\n      format: 'text',\n      console: true,\n    },\n    docsPath: 'docs',\n  };\n}\n\n// ============================================================================\n// Configuration Manager\n// ============================================================================\n\n/**\n * Configuration Manager for loading, saving, and managing configuration\n */\nexport class ConfigManager {\n  private config: KGConfiguration;\n  private configPath: string;\n  private migrations: ConfigMigration[] = [];\n\n  constructor(configPath?: string) {\n    this.configPath = configPath || '.kg/config.json';\n    this.config = getDefaultConfig();\n  }\n\n  /**\n   * Load configuration from file\n   */\n  async load(): Promise<KGConfiguration> {\n    try {\n      const { readFileSync, existsSync } = await import('fs');\n      if (existsSync(this.configPath)) {\n        const content = readFileSync(this.configPath, 'utf-8');\n        const loaded = JSON.parse(content) as Partial<KGConfiguration>;\n        this.config = this.merge(getDefaultConfig(), loaded);\n      }\n    } catch {\n      // Use defaults on error\n    }\n    return this.config;\n  }\n\n  /**\n   * Save configuration to file\n   */\n  async save(): Promise<void> {\n    const { writeFileSync, mkdirSync } = await import('fs');\n    const { dirname } = await import('path');\n\n    mkdirSync(dirname(this.configPath), { recursive: true });\n    writeFileSync(this.configPath, JSON.stringify(this.config, null, 2));\n  }\n\n  /**\n   * Get current configuration\n   */\n  get(): KGConfiguration {\n    return { ...this.config };\n  }\n\n  /**\n   * Update configuration\n   */\n  update(updates: Partial<KGConfiguration>): KGConfiguration {\n    this.config = this.merge(this.config, updates);\n    return this.config;\n  }\n\n  /**\n   * Reset to defaults\n   */\n  reset(): KGConfiguration {\n    this.config = getDefaultConfig();\n    return this.config;\n  }\n\n  /**\n   * Validate configuration\n   */\n  validate(): { valid: boolean; errors: string[] } {\n    const errors: string[] = [];\n\n    if (!this.config.database?.path) {\n      errors.push('Database path is required');\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors,\n    };\n  }\n\n  /**\n   * Register a migration\n   */\n  registerMigration(migration: ConfigMigration): void {\n    this.migrations.push(migration);\n    this.migrations.sort((a, b) => a.version - b.version);\n  }\n\n  /**\n   * Apply migrations\n   */\n  applyMigrations(fromVersion: number): KGConfiguration {\n    for (const migration of this.migrations) {\n      if (migration.version > fromVersion) {\n        this.config = migration.migrate(this.config);\n      }\n    }\n    return this.config;\n  }\n\n  /**\n   * Merge configurations\n   */\n  private merge(\n    base: KGConfiguration,\n    updates: Partial<KGConfiguration>\n  ): KGConfiguration {\n    return {\n      ...base,\n      ...updates,\n      database: { ...base.database, ...updates.database },\n      cache: updates.cache ? { ...base.cache, ...updates.cache } : base.cache,\n      agents: updates.agents ? { ...base.agents, ...updates.agents } : base.agents,\n      services: updates.services ? { ...base.services, ...updates.services } : base.services,\n      logging: updates.logging ? { ...base.logging, ...updates.logging } : base.logging,\n    };\n  }\n}\n\n/**\n * Create a new ConfigManager instance\n */\nexport function createConfigManager(configPath?: string): ConfigManager {\n  return new ConfigManager(configPath);\n}\n"],"names":[],"mappings":"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"}