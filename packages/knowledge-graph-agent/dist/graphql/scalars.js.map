{"version":3,"file":"scalars.js","sources":["../../src/graphql/scalars.ts"],"sourcesContent":["/**\n * GraphQL Custom Scalars\n *\n * Provides custom scalar type definitions for DateTime, JSON, and UUID types.\n * These scalars enable proper serialization/deserialization of complex data types\n * in the GraphQL schema.\n *\n * @module graphql/scalars\n */\n\nimport { GraphQLScalarType, Kind, ValueNode } from 'graphql';\n\n/**\n * DateTime scalar for ISO 8601 date-time values\n *\n * Serializes Date objects to ISO strings and parses ISO strings to Date objects.\n *\n * @example\n * ```graphql\n * scalar DateTime\n *\n * type Node {\n *   createdAt: DateTime!\n *   updatedAt: DateTime\n * }\n * ```\n */\nexport const DateTimeScalar = new GraphQLScalarType<Date | null, string | null>({\n  name: 'DateTime',\n  description: 'ISO 8601 date-time string (e.g., 2024-01-15T10:30:00.000Z)',\n\n  serialize(value: unknown): string | null {\n    if (value === null || value === undefined) {\n      return null;\n    }\n\n    if (value instanceof Date) {\n      if (Number.isNaN(value.getTime())) {\n        throw new TypeError('DateTime cannot serialize an invalid Date');\n      }\n      return value.toISOString();\n    }\n\n    if (typeof value === 'string') {\n      const date = new Date(value);\n      if (Number.isNaN(date.getTime())) {\n        throw new TypeError(`DateTime cannot serialize invalid date string: ${value}`);\n      }\n      return date.toISOString();\n    }\n\n    if (typeof value === 'number') {\n      const date = new Date(value);\n      if (Number.isNaN(date.getTime())) {\n        throw new TypeError(`DateTime cannot serialize invalid timestamp: ${value}`);\n      }\n      return date.toISOString();\n    }\n\n    throw new TypeError(\n      `DateTime cannot serialize non-date value: ${typeof value}`\n    );\n  },\n\n  parseValue(value: unknown): Date | null {\n    if (value === null || value === undefined) {\n      return null;\n    }\n\n    if (value instanceof Date) {\n      return value;\n    }\n\n    if (typeof value === 'string') {\n      const date = new Date(value);\n      if (Number.isNaN(date.getTime())) {\n        throw new TypeError(`DateTime cannot parse invalid date string: ${value}`);\n      }\n      return date;\n    }\n\n    if (typeof value === 'number') {\n      const date = new Date(value);\n      if (Number.isNaN(date.getTime())) {\n        throw new TypeError(`DateTime cannot parse invalid timestamp: ${value}`);\n      }\n      return date;\n    }\n\n    throw new TypeError(\n      `DateTime cannot parse non-string/non-number value: ${typeof value}`\n    );\n  },\n\n  parseLiteral(ast: ValueNode): Date | null {\n    if (ast.kind === Kind.NULL) {\n      return null;\n    }\n\n    if (ast.kind === Kind.STRING) {\n      const date = new Date(ast.value);\n      if (Number.isNaN(date.getTime())) {\n        throw new TypeError(`DateTime cannot parse invalid date literal: ${ast.value}`);\n      }\n      return date;\n    }\n\n    if (ast.kind === Kind.INT) {\n      const date = new Date(parseInt(ast.value, 10));\n      if (Number.isNaN(date.getTime())) {\n        throw new TypeError(`DateTime cannot parse invalid timestamp literal: ${ast.value}`);\n      }\n      return date;\n    }\n\n    throw new TypeError(`DateTime cannot parse literal of kind: ${ast.kind}`);\n  },\n});\n\n/**\n * JSON scalar for arbitrary JSON data\n *\n * Serializes and parses arbitrary JSON values including objects, arrays,\n * strings, numbers, booleans, and null.\n *\n * @example\n * ```graphql\n * scalar JSON\n *\n * type Node {\n *   metadata: JSON\n *   config: JSON\n * }\n * ```\n */\nexport const JSONScalar = new GraphQLScalarType<unknown, unknown>({\n  name: 'JSON',\n  description: 'Arbitrary JSON value (object, array, string, number, boolean, or null)',\n\n  serialize(value: unknown): unknown {\n    return value;\n  },\n\n  parseValue(value: unknown): unknown {\n    return value;\n  },\n\n  parseLiteral(ast: ValueNode, variables?: Record<string, unknown> | null): unknown {\n    return parseLiteralToJSON(ast, variables ?? undefined);\n  },\n});\n\n/**\n * Parse a GraphQL literal AST node to a JSON value\n */\nfunction parseLiteralToJSON(\n  ast: ValueNode,\n  variables?: Record<string, unknown>\n): unknown {\n  switch (ast.kind) {\n    case Kind.NULL:\n      return null;\n\n    case Kind.STRING:\n      return ast.value;\n\n    case Kind.INT:\n      return parseInt(ast.value, 10);\n\n    case Kind.FLOAT:\n      return parseFloat(ast.value);\n\n    case Kind.BOOLEAN:\n      return ast.value;\n\n    case Kind.LIST:\n      return ast.values.map((value) => parseLiteralToJSON(value, variables));\n\n    case Kind.OBJECT: {\n      const obj: Record<string, unknown> = {};\n      for (const field of ast.fields) {\n        obj[field.name.value] = parseLiteralToJSON(field.value, variables);\n      }\n      return obj;\n    }\n\n    case Kind.VARIABLE: {\n      const name = ast.name.value;\n      return variables ? variables[name] : undefined;\n    }\n\n    default:\n      throw new TypeError(`JSON cannot parse literal of kind: ${(ast as ValueNode).kind}`);\n  }\n}\n\n/**\n * UUID v4 regex pattern for validation\n */\nconst UUID_REGEX = /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\n\n/**\n * UUID scalar for unique identifiers\n *\n * Validates and serializes UUID v4 strings.\n *\n * @example\n * ```graphql\n * scalar UUID\n *\n * type Node {\n *   id: UUID!\n *   parentId: UUID\n * }\n * ```\n */\nexport const UUIDScalar = new GraphQLScalarType<string | null, string | null>({\n  name: 'UUID',\n  description: 'UUID v4 string (e.g., 550e8400-e29b-41d4-a716-446655440000)',\n\n  serialize(value: unknown): string | null {\n    if (value === null || value === undefined) {\n      return null;\n    }\n\n    if (typeof value !== 'string') {\n      throw new TypeError(`UUID cannot serialize non-string value: ${typeof value}`);\n    }\n\n    if (!UUID_REGEX.test(value)) {\n      throw new TypeError(`UUID cannot serialize invalid UUID: ${value}`);\n    }\n\n    return value.toLowerCase();\n  },\n\n  parseValue(value: unknown): string | null {\n    if (value === null || value === undefined) {\n      return null;\n    }\n\n    if (typeof value !== 'string') {\n      throw new TypeError(`UUID cannot parse non-string value: ${typeof value}`);\n    }\n\n    if (!UUID_REGEX.test(value)) {\n      throw new TypeError(`UUID cannot parse invalid UUID: ${value}`);\n    }\n\n    return value.toLowerCase();\n  },\n\n  parseLiteral(ast: ValueNode): string | null {\n    if (ast.kind === Kind.NULL) {\n      return null;\n    }\n\n    if (ast.kind !== Kind.STRING) {\n      throw new TypeError(`UUID cannot parse literal of kind: ${ast.kind}`);\n    }\n\n    if (!UUID_REGEX.test(ast.value)) {\n      throw new TypeError(`UUID cannot parse invalid UUID literal: ${ast.value}`);\n    }\n\n    return ast.value.toLowerCase();\n  },\n});\n\n/**\n * FilePath scalar for file system paths\n *\n * Validates and normalizes file paths, preventing path traversal attacks.\n *\n * @example\n * ```graphql\n * scalar FilePath\n *\n * type Node {\n *   path: FilePath!\n * }\n * ```\n */\nexport const FilePathScalar = new GraphQLScalarType<string | null, string | null>({\n  name: 'FilePath',\n  description: 'File system path (relative to docs root)',\n\n  serialize(value: unknown): string | null {\n    if (value === null || value === undefined) {\n      return null;\n    }\n\n    if (typeof value !== 'string') {\n      throw new TypeError(`FilePath cannot serialize non-string value: ${typeof value}`);\n    }\n\n    return normalizePath(value);\n  },\n\n  parseValue(value: unknown): string | null {\n    if (value === null || value === undefined) {\n      return null;\n    }\n\n    if (typeof value !== 'string') {\n      throw new TypeError(`FilePath cannot parse non-string value: ${typeof value}`);\n    }\n\n    return validateAndNormalizePath(value);\n  },\n\n  parseLiteral(ast: ValueNode): string | null {\n    if (ast.kind === Kind.NULL) {\n      return null;\n    }\n\n    if (ast.kind !== Kind.STRING) {\n      throw new TypeError(`FilePath cannot parse literal of kind: ${ast.kind}`);\n    }\n\n    return validateAndNormalizePath(ast.value);\n  },\n});\n\n/**\n * Normalize a file path (forward slashes, no double slashes)\n */\nfunction normalizePath(path: string): string {\n  return path\n    .replace(/\\\\/g, '/') // Convert backslashes to forward slashes\n    .replace(/\\/+/g, '/') // Remove duplicate slashes\n    .replace(/^\\//, '') // Remove leading slash\n    .replace(/\\/$/, ''); // Remove trailing slash\n}\n\n/**\n * Validate and normalize a file path, rejecting path traversal attempts\n */\nfunction validateAndNormalizePath(path: string): string {\n  const normalized = normalizePath(path);\n\n  // Reject path traversal attempts\n  if (normalized.includes('..') || normalized.startsWith('/')) {\n    throw new TypeError(`FilePath cannot contain path traversal: ${path}`);\n  }\n\n  // Reject null bytes and other potentially dangerous characters\n  if (/[\\x00-\\x1f]/.test(normalized)) {\n    throw new TypeError(`FilePath contains invalid characters: ${path}`);\n  }\n\n  return normalized;\n}\n\n/**\n * All custom scalars bundled for resolver integration\n */\nexport const customScalars = {\n  DateTime: DateTimeScalar,\n  JSON: JSONScalar,\n  UUID: UUIDScalar,\n  FilePath: FilePathScalar,\n};\n\n/**\n * Type definitions string for custom scalars\n * (Useful if not loading from .graphql file)\n */\nexport const scalarTypeDefs = `\n  \"\"\"\n  ISO 8601 date-time string (e.g., 2024-01-15T10:30:00.000Z)\n  \"\"\"\n  scalar DateTime\n\n  \"\"\"\n  Arbitrary JSON value (object, array, string, number, boolean, or null)\n  \"\"\"\n  scalar JSON\n\n  \"\"\"\n  UUID v4 string (e.g., 550e8400-e29b-41d4-a716-446655440000)\n  \"\"\"\n  scalar UUID\n\n  \"\"\"\n  File system path (relative to docs root)\n  \"\"\"\n  scalar FilePath\n`;\n"],"names":[],"mappings":"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"}