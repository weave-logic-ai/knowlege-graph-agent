{"version":3,"file":"registry.js","sources":["../../../src/mcp-server/tools/registry.ts"],"sourcesContent":["/**\n * Tool Registry\n *\n * Central registry for all MCP tools. Manages tool definitions and handlers.\n *\n * @module mcp-server/tools/registry\n */\n\nimport type { Tool } from '@modelcontextprotocol/sdk/types.js';\nimport type { ToolHandler, ToolHandlerEntry, ToolCategory } from '../types/index.js';\nimport { createLogger } from '../../utils/index.js';\nimport type { KnowledgeGraphDatabase } from '../../core/database.js';\nimport type { ShadowCache } from '../../core/cache.js';\n\nconst logger = createLogger('tool-registry');\n\n/**\n * Registry of all registered tools\n */\nconst toolRegistry: Map<string, ToolHandlerEntry> = new Map();\n\n/**\n * Tool categories for organization\n */\nconst toolCategories: Map<string, ToolCategory> = new Map();\n\n/**\n * Shared context for tool handlers\n */\nlet sharedDatabase: KnowledgeGraphDatabase | undefined;\nlet sharedCache: ShadowCache | undefined;\nlet sharedProjectRoot: string | undefined;\n\n/**\n * Initialize tools with dependencies\n *\n * @param database - Knowledge graph database instance\n * @param cache - Shadow cache instance\n * @param projectRoot - Project root path\n */\nexport async function initializeTools(\n  database?: KnowledgeGraphDatabase,\n  cache?: ShadowCache,\n  projectRoot?: string\n): Promise<void> {\n  sharedDatabase = database;\n  sharedCache = cache;\n  sharedProjectRoot = projectRoot;\n\n  logger.info('Initializing tool registry', {\n    hasDatabase: !!database,\n    hasCache: !!cache,\n    projectRoot,\n  });\n\n  // Register core tools\n  await registerCoreTools();\n\n  logger.info(`Tool registry initialized with ${toolRegistry.size} tools`);\n}\n\n/**\n * Get shared database instance\n */\nexport function getDatabase(): KnowledgeGraphDatabase | undefined {\n  return sharedDatabase;\n}\n\n/**\n * Get shared cache instance\n */\nexport function getCache(): ShadowCache | undefined {\n  return sharedCache;\n}\n\n/**\n * Get shared project root\n */\nexport function getProjectRoot(): string | undefined {\n  return sharedProjectRoot;\n}\n\n/**\n * Register a tool with its handler\n *\n * @param name - Tool name\n * @param definition - Tool definition\n * @param handler - Tool handler function\n * @param category - Optional category name\n */\nexport function registerTool(\n  name: string,\n  definition: Tool,\n  handler: ToolHandler,\n  category?: string\n): void {\n  if (toolRegistry.has(name)) {\n    logger.warn(`Tool ${name} already registered, overwriting`);\n  }\n\n  toolRegistry.set(name, { definition, handler });\n\n  // Add to category if specified\n  if (category) {\n    let cat = toolCategories.get(category);\n    if (!cat) {\n      cat = { name: category, description: '', tools: [] };\n      toolCategories.set(category, cat);\n    }\n    cat.tools.push(definition);\n  }\n\n  logger.debug(`Registered tool: ${name}`, { category });\n}\n\n/**\n * Get tool handler by name\n *\n * @param name - Tool name\n * @returns Tool handler or undefined\n */\nexport function getToolHandler(name: string): ToolHandler | undefined {\n  const entry = toolRegistry.get(name);\n  return entry?.handler;\n}\n\n/**\n * Get tool definition by name\n *\n * @param name - Tool name\n * @returns Tool definition or undefined\n */\nexport function getToolDefinition(name: string): Tool | undefined {\n  const entry = toolRegistry.get(name);\n  return entry?.definition;\n}\n\n/**\n * Get all tool definitions\n *\n * @returns Array of all tool definitions\n */\nexport function getToolDefinitions(): Tool[] {\n  return Array.from(toolRegistry.values()).map(entry => entry.definition);\n}\n\n/**\n * Get all tool categories\n *\n * @returns Array of tool categories\n */\nexport function getToolCategories(): ToolCategory[] {\n  return Array.from(toolCategories.values());\n}\n\n/**\n * Check if a tool is registered\n *\n * @param name - Tool name\n * @returns true if tool is registered\n */\nexport function hasToolRegistered(name: string): boolean {\n  return toolRegistry.has(name);\n}\n\n/**\n * Get count of registered tools\n *\n * @returns Number of registered tools\n */\nexport function getToolCount(): number {\n  return toolRegistry.size;\n}\n\n/**\n * Clear all registered tools (for testing)\n */\nexport function clearRegistry(): void {\n  toolRegistry.clear();\n  toolCategories.clear();\n  logger.debug('Tool registry cleared');\n}\n\n/**\n * Get the tool registry Map\n *\n * @returns The tool registry Map\n */\nexport function getToolRegistry(): Map<string, ToolHandlerEntry> {\n  return toolRegistry;\n}\n\n/**\n * Register core knowledge graph tools\n */\nasync function registerCoreTools(): Promise<void> {\n  // Graph Query Tool\n  registerTool(\n    'kg_query',\n    {\n      name: 'kg_query',\n      description: 'Query the knowledge graph for nodes matching criteria',\n      inputSchema: {\n        type: 'object',\n        properties: {\n          query: {\n            type: 'string',\n            description: 'Search query string',\n          },\n          type: {\n            type: 'string',\n            description: 'Filter by node type',\n            enum: ['concept', 'technical', 'feature', 'primitive', 'service', 'guide', 'standard', 'integration'],\n          },\n          status: {\n            type: 'string',\n            description: 'Filter by node status',\n            enum: ['draft', 'active', 'deprecated', 'archived'],\n          },\n          tag: {\n            type: 'string',\n            description: 'Filter by tag',\n          },\n          limit: {\n            type: 'number',\n            description: 'Maximum results to return',\n            default: 50,\n          },\n          includeContent: {\n            type: 'boolean',\n            description: 'Include full content in results',\n            default: false,\n          },\n        },\n      },\n    },\n    async (params) => {\n      const db = getDatabase();\n      if (!db) {\n        return { success: false, error: 'Database not initialized' };\n      }\n\n      try {\n        let nodes;\n        const limit = (params.limit as number) || 50;\n        const includeContent = params.includeContent as boolean;\n\n        if (params.query) {\n          nodes = db.searchNodes(params.query as string, limit);\n        } else if (params.type) {\n          nodes = db.getNodesByType(params.type as any).slice(0, limit);\n        } else if (params.status) {\n          nodes = db.getNodesByStatus(params.status as any).slice(0, limit);\n        } else if (params.tag) {\n          nodes = db.getNodesByTag(params.tag as string).slice(0, limit);\n        } else {\n          nodes = db.getAllNodes().slice(0, limit);\n        }\n\n        const results = nodes.map(node => ({\n          id: node.id,\n          path: node.path,\n          title: node.title,\n          type: node.type,\n          status: node.status,\n          tags: node.tags,\n          wordCount: node.wordCount,\n          outgoingLinkCount: node.outgoingLinks.length,\n          incomingLinkCount: node.incomingLinks.length,\n          ...(includeContent ? { content: node.content } : {}),\n        }));\n\n        return {\n          success: true,\n          data: results,\n          metadata: { itemCount: results.length },\n        };\n      } catch (error) {\n        return {\n          success: false,\n          error: error instanceof Error ? error.message : String(error),\n        };\n      }\n    },\n    'graph'\n  );\n\n  // Graph Stats Tool\n  registerTool(\n    'kg_stats',\n    {\n      name: 'kg_stats',\n      description: 'Get statistics about the knowledge graph',\n      inputSchema: {\n        type: 'object',\n        properties: {},\n      },\n    },\n    async () => {\n      const db = getDatabase();\n      if (!db) {\n        return { success: false, error: 'Database not initialized' };\n      }\n\n      try {\n        const stats = db.getStats();\n        return { success: true, data: stats };\n      } catch (error) {\n        return {\n          success: false,\n          error: error instanceof Error ? error.message : String(error),\n        };\n      }\n    },\n    'graph'\n  );\n\n  // Get Node Tool\n  registerTool(\n    'kg_get_node',\n    {\n      name: 'kg_get_node',\n      description: 'Get a specific node by ID or path',\n      inputSchema: {\n        type: 'object',\n        properties: {\n          id: {\n            type: 'string',\n            description: 'Node ID',\n          },\n          path: {\n            type: 'string',\n            description: 'Node path (alternative to ID)',\n          },\n        },\n      },\n    },\n    async (params) => {\n      const db = getDatabase();\n      if (!db) {\n        return { success: false, error: 'Database not initialized' };\n      }\n\n      try {\n        let node;\n        if (params.id) {\n          node = db.getNode(params.id as string);\n        } else if (params.path) {\n          node = db.getNodeByPath(params.path as string);\n        } else {\n          return { success: false, error: 'Either id or path required' };\n        }\n\n        if (!node) {\n          return { success: false, error: 'Node not found' };\n        }\n\n        return { success: true, data: node };\n      } catch (error) {\n        return {\n          success: false,\n          error: error instanceof Error ? error.message : String(error),\n        };\n      }\n    },\n    'graph'\n  );\n\n  // Cache Stats Tool\n  registerTool(\n    'kg_cache_stats',\n    {\n      name: 'kg_cache_stats',\n      description: 'Get cache statistics',\n      inputSchema: {\n        type: 'object',\n        properties: {},\n      },\n    },\n    async () => {\n      const cache = getCache();\n      if (!cache) {\n        return { success: false, error: 'Cache not initialized' };\n      }\n\n      try {\n        const stats = cache.getStats();\n        return { success: true, data: stats };\n      } catch (error) {\n        return {\n          success: false,\n          error: error instanceof Error ? error.message : String(error),\n        };\n      }\n    },\n    'cache'\n  );\n\n  // Health Check Tool\n  registerTool(\n    'kg_health',\n    {\n      name: 'kg_health',\n      description: 'Check health status of knowledge graph components',\n      inputSchema: {\n        type: 'object',\n        properties: {},\n      },\n    },\n    async () => {\n      const db = getDatabase();\n      const cache = getCache();\n\n      return {\n        success: true,\n        data: {\n          database: !!db,\n          cache: !!cache,\n          projectRoot: getProjectRoot() || null,\n          toolCount: getToolCount(),\n        },\n      };\n    },\n    'system'\n  );\n\n  // List Tags Tool\n  registerTool(\n    'kg_list_tags',\n    {\n      name: 'kg_list_tags',\n      description: 'List all tags with their usage counts',\n      inputSchema: {\n        type: 'object',\n        properties: {\n          limit: {\n            type: 'number',\n            description: 'Maximum tags to return',\n            default: 100,\n          },\n        },\n      },\n    },\n    async (params) => {\n      const db = getDatabase();\n      if (!db) {\n        return { success: false, error: 'Database not initialized' };\n      }\n\n      try {\n        const limit = (params.limit as number) || 100;\n        const tags = db.getAllTags().slice(0, limit);\n        return {\n          success: true,\n          data: tags,\n          metadata: { itemCount: tags.length },\n        };\n      } catch (error) {\n        return {\n          success: false,\n          error: error instanceof Error ? error.message : String(error),\n        };\n      }\n    },\n    'graph'\n  );\n\n  // Register agent tools\n  await registerAgentTools();\n\n  // Register workflow tools\n  await registerWorkflowTools();\n\n  // Register vector tools\n  await registerVectorTools();\n\n  // Register audit tools\n  await registerAuditTools();\n\n  logger.debug('Core tools registered');\n}\n\n/**\n * Register agent management tools\n */\nasync function registerAgentTools(): Promise<void> {\n  const { getRegistry: getAgentRegistry, AgentType, TaskPriority, createTaskId } = await import('../../agents/index.js');\n\n  // Agent Spawn Tool\n  registerTool(\n    'kg_agent_spawn',\n    {\n      name: 'kg_agent_spawn',\n      description: 'Spawn a specialized agent to perform a task',\n      inputSchema: {\n        type: 'object',\n        properties: {\n          type: {\n            type: 'string',\n            description: 'Agent type (researcher, coder, tester, analyst, architect)',\n            enum: ['researcher', 'coder', 'tester', 'analyst', 'architect'],\n          },\n          name: { type: 'string', description: 'Custom agent name (optional)' },\n          task: { type: 'string', description: 'Task for the agent to perform' },\n          options: {\n            type: 'object',\n            description: 'Agent-specific options',\n            properties: {\n              timeout: { type: 'number', description: 'Task timeout in ms' },\n              maxRetries: { type: 'number', description: 'Maximum retries' },\n              priority: {\n                type: 'string',\n                description: 'Task priority (low, medium, high, critical)',\n                enum: ['low', 'medium', 'high', 'critical'],\n              },\n            },\n          },\n        },\n        required: ['type', 'task'],\n      },\n    },\n    async (params) => {\n      const startTime = Date.now();\n      const { type, name, task, options = {} } = params || {};\n\n      if (!type || typeof type !== 'string') {\n        return {\n          success: false,\n          error: 'Agent type is required',\n          metadata: { executionTime: Date.now() - startTime },\n        };\n      }\n\n      if (!task || typeof task !== 'string') {\n        return {\n          success: false,\n          error: 'Task description is required',\n          metadata: { executionTime: Date.now() - startTime },\n        };\n      }\n\n      try {\n        const registry = getAgentRegistry();\n\n        // Map string type to AgentType enum\n        const typeMap: Record<string, typeof AgentType[keyof typeof AgentType]> = {\n          researcher: AgentType.RESEARCHER,\n          coder: AgentType.CODER,\n          tester: AgentType.TESTER,\n          analyst: AgentType.ANALYST,\n          architect: AgentType.ARCHITECT,\n        };\n        const agentType = typeMap[type.toLowerCase()] || AgentType.CUSTOM;\n\n        // Check if agent type is registered\n        if (!registry.isRegistered(agentType)) {\n          return {\n            success: false,\n            error: `Agent type '${type}' is not registered`,\n            metadata: { executionTime: Date.now() - startTime },\n          };\n        }\n\n        const typedOptions = options as { timeout?: number; maxRetries?: number; priority?: string };\n\n        // Spawn agent\n        const agent = await registry.spawn(agentType, {\n          name: typeof name === 'string' ? name : `${type}-agent`,\n          taskTimeout: typedOptions.timeout,\n          retry: typedOptions.maxRetries\n            ? { maxRetries: typedOptions.maxRetries, backoffMs: 1000 }\n            : undefined,\n        });\n\n        // Create and execute task\n        const priorityMap: Record<string, typeof TaskPriority[keyof typeof TaskPriority]> = {\n          low: TaskPriority.LOW,\n          medium: TaskPriority.MEDIUM,\n          high: TaskPriority.HIGH,\n          critical: TaskPriority.CRITICAL,\n        };\n\n        const agentTask = {\n          id: createTaskId(),\n          description: task,\n          priority: priorityMap[typedOptions.priority?.toLowerCase() || 'medium'] || TaskPriority.MEDIUM,\n          input: { data: { task }, context: {} },\n          createdAt: new Date(),\n        };\n\n        const result = await agent.execute(agentTask);\n\n        return {\n          success: result.success,\n          data: {\n            agentId: agent.config.id,\n            agentType: type,\n            agentName: agent.config.name,\n            taskId: agentTask.id,\n            taskResult: result.data,\n            metrics: result.metrics,\n          },\n          error: result.error?.message,\n          metadata: {\n            executionTime: Date.now() - startTime,\n            status: agent.getStatus(),\n          },\n        };\n      } catch (error) {\n        return {\n          success: false,\n          error: error instanceof Error ? error.message : String(error),\n          metadata: { executionTime: Date.now() - startTime },\n        };\n      }\n    },\n    'agents'\n  );\n\n  // Agent List Tool\n  registerTool(\n    'kg_agent_list',\n    {\n      name: 'kg_agent_list',\n      description: 'List all active agents and their status',\n      inputSchema: {\n        type: 'object',\n        properties: {\n          type: {\n            type: 'string',\n            description: 'Filter by agent type',\n            enum: ['researcher', 'coder', 'tester', 'analyst', 'architect', 'reviewer', 'coordinator', 'optimizer', 'documenter'],\n          },\n          status: {\n            type: 'string',\n            description: 'Filter by status',\n            enum: ['idle', 'running', 'completed', 'failed', 'paused', 'terminated'],\n          },\n        },\n      },\n    },\n    async (params) => {\n      const startTime = Date.now();\n      const { type, status } = params || {};\n\n      try {\n        const { getRegistry: getAgentRegistry, AgentType, AgentStatus } = await import('../../agents/index.js');\n        const registry = getAgentRegistry();\n\n        let agents = registry.listInstances();\n\n        // Filter by type\n        if (type && typeof type === 'string') {\n          const typeMap: Record<string, typeof AgentType[keyof typeof AgentType]> = {\n            researcher: AgentType.RESEARCHER,\n            coder: AgentType.CODER,\n            tester: AgentType.TESTER,\n            analyst: AgentType.ANALYST,\n            architect: AgentType.ARCHITECT,\n            reviewer: AgentType.REVIEWER,\n            coordinator: AgentType.COORDINATOR,\n            optimizer: AgentType.OPTIMIZER,\n            documenter: AgentType.DOCUMENTER,\n          };\n          const agentType = typeMap[type.toLowerCase()];\n          if (agentType) {\n            agents = agents.filter(a => a.type === agentType);\n          }\n        }\n\n        // Filter by status\n        if (status && typeof status === 'string') {\n          const statusMap: Record<string, typeof AgentStatus[keyof typeof AgentStatus]> = {\n            idle: AgentStatus.IDLE,\n            running: AgentStatus.RUNNING,\n            completed: AgentStatus.COMPLETED,\n            failed: AgentStatus.FAILED,\n            paused: AgentStatus.PAUSED,\n            terminated: AgentStatus.TERMINATED,\n          };\n          const agentStatus = statusMap[status.toLowerCase()];\n          if (agentStatus) {\n            agents = agents.filter(a => a.status === agentStatus);\n          }\n        }\n\n        const agentDetails = agents.map(agent => {\n          const instance = registry.get(agent.id);\n          return {\n            id: agent.id,\n            type: agent.type,\n            name: agent.name,\n            status: agent.status,\n            currentTask: instance?.state.currentTask?.id,\n            queuedTasks: instance?.state.taskQueue.length || 0,\n            completedTasks: instance?.state.completedTasks.length || 0,\n          };\n        });\n\n        const stats = registry.getStats();\n\n        return {\n          success: true,\n          data: {\n            agents: agentDetails,\n            count: agents.length,\n            stats: {\n              totalInstances: stats.totalInstances,\n              registeredTypes: stats.registeredTypes,\n            },\n          },\n          metadata: {\n            executionTime: Date.now() - startTime,\n          },\n        };\n      } catch (error) {\n        return {\n          success: false,\n          error: error instanceof Error ? error.message : String(error),\n          metadata: { executionTime: Date.now() - startTime },\n        };\n      }\n    },\n    'agents'\n  );\n\n  // Health Check Tool (enhanced)\n  registerTool(\n    'kg_health_check',\n    {\n      name: 'kg_health_check',\n      description: 'Check the health status of the knowledge graph server',\n      inputSchema: {\n        type: 'object',\n        properties: {\n          detailed: {\n            type: 'boolean',\n            description: 'Include detailed diagnostics',\n            default: false,\n          },\n          components: {\n            type: 'array',\n            description: 'Specific components to check (database, cache, agents, memory)',\n            items: {\n              type: 'string',\n              enum: ['database', 'cache', 'agents', 'memory'],\n            },\n          },\n        },\n      },\n    },\n    async (params) => {\n      const startTime = Date.now();\n      const { detailed = false, components: requestedComponents } = params || {};\n\n      try {\n        const db = getDatabase();\n        const cache = getCache();\n        const { getRegistry: getAgentRegistry } = await import('../../agents/index.js');\n\n        const checkComponents = (requestedComponents as string[]) || ['database', 'cache', 'agents', 'memory'];\n        const componentResults: Record<string, { status: string; message?: string; details?: Record<string, unknown> }> = {};\n\n        // Check database\n        if (checkComponents.includes('database')) {\n          if (!db) {\n            componentResults.database = { status: 'unhealthy', message: 'Database not configured' };\n          } else {\n            try {\n              const stats = db.getStats();\n              componentResults.database = {\n                status: 'healthy',\n                message: 'Database operational',\n                details: detailed ? { totalNodes: stats.totalNodes, totalEdges: stats.totalEdges } : undefined,\n              };\n            } catch (error) {\n              componentResults.database = { status: 'unhealthy', message: error instanceof Error ? error.message : 'Check failed' };\n            }\n          }\n        }\n\n        // Check cache\n        if (checkComponents.includes('cache')) {\n          if (!cache) {\n            componentResults.cache = { status: 'degraded', message: 'Cache not configured' };\n          } else {\n            try {\n              const stats = cache.getStats();\n              componentResults.cache = {\n                status: 'healthy',\n                message: 'Cache operational',\n                details: detailed ? { entries: stats.totalEntries, hitRate: stats.hitRate } : undefined,\n              };\n            } catch (error) {\n              componentResults.cache = { status: 'unhealthy', message: error instanceof Error ? error.message : 'Check failed' };\n            }\n          }\n        }\n\n        // Check agents\n        if (checkComponents.includes('agents')) {\n          try {\n            const agentRegistry = getAgentRegistry();\n            const stats = agentRegistry.getStats();\n            const failedCount = stats.instancesByStatus['failed'] || 0;\n\n            componentResults.agents = {\n              status: failedCount > 0 ? 'degraded' : 'healthy',\n              message: failedCount > 0 ? `${failedCount} agent(s) failed` : 'Agent system operational',\n              details: detailed ? { instances: stats.totalInstances, types: stats.registeredTypes } : undefined,\n            };\n          } catch (error) {\n            componentResults.agents = { status: 'unhealthy', message: error instanceof Error ? error.message : 'Check failed' };\n          }\n        }\n\n        // Check memory\n        if (checkComponents.includes('memory')) {\n          const memUsage = process.memoryUsage();\n          const heapUsageRatio = memUsage.heapUsed / memUsage.heapTotal;\n\n          componentResults.memory = {\n            status: heapUsageRatio > 0.9 ? 'unhealthy' : heapUsageRatio > 0.75 ? 'degraded' : 'healthy',\n            message: `Heap usage: ${Math.round(heapUsageRatio * 100)}%`,\n            details: detailed ? {\n              heapUsedMB: Math.round(memUsage.heapUsed / 1024 / 1024 * 100) / 100,\n              heapTotalMB: Math.round(memUsage.heapTotal / 1024 / 1024 * 100) / 100,\n            } : undefined,\n          };\n        }\n\n        // Determine overall status\n        const statuses = Object.values(componentResults).map(c => c.status);\n        const overallStatus = statuses.some(s => s === 'unhealthy') ? 'unhealthy'\n          : statuses.some(s => s === 'degraded') ? 'degraded' : 'healthy';\n\n        const health: Record<string, unknown> = {\n          status: overallStatus,\n          components: Object.fromEntries(\n            Object.entries(componentResults).map(([name, result]) => [\n              name,\n              detailed ? result : result.status,\n            ])\n          ),\n          timestamp: new Date().toISOString(),\n        };\n\n        if (detailed) {\n          Object.assign(health, {\n            uptime: process.uptime(),\n            nodeVersion: process.version,\n            platform: process.platform,\n          });\n        }\n\n        return {\n          success: true,\n          data: health,\n          metadata: { executionTime: Date.now() - startTime },\n        };\n      } catch (error) {\n        return {\n          success: false,\n          error: error instanceof Error ? error.message : String(error),\n          data: { status: 'unhealthy' },\n          metadata: { executionTime: Date.now() - startTime },\n        };\n      }\n    },\n    'system'\n  );\n\n  logger.debug('Agent tools registered');\n}\n\n/**\n * Register workflow management tools\n */\nasync function registerWorkflowTools(): Promise<void> {\n  const {\n    workflowStartTool,\n    createWorkflowStartHandler,\n    workflowStatusTool,\n    createWorkflowStatusHandler,\n    workflowListTool,\n    createWorkflowListHandler,\n  } = await import('./workflow/index.js');\n\n  registerTool(\n    workflowStartTool.name,\n    workflowStartTool,\n    createWorkflowStartHandler(),\n    'workflow'\n  );\n\n  registerTool(\n    workflowStatusTool.name,\n    workflowStatusTool,\n    createWorkflowStatusHandler(),\n    'workflow'\n  );\n\n  registerTool(\n    workflowListTool.name,\n    workflowListTool,\n    createWorkflowListHandler(),\n    'workflow'\n  );\n\n  logger.debug('Workflow tools registered');\n}\n\n/**\n * Register vector search and trajectory tools\n */\nasync function registerVectorTools(): Promise<void> {\n  const {\n    vectorSearchTool,\n    createVectorSearchHandler,\n    vectorUpsertTool,\n    createVectorUpsertHandler,\n    trajectoryListTool,\n    createTrajectoryListHandler,\n  } = await import('./vector/index.js');\n\n  registerTool(\n    vectorSearchTool.name,\n    vectorSearchTool,\n    createVectorSearchHandler(),\n    'vector'\n  );\n\n  registerTool(\n    vectorUpsertTool.name,\n    vectorUpsertTool,\n    createVectorUpsertHandler(),\n    'vector'\n  );\n\n  registerTool(\n    trajectoryListTool.name,\n    trajectoryListTool,\n    createTrajectoryListHandler(),\n    'vector'\n  );\n\n  logger.debug('Vector tools registered');\n}\n\n/**\n * Register audit and syndication tools\n */\nasync function registerAuditTools(): Promise<void> {\n  const {\n    auditQueryTool,\n    createAuditQueryHandler,\n    auditCheckpointTool,\n    createAuditCheckpointHandler,\n    syncStatusTool,\n    createSyncStatusHandler,\n  } = await import('./audit/index.js');\n\n  registerTool(\n    auditQueryTool.name,\n    auditQueryTool,\n    createAuditQueryHandler(),\n    'audit'\n  );\n\n  registerTool(\n    auditCheckpointTool.name,\n    auditCheckpointTool,\n    createAuditCheckpointHandler(),\n    'audit'\n  );\n\n  registerTool(\n    syncStatusTool.name,\n    syncStatusTool,\n    createSyncStatusHandler(),\n    'audit'\n  );\n\n  logger.debug('Audit tools registered');\n}\n"],"names":["getAgentRegistry","AgentType"],"mappings":"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"}