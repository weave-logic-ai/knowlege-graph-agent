{"version":3,"file":"start.js","sources":["../../../../src/mcp-server/tools/workflow/start.ts"],"sourcesContent":["/**\n * Workflow Start Tool\n *\n * MCP tool for starting a new workflow execution.\n * Integrates with the WorkflowService for workflow orchestration.\n *\n * @module mcp-server/tools/workflow/start\n */\n\nimport type { Tool } from '@modelcontextprotocol/sdk/types.js';\nimport type { ToolHandler, ToolResult } from '../../types/index.js';\nimport {\n  createWorkflowService,\n  type WorkflowService,\n} from '../../../workflow/index.js';\n\n/** Singleton workflow service instance */\nlet workflowServiceInstance: WorkflowService | undefined;\n\n/**\n * Get or create the workflow service instance\n *\n * @returns WorkflowService instance\n */\nfunction getWorkflowService(): WorkflowService {\n  if (!workflowServiceInstance) {\n    workflowServiceInstance = createWorkflowService();\n  }\n  return workflowServiceInstance;\n}\n\n/**\n * Workflow start tool definition\n *\n * Defines the MCP tool interface for starting workflows.\n * Supports multiple workflow types including collaboration,\n * analysis, and custom workflows.\n */\nexport const workflowStartTool: Tool = {\n  name: 'kg_workflow_start',\n  description: 'Start a new workflow for knowledge graph operations',\n  inputSchema: {\n    type: 'object' as const,\n    properties: {\n      workflowId: {\n        type: 'string',\n        description: 'Workflow type to start (collaboration, analysis, sync)',\n        enum: ['collaboration', 'analysis', 'sync', 'custom'],\n      },\n      input: {\n        type: 'object',\n        description: 'Workflow input data',\n        properties: {\n          graphId: {\n            type: 'string',\n            description: 'Knowledge graph identifier',\n          },\n          docPath: {\n            type: 'string',\n            description: 'Path to the source document',\n          },\n          options: {\n            type: 'object',\n            description: 'Additional workflow options',\n            properties: {\n              autoStart: {\n                type: 'boolean',\n                description: 'Auto-start development when ready',\n              },\n              watchPaths: {\n                type: 'array',\n                description: 'Paths to watch for changes',\n                items: { type: 'string' },\n              },\n              threshold: {\n                type: 'number',\n                description: 'Completeness threshold (0-1)',\n              },\n            },\n          },\n        },\n      },\n    },\n    required: ['workflowId'],\n  },\n};\n\n/**\n * Workflow type definitions for different workflow scenarios\n */\ntype WorkflowType = 'collaboration' | 'analysis' | 'sync' | 'custom';\n\n/**\n * Input structure for workflow execution\n */\ninterface WorkflowInput {\n  graphId?: string;\n  docPath?: string;\n  options?: {\n    autoStart?: boolean;\n    watchPaths?: string[];\n    threshold?: number;\n  };\n}\n\n/**\n * Create handler for workflow start tool\n *\n * Creates an async handler that starts the specified workflow type\n * and returns execution metadata.\n *\n * @returns ToolHandler function for starting workflows\n *\n * @example\n * ```typescript\n * const handler = createWorkflowStartHandler();\n * const result = await handler({\n *   workflowId: 'collaboration',\n *   input: {\n *     graphId: 'graph-123',\n *     docPath: './docs/spec.md'\n *   }\n * });\n * ```\n */\nexport function createWorkflowStartHandler(): ToolHandler {\n  return async (params): Promise<ToolResult> => {\n    const startTime = Date.now();\n    const { workflowId, input = {} } = params || {};\n\n    // Validate required parameters\n    if (!workflowId || typeof workflowId !== 'string') {\n      return {\n        success: false,\n        error: 'Workflow ID is required',\n        metadata: { executionTime: Date.now() - startTime },\n      };\n    }\n\n    const validWorkflowTypes: WorkflowType[] = ['collaboration', 'analysis', 'sync', 'custom'];\n    if (!validWorkflowTypes.includes(workflowId as WorkflowType)) {\n      return {\n        success: false,\n        error: `Invalid workflow type: ${workflowId}. Valid types: ${validWorkflowTypes.join(', ')}`,\n        metadata: { executionTime: Date.now() - startTime },\n      };\n    }\n\n    try {\n      const service = getWorkflowService();\n      const typedInput = input as WorkflowInput;\n\n      // Ensure service is started\n      const status = service.getStatus();\n      if (!status.isRunning) {\n        await service.start();\n      }\n\n      // Add watch paths if specified\n      if (typedInput.options?.watchPaths) {\n        for (const path of typedInput.options.watchPaths) {\n          service.watch(path);\n        }\n      }\n\n      let result;\n      switch (workflowId as WorkflowType) {\n        case 'collaboration':\n          // Start collaboration workflow\n          result = await service.startCollaborationWorkflow(\n            typedInput.graphId || `graph-${Date.now()}`,\n            typedInput.docPath || './'\n          );\n          break;\n\n        case 'analysis':\n          // Run gap analysis workflow\n          const analysis = await service.analyzeGaps(typedInput.docPath || './');\n          result = {\n            success: true,\n            workflowId: `analysis-${Date.now()}`,\n            startedAt: new Date(),\n            completedAt: new Date(),\n            outcome: 'completed' as const,\n            artifacts: analysis.recommendations,\n            data: analysis,\n          };\n          break;\n\n        case 'sync':\n          // Sync workflow for file watching\n          const watchPaths = typedInput.options?.watchPaths || [typedInput.docPath || './'];\n          for (const path of watchPaths) {\n            service.watch(path);\n          }\n          result = {\n            success: true,\n            workflowId: `sync-${Date.now()}`,\n            startedAt: new Date(),\n            outcome: 'completed' as const,\n            artifacts: watchPaths,\n          };\n          break;\n\n        case 'custom':\n          // Custom workflow using GOAP planning\n          const plan = await service.createPlan('start-development');\n          result = {\n            success: plan.achievable,\n            workflowId: `custom-${Date.now()}`,\n            startedAt: new Date(),\n            completedAt: new Date(),\n            outcome: plan.achievable ? 'completed' as const : 'failed' as const,\n            artifacts: plan.actionIds,\n            data: { plan },\n          };\n          break;\n      }\n\n      return {\n        success: result.success,\n        data: {\n          workflowId: result.workflowId,\n          type: workflowId,\n          startedAt: result.startedAt,\n          completedAt: result.completedAt,\n          outcome: result.outcome,\n          artifacts: result.artifacts,\n          ...(result.error ? { error: result.error } : {}),\n        },\n        metadata: {\n          executionTime: Date.now() - startTime,\n          serviceStatus: service.getStatus().isRunning ? 'running' : 'stopped',\n        },\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n        metadata: { executionTime: Date.now() - startTime },\n      };\n    }\n  };\n}\n"],"names":[],"mappings":"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"}