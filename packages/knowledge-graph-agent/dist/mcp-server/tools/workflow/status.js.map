{"version":3,"file":"status.js","sources":["../../../../src/mcp-server/tools/workflow/status.ts"],"sourcesContent":["/**\n * Workflow Status Tool\n *\n * MCP tool for checking the status of a specific workflow\n * or the overall workflow service status.\n *\n * @module mcp-server/tools/workflow/status\n */\n\nimport type { Tool } from '@modelcontextprotocol/sdk/types.js';\nimport type { ToolHandler, ToolResult } from '../../types/index.js';\nimport {\n  createWorkflowService,\n  type WorkflowService,\n  type WorkflowRunMetadata,\n} from '../../../workflow/index.js';\n\n/** Singleton workflow service instance */\nlet workflowServiceInstance: WorkflowService | undefined;\n\n/**\n * Get or create the workflow service instance\n *\n * @returns WorkflowService instance\n */\nfunction getWorkflowService(): WorkflowService {\n  if (!workflowServiceInstance) {\n    workflowServiceInstance = createWorkflowService();\n  }\n  return workflowServiceInstance;\n}\n\n/**\n * Workflow status tool definition\n *\n * Defines the MCP tool interface for checking workflow status.\n * Can query specific workflow by ID or get service-wide status.\n */\nexport const workflowStatusTool: Tool = {\n  name: 'kg_workflow_status',\n  description: 'Check the status of a workflow or the workflow service',\n  inputSchema: {\n    type: 'object' as const,\n    properties: {\n      workflowId: {\n        type: 'string',\n        description: 'Specific workflow ID to check (optional, returns service status if not provided)',\n      },\n      includeMetrics: {\n        type: 'boolean',\n        description: 'Include execution metrics and statistics',\n        default: false,\n      },\n      includeConfig: {\n        type: 'boolean',\n        description: 'Include service configuration details',\n        default: false,\n      },\n    },\n  },\n};\n\n/**\n * Workflow status response structure\n */\ninterface WorkflowStatusResponse {\n  /** Whether a specific workflow was found */\n  found: boolean;\n  /** Workflow metadata if found */\n  workflow?: WorkflowRunMetadata;\n  /** Service-level status */\n  service: {\n    isRunning: boolean;\n    activeWorkflowCount: number;\n    watchedPaths: string[];\n    lastActivity?: Date;\n  };\n  /** Execution statistics (if requested) */\n  stats?: {\n    totalExecutions: number;\n    successfulExecutions: number;\n    failedExecutions: number;\n    averageDuration: number;\n    successRate: number;\n  };\n  /** Service configuration (if requested) */\n  config?: {\n    inactivityTimeout: number;\n    autoStartThreshold: number;\n    watchPaths: string[];\n    debug: boolean;\n  };\n}\n\n/**\n * Create handler for workflow status tool\n *\n * Creates an async handler that returns the status of a specific\n * workflow or the overall workflow service.\n *\n * @returns ToolHandler function for checking workflow status\n *\n * @example\n * ```typescript\n * const handler = createWorkflowStatusHandler();\n *\n * // Check specific workflow\n * const result = await handler({ workflowId: 'collab-123-abc' });\n *\n * // Check service status with metrics\n * const serviceStatus = await handler({ includeMetrics: true });\n * ```\n */\nexport function createWorkflowStatusHandler(): ToolHandler {\n  return async (params): Promise<ToolResult> => {\n    const startTime = Date.now();\n    const { workflowId, includeMetrics = false, includeConfig = false } = params || {};\n\n    try {\n      const service = getWorkflowService();\n      const serviceStatus = service.getStatus();\n\n      const response: WorkflowStatusResponse = {\n        found: false,\n        service: {\n          isRunning: serviceStatus.isRunning,\n          activeWorkflowCount: serviceStatus.activeWorkflows.length,\n          watchedPaths: serviceStatus.watchedPaths,\n          lastActivity: serviceStatus.lastActivity,\n        },\n      };\n\n      // Check specific workflow if ID provided\n      if (workflowId && typeof workflowId === 'string') {\n        const workflow = service.getWorkflow(workflowId);\n        if (workflow) {\n          response.found = true;\n          response.workflow = workflow;\n        }\n      }\n\n      // Include execution statistics if requested\n      if (includeMetrics) {\n        const stats = serviceStatus.stats;\n        response.stats = {\n          totalExecutions: stats.totalExecutions,\n          successfulExecutions: stats.successfulExecutions,\n          failedExecutions: stats.failedExecutions,\n          averageDuration: stats.averageDuration,\n          successRate: stats.totalExecutions > 0\n            ? (stats.successfulExecutions / stats.totalExecutions) * 100\n            : 0,\n        };\n      }\n\n      // Include configuration if requested\n      if (includeConfig) {\n        const config = service.getConfig();\n        response.config = {\n          inactivityTimeout: config.inactivityTimeout || 300000,\n          autoStartThreshold: config.autoStartThreshold || 0.7,\n          watchPaths: config.watchPaths || [],\n          debug: config.debug || false,\n        };\n      }\n\n      return {\n        success: true,\n        data: response,\n        metadata: {\n          executionTime: Date.now() - startTime,\n          requestedWorkflowId: workflowId || null,\n        },\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n        metadata: { executionTime: Date.now() - startTime },\n      };\n    }\n  };\n}\n"],"names":[],"mappings":";;;AAkBA,IAAI;AAOJ,SAAS,qBAAsC;AAC7C,MAAI,CAAC,yBAAyB;AAC5B,8BAA0B,sBAAA;AAAA,EAC5B;AACA,SAAO;AACT;AAQO,MAAM,qBAA2B;AAAA,EACtC,MAAM;AAAA,EACN,aAAa;AAAA,EACb,aAAa;AAAA,IACX,MAAM;AAAA,IACN,YAAY;AAAA,MACV,YAAY;AAAA,QACV,MAAM;AAAA,QACN,aAAa;AAAA,MAAA;AAAA,MAEf,gBAAgB;AAAA,QACd,MAAM;AAAA,QACN,aAAa;AAAA,QACb,SAAS;AAAA,MAAA;AAAA,MAEX,eAAe;AAAA,QACb,MAAM;AAAA,QACN,aAAa;AAAA,QACb,SAAS;AAAA,MAAA;AAAA,IACX;AAAA,EACF;AAEJ;AAqDO,SAAS,8BAA2C;AACzD,SAAO,OAAO,WAAgC;AAC5C,UAAM,YAAY,KAAK,IAAA;AACvB,UAAM,EAAE,YAAY,iBAAiB,OAAO,gBAAgB,MAAA,IAAU,UAAU,CAAA;AAEhF,QAAI;AACF,YAAM,UAAU,mBAAA;AAChB,YAAM,gBAAgB,QAAQ,UAAA;AAE9B,YAAM,WAAmC;AAAA,QACvC,OAAO;AAAA,QACP,SAAS;AAAA,UACP,WAAW,cAAc;AAAA,UACzB,qBAAqB,cAAc,gBAAgB;AAAA,UACnD,cAAc,cAAc;AAAA,UAC5B,cAAc,cAAc;AAAA,QAAA;AAAA,MAC9B;AAIF,UAAI,cAAc,OAAO,eAAe,UAAU;AAChD,cAAM,WAAW,QAAQ,YAAY,UAAU;AAC/C,YAAI,UAAU;AACZ,mBAAS,QAAQ;AACjB,mBAAS,WAAW;AAAA,QACtB;AAAA,MACF;AAGA,UAAI,gBAAgB;AAClB,cAAM,QAAQ,cAAc;AAC5B,iBAAS,QAAQ;AAAA,UACf,iBAAiB,MAAM;AAAA,UACvB,sBAAsB,MAAM;AAAA,UAC5B,kBAAkB,MAAM;AAAA,UACxB,iBAAiB,MAAM;AAAA,UACvB,aAAa,MAAM,kBAAkB,IAChC,MAAM,uBAAuB,MAAM,kBAAmB,MACvD;AAAA,QAAA;AAAA,MAER;AAGA,UAAI,eAAe;AACjB,cAAM,SAAS,QAAQ,UAAA;AACvB,iBAAS,SAAS;AAAA,UAChB,mBAAmB,OAAO,qBAAqB;AAAA,UAC/C,oBAAoB,OAAO,sBAAsB;AAAA,UACjD,YAAY,OAAO,cAAc,CAAA;AAAA,UACjC,OAAO,OAAO,SAAS;AAAA,QAAA;AAAA,MAE3B;AAEA,aAAO;AAAA,QACL,SAAS;AAAA,QACT,MAAM;AAAA,QACN,UAAU;AAAA,UACR,eAAe,KAAK,IAAA,IAAQ;AAAA,UAC5B,qBAAqB,cAAc;AAAA,QAAA;AAAA,MACrC;AAAA,IAEJ,SAAS,OAAO;AACd,aAAO;AAAA,QACL,SAAS;AAAA,QACT,OAAO,iBAAiB,QAAQ,MAAM,UAAU,OAAO,KAAK;AAAA,QAC5D,UAAU,EAAE,eAAe,KAAK,IAAA,IAAQ,UAAA;AAAA,MAAU;AAAA,IAEtD;AAAA,EACF;AACF;"}