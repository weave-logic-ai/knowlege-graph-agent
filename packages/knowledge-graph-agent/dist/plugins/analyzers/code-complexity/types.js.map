{"version":3,"file":"types.js","sources":["../../../../src/plugins/analyzers/code-complexity/types.ts"],"sourcesContent":["/**\n * Code Complexity Analyzer Plugin - Type Definitions\n *\n * Types for complexity analysis including cyclomatic complexity,\n * cognitive complexity, Halstead metrics, and code structure metrics.\n *\n * @module plugins/analyzers/code-complexity/types\n */\n\nimport type { NodeType, KnowledgeNode } from '../../../core/types.js';\n\n// ============================================================================\n// Halstead Metrics Types\n// ============================================================================\n\n/**\n * Halstead software science metrics\n *\n * Based on Maurice Halstead's software science:\n * - n1 = number of distinct operators\n * - n2 = number of distinct operands\n * - N1 = total number of operators\n * - N2 = total number of operands\n */\nexport interface HalsteadMetrics {\n  /** Number of distinct operators */\n  distinctOperators: number;\n  /** Number of distinct operands */\n  distinctOperands: number;\n  /** Total number of operators */\n  totalOperators: number;\n  /** Total number of operands */\n  totalOperands: number;\n  /** Program vocabulary: n = n1 + n2 */\n  vocabulary: number;\n  /** Program length: N = N1 + N2 */\n  length: number;\n  /** Calculated program length: N^ = n1 * log2(n1) + n2 * log2(n2) */\n  calculatedLength: number;\n  /** Volume: V = N * log2(n) - Size of implementation */\n  volume: number;\n  /** Difficulty: D = (n1/2) * (N2/n2) - Difficulty to understand */\n  difficulty: number;\n  /** Effort: E = D * V - Mental effort required */\n  effort: number;\n  /** Time to program: T = E / 18 seconds */\n  time: number;\n  /** Number of delivered bugs: B = V / 3000 */\n  bugs: number;\n}\n\n/**\n * Default/empty Halstead metrics\n */\nexport const EMPTY_HALSTEAD_METRICS: HalsteadMetrics = {\n  distinctOperators: 0,\n  distinctOperands: 0,\n  totalOperators: 0,\n  totalOperands: 0,\n  vocabulary: 0,\n  length: 0,\n  calculatedLength: 0,\n  volume: 0,\n  difficulty: 0,\n  effort: 0,\n  time: 0,\n  bugs: 0,\n};\n\n// ============================================================================\n// Complexity Metric Types\n// ============================================================================\n\n/**\n * Individual complexity score for a code element\n */\nexport interface ComplexityScore {\n  /** Cyclomatic complexity - measures decision points (if, for, while, case, catch, &&, ||, ?:) */\n  cyclomatic: number;\n  /** Cognitive complexity - measures mental effort to understand (nested structures weighted higher) */\n  cognitive: number;\n  /** Lines of code (excluding blank lines and comments) */\n  loc: number;\n  /** Total lines including comments and blank lines */\n  totalLines: number;\n  /** Number of parameters (for functions) */\n  parameterCount?: number;\n  /** Maximum nesting depth */\n  maxNestingDepth: number;\n  /** Number of return statements */\n  returnCount?: number;\n  /** Halstead software science metrics */\n  halstead?: HalsteadMetrics;\n}\n\n/**\n * Complexity thresholds for categorization\n */\nexport interface ComplexityThresholds {\n  /** Cyclomatic complexity threshold for \"complex\" designation */\n  cyclomaticHigh: number;\n  /** Cyclomatic complexity threshold for \"very complex\" designation */\n  cyclomaticCritical: number;\n  /** Cognitive complexity threshold for \"complex\" designation */\n  cognitiveHigh: number;\n  /** Cognitive complexity threshold for \"very complex\" designation */\n  cognitiveCritical: number;\n  /** Maximum recommended nesting depth */\n  maxNestingDepth: number;\n  /** Maximum recommended function length (LOC) */\n  maxFunctionLength: number;\n}\n\n/**\n * Default complexity thresholds\n */\nexport const DEFAULT_THRESHOLDS: ComplexityThresholds = {\n  cyclomaticHigh: 10,\n  cyclomaticCritical: 20,\n  cognitiveHigh: 15,\n  cognitiveCritical: 25,\n  maxNestingDepth: 4,\n  maxFunctionLength: 50,\n};\n\n// ============================================================================\n// Function Analysis Types\n// ============================================================================\n\n/**\n * Classification of complexity level\n */\nexport type ComplexityLevel = 'low' | 'moderate' | 'high' | 'critical';\n\n/**\n * Function/method analysis result\n */\nexport interface FunctionAnalysis {\n  /** Function name */\n  name: string;\n  /** File path containing the function */\n  filePath: string;\n  /** Start line number (1-indexed) */\n  startLine: number;\n  /** End line number (1-indexed) */\n  endLine: number;\n  /** Function kind (function, method, arrow, constructor) */\n  kind: FunctionKind;\n  /** Complexity scores */\n  complexity: ComplexityScore;\n  /** Complexity classification */\n  level: ComplexityLevel;\n  /** Parent class/object name if applicable */\n  parentName?: string;\n  /** Is this an async function */\n  isAsync: boolean;\n  /** Is this an exported function */\n  isExported: boolean;\n  /** List of issue descriptions */\n  issues: string[];\n  /** Recommendations for improvement */\n  recommendations: string[];\n}\n\n/**\n * Types of functions detected\n */\nexport type FunctionKind =\n  | 'function'\n  | 'arrow'\n  | 'method'\n  | 'constructor'\n  | 'getter'\n  | 'setter'\n  | 'generator'\n  | 'asyncGenerator';\n\n// ============================================================================\n// File Analysis Types\n// ============================================================================\n\n/**\n * Complete file analysis result\n */\nexport interface FileAnalysis {\n  /** Absolute file path */\n  filePath: string;\n  /** Relative path from project root */\n  relativePath: string;\n  /** File extension */\n  extension: string;\n  /** File-level complexity scores (aggregated) */\n  complexity: FileComplexityScore;\n  /** All functions in the file */\n  functions: FunctionAnalysis[];\n  /** Number of classes */\n  classCount: number;\n  /** Number of imports */\n  importCount: number;\n  /** Number of exports */\n  exportCount: number;\n  /** Analysis timestamp */\n  analyzedAt: Date;\n  /** Parse errors if any */\n  parseErrors: string[];\n  /** Complex functions (exceeding thresholds) */\n  complexFunctions: FunctionAnalysis[];\n  /** Overall file complexity level */\n  level: ComplexityLevel;\n}\n\n/**\n * File-level complexity aggregation\n */\nexport interface FileComplexityScore extends ComplexityScore {\n  /** Average cyclomatic complexity per function */\n  avgCyclomatic: number;\n  /** Average cognitive complexity per function */\n  avgCognitive: number;\n  /** Total function count */\n  functionCount: number;\n  /** Maintainability index (0-100, higher is better) */\n  maintainabilityIndex: number;\n}\n\n// ============================================================================\n// Project Analysis Types\n// ============================================================================\n\n/**\n * Project-wide analysis result\n */\nexport interface ProjectAnalysis {\n  /** Project root path */\n  projectRoot: string;\n  /** All analyzed files */\n  files: FileAnalysis[];\n  /** Project-level aggregated metrics */\n  metrics: ProjectMetrics;\n  /** Files with complexity issues */\n  hotspots: FileAnalysis[];\n  /** Most complex functions across project */\n  complexFunctions: FunctionAnalysis[];\n  /** Analysis configuration used */\n  config: AnalyzerConfig;\n  /** Analysis timing */\n  timing: {\n    startedAt: Date;\n    completedAt: Date;\n    durationMs: number;\n  };\n}\n\n/**\n * Project-wide metrics\n */\nexport interface ProjectMetrics {\n  /** Total files analyzed */\n  totalFiles: number;\n  /** Total functions analyzed */\n  totalFunctions: number;\n  /** Total lines of code */\n  totalLoc: number;\n  /** Average cyclomatic complexity */\n  avgCyclomatic: number;\n  /** Average cognitive complexity */\n  avgCognitive: number;\n  /** Average maintainability index */\n  avgMaintainability: number;\n  /** Distribution of complexity levels */\n  complexityDistribution: Record<ComplexityLevel, number>;\n  /** Files by complexity level */\n  filesByLevel: Record<ComplexityLevel, number>;\n  /** Most complex files (top N) */\n  topComplexFiles: Array<{ path: string; score: number }>;\n  /** Most complex functions (top N) */\n  topComplexFunctions: Array<{ name: string; file: string; score: number }>;\n}\n\n// ============================================================================\n// Analyzer Configuration Types\n// ============================================================================\n\n/**\n * File patterns to include/exclude\n */\nexport interface FilePatterns {\n  /** Glob patterns for files to include */\n  include: string[];\n  /** Glob patterns for files to exclude */\n  exclude: string[];\n}\n\n/**\n * Analyzer configuration\n */\nexport interface AnalyzerConfig {\n  /** Project root directory */\n  projectRoot: string;\n  /** File patterns to analyze */\n  patterns: FilePatterns;\n  /** Complexity thresholds */\n  thresholds: ComplexityThresholds;\n  /** Maximum files to analyze */\n  maxFiles?: number;\n  /** Include node_modules */\n  includeNodeModules: boolean;\n  /** Include test files */\n  includeTests: boolean;\n  /** Generate graph nodes for complex functions */\n  generateGraphNodes: boolean;\n  /** Minimum complexity to include in results */\n  minComplexityToReport: number;\n  /** Enable verbose logging */\n  verbose: boolean;\n}\n\n/**\n * Default analyzer configuration\n */\nexport const DEFAULT_CONFIG: AnalyzerConfig = {\n  projectRoot: '.',\n  patterns: {\n    include: ['**/*.ts', '**/*.tsx', '**/*.js', '**/*.jsx'],\n    exclude: [\n      '**/node_modules/**',\n      '**/dist/**',\n      '**/build/**',\n      '**/*.d.ts',\n      '**/*.min.js',\n      '**/coverage/**',\n    ],\n  },\n  thresholds: DEFAULT_THRESHOLDS,\n  includeNodeModules: false,\n  includeTests: true,\n  generateGraphNodes: true,\n  minComplexityToReport: 0,\n  verbose: false,\n};\n\n// ============================================================================\n// Knowledge Graph Integration Types\n// ============================================================================\n\n/**\n * Complexity node type for knowledge graph\n */\nexport type ComplexityNodeType = 'complexity-hotspot' | 'complex-function' | 'complex-file';\n\n/**\n * Node generated from complexity analysis\n */\nexport interface ComplexityNode {\n  /** Node ID (unique identifier) */\n  id: string;\n  /** Node type */\n  type: ComplexityNodeType;\n  /** Display title */\n  title: string;\n  /** File path */\n  filePath: string;\n  /** Function name if applicable */\n  functionName?: string;\n  /** Line range */\n  lineRange?: { start: number; end: number };\n  /** Complexity scores */\n  complexity: ComplexityScore;\n  /** Complexity level */\n  level: ComplexityLevel;\n  /** Issues identified */\n  issues: string[];\n  /** Recommendations */\n  recommendations: string[];\n  /** Related node IDs */\n  relatedNodes: string[];\n  /** Tags for categorization */\n  tags: string[];\n  /** Creation timestamp */\n  createdAt: Date;\n}\n\n/**\n * Edge connecting complexity nodes to file nodes\n */\nexport interface ComplexityEdge {\n  /** Source node ID */\n  source: string;\n  /** Target node ID */\n  target: string;\n  /** Edge type for complexity relationships */\n  type: 'complexity' | 'contains' | 'related';\n  /** Relationship weight */\n  weight: number;\n  /** Context for the edge */\n  context?: string;\n  /** Complexity score associated with this relationship */\n  complexityScore?: number;\n}\n\n// ============================================================================\n// Plugin Interface Types\n// ============================================================================\n\n/**\n * Plugin result from analysis\n */\nexport interface ComplexityPluginResult {\n  /** Analysis success */\n  success: boolean;\n  /** Project-wide analysis */\n  analysis: ProjectAnalysis;\n  /** Generated knowledge graph nodes */\n  nodes: ComplexityNode[];\n  /** Generated edges */\n  edges: ComplexityEdge[];\n  /** Error messages if any */\n  errors: string[];\n  /** Warning messages */\n  warnings: string[];\n}\n\n/**\n * Plugin options for integration\n */\nexport interface ComplexityPluginOptions {\n  /** Analyzer configuration */\n  config?: Partial<AnalyzerConfig>;\n  /** Store results in cache */\n  useCache?: boolean;\n  /** Cache TTL in milliseconds */\n  cacheTtl?: number;\n  /** Generate markdown report */\n  generateReport?: boolean;\n  /** Report output path */\n  reportPath?: string;\n}\n\n/**\n * Cache entry for complexity results\n */\nexport interface ComplexityAnalysisCache {\n  /** File path */\n  filePath: string;\n  /** File modification time */\n  mtime: number;\n  /** Cached analysis result */\n  analysis: FileAnalysis;\n  /** Cache timestamp */\n  cachedAt: number;\n}\n"],"names":[],"mappings":"AAsDO,MAAM,yBAA0C;AAAA,EACrD,mBAAmB;AAAA,EACnB,kBAAkB;AAAA,EAClB,gBAAgB;AAAA,EAChB,eAAe;AAAA,EACf,YAAY;AAAA,EACZ,QAAQ;AAAA,EACR,kBAAkB;AAAA,EAClB,QAAQ;AAAA,EACR,YAAY;AAAA,EACZ,QAAQ;AAAA,EACR,MAAM;AAAA,EACN,MAAM;AACR;AAiDO,MAAM,qBAA2C;AAAA,EACtD,gBAAgB;AAAA,EAChB,oBAAoB;AAAA,EACpB,eAAe;AAAA,EACf,mBAAmB;AAAA,EACnB,iBAAiB;AAAA,EACjB,mBAAmB;AACrB;"}