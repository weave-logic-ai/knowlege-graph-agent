{"version":3,"file":"types.js","sources":["../../src/server/types.ts"],"sourcesContent":["/**\n * Server Infrastructure Types\n *\n * Type definitions for the unified server system that coordinates\n * MCP, GraphQL, and Dashboard servers in a single process.\n *\n * @module server/types\n */\n\nimport type { EventEmitter } from 'events';\nimport type { Server as HTTPServer } from 'http';\nimport type { KnowledgeGraphDatabase } from '../core/database.js';\nimport type { ShadowCache } from '../core/cache.js';\nimport type { AgentRegistry } from '../agents/registry.js';\nimport type { WorkflowRegistry } from '../workflows/registry.js';\nimport type { KnowledgeGraphMCPServer } from '../mcp-server/server.js';\n\n// ============================================================================\n// Server Configuration Types\n// ============================================================================\n\n/**\n * MCP server configuration\n */\nexport interface MCPServerConfig {\n  /** Enable MCP server */\n  enabled: boolean;\n  /** Server name */\n  name?: string;\n  /** Server version */\n  version?: string;\n}\n\n/**\n * GraphQL server configuration\n */\nexport interface GraphQLServerConfig {\n  /** Enable GraphQL server */\n  enabled: boolean;\n  /** Port to listen on */\n  port: number;\n  /** Enable GraphQL Playground */\n  playground?: boolean;\n  /** Enable introspection */\n  introspection?: boolean;\n  /** CORS configuration */\n  cors?: {\n    origin?: string | string[];\n    credentials?: boolean;\n  };\n}\n\n/**\n * Dashboard server configuration\n */\nexport interface DashboardServerConfig {\n  /** Enable dashboard server */\n  enabled: boolean;\n  /** Port to listen on */\n  port: number;\n  /** Enable hot reload for development */\n  hotReload?: boolean;\n  /** Path to static assets */\n  staticPath?: string;\n}\n\n/**\n * Database configuration\n */\nexport interface DatabaseServerConfig {\n  /** Path to SQLite database */\n  path: string;\n  /** Enable WAL mode */\n  wal?: boolean;\n  /** Busy timeout in milliseconds */\n  busyTimeout?: number;\n}\n\n/**\n * Cache configuration\n */\nexport interface CacheServerConfig {\n  /** Enable caching */\n  enabled: boolean;\n  /** Default TTL in milliseconds */\n  defaultTTL?: number;\n  /** Maximum entries */\n  maxEntries?: number;\n}\n\n/**\n * Complete server configuration\n */\nexport interface ServerConfig {\n  /** Project root directory */\n  projectRoot: string;\n  /** MCP server configuration */\n  mcp: MCPServerConfig;\n  /** GraphQL server configuration */\n  graphql: GraphQLServerConfig;\n  /** Dashboard server configuration */\n  dashboard: DashboardServerConfig;\n  /** Database configuration */\n  database: DatabaseServerConfig;\n  /** Cache configuration */\n  cache: CacheServerConfig;\n  /** Enable verbose logging */\n  verbose?: boolean;\n}\n\n// ============================================================================\n// Server State Types\n// ============================================================================\n\n/**\n * Server status enumeration\n */\nexport type ServerStatus = 'stopped' | 'starting' | 'running' | 'stopping' | 'error';\n\n/**\n * Individual server state\n */\nexport interface ServerState {\n  /** Current status */\n  status: ServerStatus;\n  /** When the server started */\n  startedAt?: Date;\n  /** Port the server is listening on (if applicable) */\n  port?: number;\n  /** Error message if status is 'error' */\n  error?: string;\n  /** Request count */\n  requestCount: number;\n}\n\n/**\n * Overall server manager state\n */\nexport interface ServerManagerState {\n  /** MCP server state */\n  mcp: ServerState;\n  /** GraphQL server state */\n  graphql: ServerState;\n  /** Dashboard server state */\n  dashboard: ServerState;\n  /** Overall system status */\n  overall: ServerStatus;\n  /** When the manager was initialized */\n  initializedAt?: Date;\n}\n\n// ============================================================================\n// Health Check Types\n// ============================================================================\n\n/**\n * Component health status\n */\nexport interface ComponentHealth {\n  /** Component name */\n  name: string;\n  /** Is the component healthy */\n  healthy: boolean;\n  /** Status message */\n  message?: string;\n  /** Additional metrics */\n  metrics?: Record<string, number | string>;\n  /** Last check timestamp */\n  lastCheck: Date;\n}\n\n/**\n * Overall health status\n */\nexport interface HealthStatus {\n  /** Overall health status */\n  healthy: boolean;\n  /** Overall status string */\n  status: 'healthy' | 'degraded' | 'unhealthy';\n  /** Component health details */\n  components: ComponentHealth[];\n  /** System uptime in milliseconds */\n  uptime: number;\n  /** Total requests across all servers */\n  totalRequests: number;\n  /** Memory usage */\n  memory: {\n    heapUsed: number;\n    heapTotal: number;\n    external: number;\n    rss: number;\n  };\n}\n\n// ============================================================================\n// Event Types\n// ============================================================================\n\n/**\n * Server event types\n */\nexport type ServerEventType =\n  | 'server:starting'\n  | 'server:started'\n  | 'server:stopping'\n  | 'server:stopped'\n  | 'server:error'\n  | 'request:received'\n  | 'request:completed'\n  | 'request:error'\n  | 'health:check'\n  | 'config:changed';\n\n/**\n * Server event payload\n */\nexport interface ServerEvent {\n  /** Event type */\n  type: ServerEventType;\n  /** Which server (mcp, graphql, dashboard) */\n  server?: 'mcp' | 'graphql' | 'dashboard';\n  /** Event timestamp */\n  timestamp: Date;\n  /** Event data */\n  data?: Record<string, unknown>;\n  /** Error if applicable */\n  error?: Error;\n}\n\n/**\n * Server event listener\n */\nexport type ServerEventListener = (event: ServerEvent) => void | Promise<void>;\n\n// ============================================================================\n// Shared Services Interface\n// ============================================================================\n\n/**\n * Shared services available to all server components\n */\nexport interface ISharedServices {\n  /** Knowledge graph database */\n  database: KnowledgeGraphDatabase;\n  /** File metadata cache */\n  cache: ShadowCache;\n  /** Agent registry */\n  agentRegistry: AgentRegistry;\n  /** Workflow registry */\n  workflowRegistry: WorkflowRegistry;\n  /** Cross-service event bus */\n  eventBus: EventEmitter;\n  /** Project root directory */\n  projectRoot: string;\n  /** Configuration */\n  config: ServerConfig;\n\n  /** Initialize all services */\n  initialize(): Promise<void>;\n  /** Shutdown all services */\n  shutdown(): Promise<void>;\n  /** Check if services are initialized */\n  isInitialized(): boolean;\n  /** Get service health status */\n  getHealth(): HealthStatus;\n}\n\n// ============================================================================\n// Server Manager Interface\n// ============================================================================\n\n/**\n * Server manager interface\n */\nexport interface IServerManager {\n  /** Start MCP server */\n  startMCP(): Promise<void>;\n  /** Start GraphQL server */\n  startGraphQL(port?: number): Promise<void>;\n  /** Start Dashboard server */\n  startDashboard(port?: number): Promise<void>;\n  /** Start all enabled servers */\n  startAll(): Promise<void>;\n  /** Stop a specific server */\n  stop(server: 'mcp' | 'graphql' | 'dashboard'): Promise<void>;\n  /** Graceful shutdown of all servers */\n  gracefulShutdown(): Promise<void>;\n  /** Get current state */\n  getState(): ServerManagerState;\n  /** Get health status */\n  getHealth(): HealthStatus;\n  /** Subscribe to events */\n  on(event: ServerEventType, listener: ServerEventListener): void;\n  /** Unsubscribe from events */\n  off(event: ServerEventType, listener: ServerEventListener): void;\n}\n\n// ============================================================================\n// Server Instance Types\n// ============================================================================\n\n/**\n * HTTP server instance with metadata\n */\nexport interface HTTPServerInstance {\n  /** HTTP server */\n  server: HTTPServer;\n  /** Port listening on */\n  port: number;\n  /** Server type */\n  type: 'graphql' | 'dashboard';\n  /** Start time */\n  startedAt: Date;\n}\n\n/**\n * MCP server instance wrapper\n */\nexport interface MCPServerInstance {\n  /** MCP server */\n  server: KnowledgeGraphMCPServer;\n  /** Start time */\n  startedAt: Date;\n}\n\n// ============================================================================\n// CLI Options Types\n// ============================================================================\n\n/**\n * CLI serve command options\n */\nexport interface ServeCommandOptions {\n  /** Enable MCP server */\n  mcp?: boolean;\n  /** Enable GraphQL server */\n  graphql?: boolean;\n  /** Enable Dashboard server */\n  dashboard?: boolean;\n  /** GraphQL port */\n  portGraphql?: string | number;\n  /** Dashboard port */\n  portDashboard?: string | number;\n  /** Enable all servers */\n  all?: boolean;\n  /** Database path */\n  db?: string;\n  /** Enable verbose logging */\n  verbose?: boolean;\n}\n\n/**\n * Parsed serve options with defaults applied\n */\nexport interface ParsedServeOptions {\n  mcp: boolean;\n  graphql: boolean;\n  dashboard: boolean;\n  graphqlPort: number;\n  dashboardPort: number;\n  databasePath: string;\n  verbose: boolean;\n}\n\n// ============================================================================\n// Default Values\n// ============================================================================\n\n/**\n * Default port for GraphQL server\n */\nexport const DEFAULT_GRAPHQL_PORT = 4000;\n\n/**\n * Default port for Dashboard server\n */\nexport const DEFAULT_DASHBOARD_PORT = 3000;\n\n/**\n * Default database path\n */\nexport const DEFAULT_DATABASE_PATH = '.kg/knowledge.db';\n\n/**\n * Shutdown timeout in milliseconds\n */\nexport const SHUTDOWN_TIMEOUT = 10000;\n\n/**\n * Health check interval in milliseconds\n */\nexport const HEALTH_CHECK_INTERVAL = 30000;\n"],"names":[],"mappings":"AAmXO,MAAM,uBAAuB;AAK7B,MAAM,yBAAyB;AAK/B,MAAM,wBAAwB;AAK9B,MAAM,mBAAmB;AAKzB,MAAM,wBAAwB;"}