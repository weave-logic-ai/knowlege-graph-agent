{"version":3,"file":"index.js","sources":["../../src/services/index.ts"],"sourcesContent":["/**\n * Services Module\n *\n * Provides service management, lifecycle control, and file watching capabilities.\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Status of a service\n */\nexport type ServiceStatus = 'stopped' | 'starting' | 'running' | 'stopping' | 'error';\n\n/**\n * Type of service\n */\nexport type ServiceType = 'watcher' | 'sync' | 'health' | 'cache' | 'background';\n\n/**\n * Service configuration\n */\nexport interface ServiceConfig {\n  /** Service identifier */\n  id: string;\n  /** Service type */\n  type: ServiceType;\n  /** Whether service should auto-start */\n  autoStart?: boolean;\n  /** Restart on failure */\n  restartOnFailure?: boolean;\n  /** Maximum restart attempts */\n  maxRestarts?: number;\n  /** Restart delay in milliseconds */\n  restartDelay?: number;\n}\n\n/**\n * Service state\n */\nexport interface ServiceState {\n  /** Current status */\n  status: ServiceStatus;\n  /** Start time */\n  startedAt?: Date;\n  /** Last error */\n  lastError?: Error;\n  /** Restart count */\n  restartCount: number;\n}\n\n/**\n * Service metrics\n */\nexport interface ServiceMetrics {\n  /** Total uptime in milliseconds */\n  uptime: number;\n  /** Number of operations performed */\n  operationCount: number;\n  /** Number of errors */\n  errorCount: number;\n  /** Last operation time */\n  lastOperationAt?: Date;\n}\n\n/**\n * Service handler interface\n */\nexport interface ServiceHandler {\n  /** Start the service */\n  start(): Promise<void>;\n  /** Stop the service */\n  stop(): Promise<void>;\n  /** Get service status */\n  getStatus(): ServiceStatus;\n  /** Get service metrics */\n  getMetrics(): ServiceMetrics;\n}\n\n// ============================================================================\n// Service Manager\n// ============================================================================\n\n/**\n * Service Manager for managing multiple services\n */\nexport class ServiceManager {\n  private services: Map<string, ServiceHandler> = new Map();\n  private configs: Map<string, ServiceConfig> = new Map();\n  private states: Map<string, ServiceState> = new Map();\n\n  /**\n   * Register a service\n   */\n  register(config: ServiceConfig, handler: ServiceHandler): void {\n    this.services.set(config.id, handler);\n    this.configs.set(config.id, config);\n    this.states.set(config.id, {\n      status: 'stopped',\n      restartCount: 0,\n    });\n  }\n\n  /**\n   * Start a service\n   */\n  async start(id: string): Promise<void> {\n    const handler = this.services.get(id);\n    const state = this.states.get(id);\n    if (!handler || !state) {\n      throw new Error(`Service not found: ${id}`);\n    }\n\n    state.status = 'starting';\n    try {\n      await handler.start();\n      state.status = 'running';\n      state.startedAt = new Date();\n    } catch (error) {\n      state.status = 'error';\n      state.lastError = error instanceof Error ? error : new Error(String(error));\n      throw error;\n    }\n  }\n\n  /**\n   * Stop a service\n   */\n  async stop(id: string): Promise<void> {\n    const handler = this.services.get(id);\n    const state = this.states.get(id);\n    if (!handler || !state) {\n      throw new Error(`Service not found: ${id}`);\n    }\n\n    state.status = 'stopping';\n    try {\n      await handler.stop();\n      state.status = 'stopped';\n    } catch (error) {\n      state.status = 'error';\n      state.lastError = error instanceof Error ? error : new Error(String(error));\n      throw error;\n    }\n  }\n\n  /**\n   * Start all services\n   */\n  async startAll(): Promise<void> {\n    for (const [id, config] of this.configs) {\n      if (config.autoStart !== false) {\n        await this.start(id);\n      }\n    }\n  }\n\n  /**\n   * Stop all services\n   */\n  async stopAll(): Promise<void> {\n    for (const id of this.services.keys()) {\n      const state = this.states.get(id);\n      if (state?.status === 'running') {\n        await this.stop(id);\n      }\n    }\n  }\n\n  /**\n   * Get service state\n   */\n  getState(id: string): ServiceState | undefined {\n    return this.states.get(id);\n  }\n\n  /**\n   * Get all service states\n   */\n  getAllStates(): Map<string, ServiceState> {\n    return new Map(this.states);\n  }\n\n  /**\n   * Get service metrics\n   */\n  getMetrics(id: string): ServiceMetrics | undefined {\n    return this.services.get(id)?.getMetrics();\n  }\n}\n\n/**\n * Create a new ServiceManager instance\n */\nexport function createServiceManager(): ServiceManager {\n  return new ServiceManager();\n}\n\n// ============================================================================\n// File Watcher Service\n// ============================================================================\n\n/**\n * File watcher service for monitoring file changes\n */\nexport class FileWatcherService implements ServiceHandler {\n  private status: ServiceStatus = 'stopped';\n  private metrics: ServiceMetrics = {\n    uptime: 0,\n    operationCount: 0,\n    errorCount: 0,\n  };\n  private startTime?: Date;\n  private watcher: unknown = null;\n\n  constructor(\n    private watchPaths: string[],\n    private onChange?: (path: string, event: string) => void\n  ) {}\n\n  async start(): Promise<void> {\n    this.status = 'running';\n    this.startTime = new Date();\n    // File watcher implementation would go here\n    // Using chokidar or fs.watch\n  }\n\n  async stop(): Promise<void> {\n    this.status = 'stopped';\n    this.watcher = null;\n  }\n\n  getStatus(): ServiceStatus {\n    return this.status;\n  }\n\n  getMetrics(): ServiceMetrics {\n    if (this.startTime && this.status === 'running') {\n      this.metrics.uptime = Date.now() - this.startTime.getTime();\n    }\n    return { ...this.metrics };\n  }\n}\n"],"names":[],"mappings":"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"}